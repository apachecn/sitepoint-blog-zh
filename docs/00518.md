# ç”¨ Prisma 2ã€Chakra UI å’Œ React å»ºç«‹ä¹ æƒ¯è·Ÿè¸ªå™¨

> åŸæ–‡:[https://www . site point . com/habitat-tracker-prisma-2-chakra-ui-react/](https://www.sitepoint.com/habit-tracker-prisma-2-chakra-ui-react/)

ã€2019 å¹´ 6 æœˆï¼Œ [Prisma 2 é¢„å‘Š](https://www.prisma.io/blog/announcing-prisma-2-zq1s745db8i5/)ä¸Šæ˜ ã€‚Prisma 1 æ”¹å˜äº†æˆ‘ä»¬ä¸æ•°æ®åº“äº¤äº’çš„æ–¹å¼ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ™®é€šçš„ JavaScript æ–¹æ³•å’Œå¯¹è±¡è®¿é—®æ•°æ®åº“ï¼Œè€Œä¸å¿…ç”¨æ•°æ®åº“è¯­è¨€æœ¬èº«ç¼–å†™æŸ¥è¯¢ã€‚Prisma 1 å……å½“äº†æ•°æ®åº“å‰ç«¯çš„æŠ½è±¡ï¼Œå› æ­¤æ›´å®¹æ˜“åˆ¶ä½œ CRUD(åˆ›å»ºã€è¯»å–ã€æ›´æ–°å’Œåˆ é™¤)åº”ç”¨ç¨‹åºã€‚

Prisma 1 æ¶æ„æ˜¯è¿™æ ·çš„:

![Prisma 1 architecture](../Images/f64d92c13c995584639b6dd1fa6469bb.png)

æ³¨æ„ï¼Œåç«¯éœ€è¦ä¸€ä¸ªé¢å¤–çš„ Prisma æœåŠ¡å™¨æ¥è®¿é—®æ•°æ®åº“ã€‚æœ€æ–°ç‰ˆæœ¬ä¸éœ€è¦é¢å¤–çš„æœåŠ¡å™¨ã€‚å®ƒè¢«ç§°ä¸º Prisma æ¡†æ¶(ä»¥å‰ç§°ä¸º Prisma 2 ),æ˜¯ Prisma çš„å®Œå…¨é‡å†™ã€‚æœ€åˆçš„ Prisma æ˜¯ç”¨ Scala ç¼–å†™çš„ï¼Œæ‰€ä»¥å®ƒå¿…é¡»é€šè¿‡ JVM è¿è¡Œï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªé¢å¤–çš„æœåŠ¡å™¨æ¥è¿è¡Œã€‚å®ƒä¹Ÿæœ‰è®°å¿†é—®é¢˜ã€‚

Prisma æ¡†æ¶æ˜¯ç”¨ Rust ç¼–å†™çš„ï¼Œæ‰€ä»¥å†…å­˜å ç”¨å¾ˆå°‘ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ Prisma 1 æ—¶æ‰€éœ€çš„é¢å¤–æœåŠ¡å™¨ç°åœ¨ä¸åç«¯æ†ç»‘åœ¨ä¸€èµ·ï¼Œå› æ­¤æ‚¨å¯ä»¥åƒä½¿ç”¨å›¾ä¹¦é¦†ä¸€æ ·ä½¿ç”¨å®ƒã€‚

Prisma æ¡†æ¶ç”±ä¸‰ä¸ªç‹¬ç«‹çš„å·¥å…·ç»„æˆ:

1.  [Photon](https://photonjs.prisma.io/) :ä¸€ä¸ªç±»å‹å®‰å…¨çš„è‡ªåŠ¨ç”Ÿæˆçš„æ•°æ®åº“å®¢æˆ·ç«¯(â€œORM æ›¿ä»£â€)
2.  Lift:ä¸€ä¸ªå¸¦æœ‰å®šåˆ¶å·¥ä½œæµçš„å£°æ˜æ€§è¿ç§»ç³»ç»Ÿ
3.  [Studio](https://github.com/prisma/studio) :ä¸€ä¸ªæ•°æ®åº“ IDEï¼Œæä¾›äº†ä¸€ä¸ªç®¡ç† UI æ¥æ”¯æŒå„ç§æ•°æ®åº“å·¥ä½œæµã€‚

![Prisma 2 architecture](../Images/74e9d8e38b0eea090db2f6fba05a566a.png)

Photon æ˜¯ä¸€ä¸ªç±»å‹å®‰å…¨çš„æ•°æ®åº“å®¢æˆ·æœºï¼Œå®ƒå–ä»£äº†ä¼ ç»Ÿçš„ ormï¼ŒLift å…è®¸æˆ‘ä»¬ä»¥å£°æ˜çš„æ–¹å¼åˆ›å»ºæ•°æ®æ¨¡å‹å¹¶æ‰§è¡Œæ•°æ®åº“è¿ç§»ã€‚Studio å…è®¸æˆ‘ä»¬é€šè¿‡æ¼‚äº®çš„ç®¡ç† UI æ¥æ‰§è¡Œæ•°æ®åº“æ“ä½œã€‚

## ä¸ºä»€ä¹ˆç”¨ Prismaï¼Ÿ

Prisma æ¶ˆé™¤äº†ç¼–å†™å¤æ‚æ•°æ®åº“æŸ¥è¯¢çš„å¤æ‚æ€§ï¼Œç®€åŒ–äº†åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®åº“è®¿é—®ã€‚é€šè¿‡ä½¿ç”¨ Prismaï¼Œæ‚¨å¯ä»¥æ›´æ”¹åº•å±‚æ•°æ®åº“ï¼Œè€Œä¸å¿…æ›´æ”¹æ¯ä¸ªæŸ¥è¯¢ã€‚å®ƒåªæ˜¯å·¥ä½œã€‚ç›®å‰åªæ”¯æŒ mySQLã€SQLite å’Œ PostgreSQLã€‚

Prisma æä¾›ç”±è‡ªåŠ¨ç”Ÿæˆçš„ Prisma å®¢æˆ·ç«¯æä¾›çš„ç±»å‹å®‰å…¨æ•°æ®åº“è®¿é—®ã€‚å®ƒæœ‰ä¸€ä¸ªç®€å•è€Œå¼ºå¤§çš„ API æ¥å¤„ç†å…³ç³»æ•°æ®å’Œäº‹åŠ¡ã€‚å®ƒå…è®¸ä½¿ç”¨ [Prisma Studio](https://github.com/prisma/studio) è¿›è¡Œå¯è§†åŒ–æ•°æ®ç®¡ç†ã€‚

ç”±äºé™æ€åˆ†æå’Œç¼–è¯‘æ—¶é”™è¯¯æ£€æŸ¥ï¼Œæä¾›ç«¯åˆ°ç«¯çš„ç±»å‹å®‰å…¨æ„å‘³ç€å¼€å‘äººå‘˜å¯ä»¥å¯¹ä»–ä»¬çš„ä»£ç å……æ»¡ä¿¡å¿ƒã€‚å½“æ‹¥æœ‰æ˜ç¡®å®šä¹‰çš„æ•°æ®ç±»å‹æ—¶ï¼Œå¼€å‘äººå‘˜çš„ä½“éªŒä¼šå¤§å¤§æé«˜ã€‚ç±»å‹å®šä¹‰æ˜¯ IDE åŠŸèƒ½çš„åŸºç¡€ï¼Œå¦‚æ™ºèƒ½è‡ªåŠ¨å®Œæˆæˆ–è·³è½¬åˆ°å®šä¹‰ã€‚

Prisma ç»Ÿä¸€äº†ä¸€æ¬¡å¯¹å¤šä¸ªæ•°æ®åº“çš„è®¿é—®(å³å°†æ¨å‡º)ï¼Œå› æ­¤å¤§å¤§é™ä½äº†è·¨æ•°æ®åº“å·¥ä½œæµçš„å¤æ‚æ€§(å³å°†æ¨å‡º)ã€‚

å®ƒåŸºäºä½¿ç”¨ GraphQL çš„æ¨¡å¼å®šä¹‰è¯­è¨€(SDL)è¡¨è¾¾çš„å£°æ˜æ€§æ•°æ®æ¨¡å‹ï¼Œé€šè¿‡ Lift æä¾›è‡ªåŠ¨æ•°æ®åº“è¿ç§»(å¯é€‰)ã€‚

## å…ˆå†³æ¡ä»¶

å¯¹äºæœ¬æ•™ç¨‹ï¼Œæ‚¨éœ€è¦äº†è§£ [React](https://reactjs.org/) çš„åŸºæœ¬çŸ¥è¯†ã€‚ä½ è¿˜éœ€è¦äº†è§£[ååº”é’©](https://reactjs.org/docs/hooks-intro.html)ã€‚

å› ä¸ºæœ¬æ•™ç¨‹ä¸»è¦å…³æ³¨ Prismaï¼Œæ‰€ä»¥å‡è®¾æ‚¨å·²ç»æŒæ¡äº† React åŠå…¶åŸºæœ¬æ¦‚å¿µçš„å·¥ä½œçŸ¥è¯†ã€‚

å¦‚æœä½ æ²¡æœ‰ä¸Šè¿°å†…å®¹çš„å·¥ä½œçŸ¥è¯†ï¼Œä¸è¦æ‹…å¿ƒã€‚æœ‰å¤§é‡çš„æ•™ç¨‹å¯ä»¥å¸®åŠ©ä½ å‡†å¤‡è¿™ç¯‡æ–‡ç« ã€‚

åœ¨æœ¬æ•™ç¨‹çš„æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨`yarn`ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…`yarn`ï¼Œä»[è¿™é‡Œ](https://yarnpkg.com/en/docs/install)å®‰è£…ã€‚

ä¸ºäº†ç¡®ä¿æˆ‘ä»¬åœ¨åŒä¸€é¡µä¸Šï¼Œè¿™äº›æ˜¯æœ¬æ•™ç¨‹ä¸­ä½¿ç”¨çš„ç‰ˆæœ¬:

*   èŠ‚ç‚¹ v12.11.1
*   npm ç‰ˆæœ¬ 6.11.3
*   npx ç‰ˆæœ¬ 6.11.3
*   çº±çº¿ v1.19.1
*   prisma 2v 2 . 0 . 0-é¢„è§ˆ 016.2
*   react v16.11.0

## æ–‡ä»¶å¤¹ç»“æ„

æˆ‘ä»¬çš„æ–‡ä»¶å¤¹ç»“æ„å¦‚ä¸‹:

```
streaks-app/
  client/
  server/ 
```

`client/`æ–‡ä»¶å¤¹å°†ä» [create-react-app](https://github.com/facebook/create-react-app) å¼•å¯¼ï¼Œ`server/`æ–‡ä»¶å¤¹å°†ä» [prisma2](https://github.com/prisma/prisma2) CLI å¼•å¯¼ã€‚

å› æ­¤ï¼Œæ‚¨åªéœ€è¦åˆ›å»ºä¸€ä¸ªåä¸º`streaks-app/`çš„æ ¹æ–‡ä»¶å¤¹ï¼Œåœ¨ç”¨å„è‡ªçš„ CLI æ­å»ºå®ƒæ—¶ï¼Œå°±ä¼šç”Ÿæˆå­æ–‡ä»¶å¤¹ã€‚ç»§ç»­åˆ›å»º`streaks-app/`æ–‡ä»¶å¤¹å’Œ`cd`ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
$ mkdir streaks-app && cd $_ 
```

## åç«¯(æœåŠ¡å™¨ç«¯)

### å¼•å¯¼ä¸€ä¸ªæ–°çš„ Prisma 2 é¡¹ç›®

æ‚¨å¯ä»¥ä½¿ç”¨ [npx](https://github.com/npm/npx) å‘½ä»¤å¼•å¯¼ä¸€ä¸ªæ–°çš„ Prisma 2 é¡¹ç›®ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
$ npx prisma2 init server 
```

æˆ–è€…ï¼Œæ‚¨å¯ä»¥å…¨å±€å®‰è£…`prisma2` CLI å¹¶è¿è¡Œ`init`å‘½ä»¤ã€‚æ‰§è¡Œä»¥ä¸‹æ“ä½œ:

```
$ yarn global add prisma2 // or npm install --global prisma2
$ prisma2 init server 
```

### è¿è¡Œäº¤äº’`prisma2 init`æµç¨‹&é€‰æ‹©æ ·æ¿æ–‡ä»¶

åœ¨äº¤äº’å¼æç¤ºä¸­é€‰æ‹©ä»¥ä¸‹é€‰é¡¹:

1.  é€‰æ‹©**åˆå­¦è€…å·¥å…·åŒ…**
2.  é€‰æ‹© **JavaScript**
3.  é€‰æ‹© **GraphQL API**
4.  é€‰æ‹© **SQLite**

ä¸€æ—¦ç»ˆæ­¢ï¼Œ`init`å‘½ä»¤å°†åœ¨`server/`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåˆå§‹é¡¹ç›®è®¾ç½®ã€‚

ç°åœ¨æ‰“å¼€`schema.prisma`æ–‡ä»¶ï¼Œå¹¶ç”¨ä»¥ä¸‹å†…å®¹æ›¿æ¢å®ƒ:

```
generator photon {
 provider = "photonjs"
}

datasource db {
 provider = "sqlite"
 url = "file:dev.db"
}

model Habit {
 id String @default(cuid()) @id
 name String @unique
 streak Int
} 
```

`schema.prisma`åŒ…å«æ•°æ®æ¨¡å‹ä»¥åŠé…ç½®é€‰é¡¹ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®šè¦è¿æ¥åˆ°åä¸º`dev.db`çš„ SQLite æ•°æ®æºä»¥åŠåƒ`photonjs` generator è¿™æ ·çš„ç›®æ ‡ä»£ç ç”Ÿæˆå™¨ã€‚

ç„¶åæˆ‘ä»¬å®šä¹‰æ•°æ®æ¨¡å‹`Habit`ï¼Œå®ƒç”±`id`ã€`name`å’Œ`streak`ç»„æˆã€‚

`id`æ˜¯ç±»å‹ä¸º`String`çš„ä¸»é”®ï¼Œé»˜è®¤å€¼ä¸º [cuid()](https://github.com/ericelliott/cuid) ã€‚

`name`çš„ç±»å‹ä¸º`String`ï¼Œä½†æœ‰ä¸€ä¸ªçº¦æŸæ¡ä»¶ï¼Œå³å®ƒå¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚

`streak`å±äº`Int`ç±»å‹ã€‚

`seed.js`æ–‡ä»¶åº”è¯¥æ˜¯è¿™æ ·çš„:

```
const { Photon } = require('@generated/photon')
const photon = new Photon()

async function main() {
  const workout = await photon.habits.create({
    data: {
      name: 'Workout',
      streak: 49,
    },
  })
  const running = await photon.habits.create({
    data: {
      name: 'Running',
      streak: 245,
    },
  })
  const cycling = await photon.habits.create({
    data: {
      name: 'Cycling',
      streak: 77,
    },
  })
  const meditation = await photon.habits.create({
    data: {
      name: 'Meditation',
      streak: 60,
    },
  })
  console.log({
    workout,
    running,
    cycling,
    meditation,
  })
}

main()
  .catch(e => console.error(e))
  .finally(async () => {
    await photon.disconnect()
  }) 
```

è¯¥æ–‡ä»¶åˆ›å»ºå„ç§æ–°ä¹ æƒ¯ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ° SQLite æ•°æ®åº“ä¸­ã€‚

ç°åœ¨è¿›å…¥`src/index.js`æ–‡ä»¶å¹¶åˆ é™¤å…¶å†…å®¹ã€‚æˆ‘ä»¬å°†ä»å¤´å¼€å§‹æ·»åŠ å†…å®¹ã€‚

é¦–å…ˆå¯¼å…¥å¿…è¦çš„åŒ…å¹¶å£°æ˜ä¸€äº›å¸¸é‡:

```
const { GraphQLServer } = require('graphql-yoga')
const {
 makeSchema,
 objectType,
 queryType,
 mutationType,
 idArg,
 stringArg,
} = require('nexus')
const { Photon } = require('@generated/photon')
const { nexusPrismaPlugin } = require('nexus-prisma') 
```

ç°åœ¨è®©æˆ‘ä»¬åœ¨å®ƒä¸‹é¢å£°æ˜æˆ‘ä»¬çš„`Habit`æ¨¡å‹:

```
const Habit = objectType({
  name: 'Habit',
  definition(t) {
    t.model.id()
    t.model.name()
    t.model.streak()
  },
}) 
```

æˆ‘ä»¬åˆ©ç”¨`nexus`åŒ…ä¸­çš„`objectType`æ¥å£°æ˜`Habit`ã€‚

`name`å‚æ•°åº”è¯¥ä¸`schema.prisma`æ–‡ä»¶ä¸­å®šä¹‰çš„ç›¸åŒã€‚

`definition`å‡½æ•°å…è®¸æ‚¨åœ¨å¼•ç”¨`Habit`çš„åœ°æ–¹å…¬å¼€ä¸€ç»„ç‰¹å®šçš„å­—æ®µã€‚è¿™é‡Œæˆ‘ä»¬æ›å…‰`id`ã€`name`å’Œ`streak`åœºã€‚

å¦‚æœæˆ‘ä»¬åªå…¬å¼€`id`å’Œ`name`å­—æ®µï¼Œé‚£ä¹ˆåªè¦å¼•ç”¨äº†`Habit`ï¼Œå°±åªæœ‰è¿™ä¸¤ä¸ªå­—æ®µä¼šè¢«å…¬å¼€ã€‚

åœ¨ä¸‹é¢ï¼Œç²˜è´´`Query`å¸¸é‡:

```
const Query = queryType({
  definition(t) {
    t.crud.habit()
    t.crud.habits()

    // t.list.field('habits', {
    //   type: 'Habit',
    //   resolve: (_, _args, ctx) => {
    //     return ctx.photon.habits.findMany()
    //   },
    // })
  },
}) 
```

æˆ‘ä»¬åˆ©ç”¨`nexus`åŒ…ä¸­çš„`queryType`æ¥å£°æ˜`Query`ã€‚

Photon generator ç”Ÿæˆä¸€ä¸ª APIï¼Œè¯¥ API å…¬å¼€äº†`Habit`æ¨¡å‹ä¸Šçš„ CRUD å‡½æ•°ã€‚è¿™å°±æ˜¯å…è®¸æˆ‘ä»¬æ­éœ²`t.crud.habit()`å’Œ`t.crud.habits()`çš„æ–¹æ³•ã€‚

`t.crud.habit()`å…è®¸æˆ‘ä»¬é€šè¿‡`id`æˆ–`name`æ¥æŸ¥è¯¢ä»»ä½•ä¸ªäººä¹ æƒ¯ã€‚`t.crud.habits()`ç®€å•è¿”å›æ‰€æœ‰ä¹ æƒ¯ã€‚

æˆ–è€…ï¼Œ`t.crud.habits()`ä¹Ÿå¯ä»¥å†™æˆ:

```
t.list.field('habits', {
  type: 'Habit',
  resolve: (_, _args, ctx) => {
    return ctx.photon.habits.findMany()
  },
}) 
```

ä¸Šé¢çš„ä»£ç å’Œ`t.crud.habits()`ä¼šç»™å‡ºç›¸åŒçš„ç»“æœã€‚

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸º`habits`çš„å­—æ®µã€‚å›ç¨‹`type`æ˜¯`Habit`ã€‚ç„¶åæˆ‘ä»¬è°ƒç”¨`ctx.photon.habits.findMany()`ä»æˆ‘ä»¬çš„ SQLite æ•°æ®åº“ä¸­è·å–æ‰€æœ‰ä¹ æƒ¯ã€‚

*æ³¨æ„ï¼Œ`habits`å±æ€§çš„åç§°æ˜¯ä½¿ç”¨[å¤æ•°](https://github.com/blakeembrey/pluralize)åŒ…è‡ªåŠ¨ç”Ÿæˆçš„ã€‚å› æ­¤ï¼Œæ¨èçš„åšæ³•æ˜¯å°†æˆ‘ä»¬çš„æ¨¡å‹å‘½åä¸ºå•æ•°â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œ`Habit`è€Œä¸æ˜¯`Habits`ã€‚*

æˆ‘ä»¬å¯¹`habits`ä½¿ç”¨äº†`findMany`æ–¹æ³•ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¯¹è±¡åˆ—è¡¨ã€‚æˆ‘ä»¬å‘ç°æ‰€æœ‰çš„`habits`æ­£å¦‚æˆ‘ä»¬å·²ç»æåˆ°çš„`findMany`é‡Œé¢æ²¡æœ‰æ¡ä»¶ã€‚ç‚¹å‡»å¯ä»¥äº†è§£æ›´å¤šå…³äºå¦‚ä½•åœ¨`findMany`T5 é‡Œé¢æ·»åŠ æ¡ä»¶ã€‚

åœ¨`Query`ä¸‹æ–¹ï¼Œç²˜è´´`Mutation`å¦‚ä¸‹:

```
const Mutation = mutationType({
  definition(t) {
    t.crud.createOneHabit({ alias: 'createHabit' })
    t.crud.deleteOneHabit({ alias: 'deleteHabit' })

    t.field('incrementStreak', {
      type: 'Habit',
      args: {
        name: stringArg(),
      },
      resolve: async (_, { name }, ctx) => {
        const habit = await ctx.photon.habits.findOne({
          where: {
            name,
          },
        })
        return ctx.photon.habits.update({
          data: {
            streak: habit.streak + 1,
          },
          where: {
            name,
          },
        })
      },
    })
  },
}) 
```

`Mutation`ä½¿ç”¨`nexus`åŒ…ä¸­çš„`mutationType`ã€‚

è¿™é‡Œçš„ CRUD API å…¬å¼€äº†`createOneHabit`å’Œ`deleteOneHabit`ã€‚

`createOneHabit`é¡¾åæ€ä¹‰ï¼Œåˆ›å»ºä¸€ä¸ªä¹ æƒ¯ï¼Œè€Œ`deleteOneHabit`åˆ é™¤ä¸€ä¸ªä¹ æƒ¯ã€‚

`createOneHabit`åˆ«åä¸º`createHabit`ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨å˜å¼‚æ—¶æˆ‘ä»¬è°ƒç”¨`createHabit`è€Œä¸æ˜¯`createOneHabit`ã€‚

åŒæ ·ï¼Œæˆ‘ä»¬å«`deleteHabit`è€Œä¸æ˜¯`deleteOneHabit`ã€‚

æœ€åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º`incrementStreak`çš„å­—æ®µï¼Œå®ƒå¢åŠ äº†ä¸€ä¸ªä¹ æƒ¯çš„æ¡çº¹ã€‚å›ç¨‹`type`æ˜¯`Habit`ã€‚å®ƒæ¥å—ç±»å‹ä¸º`String`çš„`args`å­—æ®µä¸­æŒ‡å®šçš„å‚æ•°`name`ã€‚è¯¥å‚æ•°ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°åœ¨`resolve`å‡½æ•°ä¸­æ¥æ”¶ã€‚æˆ‘ä»¬é€šè¿‡è°ƒç”¨`ctx.photon.habits.findOne()`å¹¶åœ¨`where`å­å¥ä¸­ä¼ é€’`name`å‚æ•°æ¥æ‰¾åˆ°`habit`ã€‚æˆ‘ä»¬éœ€è¦è¿™ä¸ªæ¥è·å¾—å½“å‰çš„`streak`ã€‚æœ€åï¼Œæˆ‘ä»¬é€šè¿‡å°†`streak`å¢åŠ  1 æ¥æ›´æ–°`habit`ã€‚

åœ¨`Mutation`ä¸‹æ–¹ï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹:

```
const photon = new Photon()

new GraphQLServer({
  schema: makeSchema({
    types: [Query, Mutation, Habit],
    plugins: [nexusPrismaPlugin()],
  }),
  context: { photon },
}).start(() =>
  console.log(
    `ğŸš€ Server ready at: http://localhost:4000\nâ­ï¸ See sample queries: http://pris.ly/e/js/graphql#5-using-the-graphql-api`,
  ),
)

module.exports = { Habit } 
```

æˆ‘ä»¬ä½¿ç”¨`nexus`åŒ…ä¸­çš„`makeSchema`æ–¹æ³•æ¥ç»„åˆæˆ‘ä»¬çš„æ¨¡å‹`Habit`ï¼Œå¹¶å°†`Query`å’Œ`Mutation`æ·»åŠ åˆ°`types`æ•°ç»„ä¸­ã€‚æˆ‘ä»¬è¿˜å°†`nexusPrismaPlugin`æ·»åŠ åˆ°æˆ‘ä»¬çš„`plugins`æ•°ç»„ä¸­ã€‚æœ€åï¼Œæˆ‘ä»¬åœ¨ [localhost:4000](http://localhost:4000/) å¯åŠ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚ç«¯å£ 4000 æ˜¯ [graphql-yoga](https://github.com/prisma-labs/graphql-yoga) çš„é»˜è®¤ç«¯å£ã€‚æ‚¨å¯ä»¥åœ¨æ­¤æŒ‰ç…§å»ºè®®[æ›´æ”¹ç«¯å£ã€‚](https://github.com/prisma/prisma2/issues/594#issuecomment-534545903)

ç°åœ¨è®©æˆ‘ä»¬å¯åŠ¨æœåŠ¡å™¨ã€‚ä½†æ˜¯é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿æˆ‘ä»¬æœ€æ–°çš„æ¨¡å¼æ›´æ”¹è¢«å†™å…¥åˆ°`node_modules/@generated/photon`ç›®å½•ä¸­ã€‚è¿è¡Œ`prisma2 generate`æ—¶ä¼šå‡ºç°è¿™ç§æƒ…å†µã€‚

å¦‚æœä½ æ²¡æœ‰å…¨çƒå®‰è£…`prisma2`ï¼Œä½ å°†ä¸å¾—ä¸ç”¨`./node_modules/.bin/prisma2 generate`æ›¿æ¢`prisma2 generate`ã€‚ç„¶åæˆ‘ä»¬éœ€è¦è¿ç§»æ•°æ®åº“æ¥åˆ›å»ºè¡¨ã€‚

### ä½¿ç”¨ Lift è¿ç§»æ‚¨çš„æ•°æ®åº“

ä½¿ç”¨ Lift è¿ç§»æ•°æ®åº“éµå¾ªä¸¤æ­¥æµç¨‹:

1.  ä¿å­˜æ–°çš„è¿ç§»(è¿ç§»åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­è¡¨ç¤ºä¸ºç›®å½•)
2.  è¿è¡Œè¿ç§»(è¿ç§»åº•å±‚æ•°æ®åº“çš„æ¨¡å¼)

åœ¨ CLI å‘½ä»¤ä¸­ï¼Œå¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ‰§è¡Œè¿™äº›æ­¥éª¤(CLI æ­¥éª¤æ­£åœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œä»¥ä¾¿ä¸ä¹‹åŒ¹é…):

```
$ prisma2 lift save --name 'init'
$ prisma2 lift up 
```

åŒæ ·ï¼Œå¦‚æœä½ æ²¡æœ‰åœ¨å…¨çƒèŒƒå›´å†…å®‰è£…å®ƒï¼Œä½ å¿…é¡»ç”¨`./node_modules/.bin/prisma2`æ›¿æ¢`prisma2`ã€‚

ç°åœ¨ï¼Œè¿ç§»è¿‡ç¨‹å·²ç»å®Œæˆã€‚æˆ‘ä»¬å·²ç»æˆåŠŸåˆ›å»ºäº†è¡¨ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®åº“ä¸­æ¤å…¥åˆå§‹å€¼ã€‚

ç»§ç»­åœ¨ç»ˆç«¯ä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
$ yarn seed 
```

è¿™å°†ä¸ºæˆ‘ä»¬çš„æ•°æ®åº“æ¤å…¥å…«ä¸ªä¹ æƒ¯ï¼Œå¦‚æˆ‘ä»¬çš„`seed.js`æ–‡ä»¶ä¸­æ‰€æŒ‡å®šçš„ã€‚

ç°åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡é”®å…¥ä»¥ä¸‹å‘½ä»¤æ¥è¿è¡ŒæœåŠ¡å™¨:

```
$ yarn dev 
```

è¿™å°†åœ¨ [localhost:4000](http://localhost:4000/) è¿è¡Œæ‚¨çš„æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥æ‰“å¼€å¹¶æŸ¥è¯¢æ‚¨åˆ¶ä½œçš„æ‰€æœ‰ APIã€‚

### åˆ—å‡ºæ‰€æœ‰ä¹ æƒ¯

```
query habits {
  habits {
    id
    name
    streak
  }
} 
```

![Streaks App - List Habits](../Images/d7165f617dacb5ca1b5f7d73bb8b143e.png)

### é€šè¿‡åå­—æ‰¾åˆ°ä¹ æƒ¯

```
query findHabitByName {
  habit(where: { name: "Workout" }) {
    id
    name
    streak
  }
} 
```

![Streaks App - Find Habit By Name](../Images/b3802dc517433af8fd41fd2a27bc4ee9.png)

### å…»æˆä¹ æƒ¯

```
mutation createHabit {
  createHabit(data: { name: "Swimming", streak: 10 }) {
    id
    name
    streak
  }
} 
```

![Streaks App - Create Habit](../Images/2a7a57fdefea8e64229556d052d7fbf6.png)

### åˆ é™¤ä¹ æƒ¯

```
mutation deleteHabit {
  deleteHabit(where: { id: "ck2kinq2j0001xqv5ski2byvs" }) {
    id
    name
    streak
  }
} 
```

![Streaks App - Delete Habit](../Images/3530130702ac888c836fac506b193a03.png)

### å¢é‡æ¡çº¹

```
mutation incrementStreak {
  incrementStreak(name: "Workout") {
    streak
  }
} 
```

![Streaks App - Increment Streak](../Images/1312a7ce08e3e5c1a9da9ee52f4ddab2.png)

è¿™å°±æ˜¯æˆ‘ä»¬åç«¯æ‰€éœ€è¦çš„ã€‚æˆ‘ä»¬ç°åœ¨å¼€å§‹åšå‰ç«¯å§ã€‚

## å‰ç«¯(å®¢æˆ·ç«¯)

### å¼•å¯¼ä¸€ä¸ªæ–°çš„ React é¡¹ç›®

ä½¿ç”¨ [create-react-app](https://github.com/facebook/create-react-app) å¼•å¯¼ä¸€ä¸ªæ–°çš„ React é¡¹ç›®ã€‚é€šè¿‡æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼Œä½¿ç”¨ [npx](https://github.com/npm/npx) å¼•å¯¼ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œè€Œä¸å¿…å…¨å±€å®‰è£…`create-react-app`:

```
$ npx create-react-app client 
```

æˆ–è€…ï¼Œæ‚¨å¯ä»¥å…¨å±€å®‰è£…`create-react-app`å¹¶å¼•å¯¼ä¸€ä¸ªæ–°çš„ React é¡¹ç›®ï¼Œç„¶åè¿™æ ·åš:

```
$ yarn global add create-react-app // or npm install --global create-react-app
$ create-react-app client 
```

è¿™å°†ä½¿ç”¨`create-react-app`å¼•å¯¼ä¸€ä¸ªæ–°çš„ React é¡¹ç›®ã€‚

ç°åœ¨è¿›å…¥`client/`ç›®å½•ï¼Œè¿è¡Œé¡¹ç›®ï¼Œå¹¶é”®å…¥ä»¥ä¸‹å†…å®¹:

```
$ cd client
$ yarn start 
```

è¿™å°†åœ¨ [localhost:3000](http://localhost:3000/) ä¸Šè¿è¡Œå®¢æˆ·ç«¯ã€‚

å®ƒç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

![Create React App - Init](../Images/2f388459dc6aea6541063e21f766c5b2.png)

ç°åœ¨è¿›å…¥`src/`ç›®å½•ï¼Œåˆ é™¤ä¸éœ€è¦çš„æ–‡ä»¶ï¼Œå¦‚`App.css`ã€`App.test.js`ã€`index.css`å’Œ`logo.svg`:

```
$ cd src
$ rm App.css App.test.js index.css logo.svg 
```

ä»`index.js`å’Œ`App.js`ä¸­åˆ é™¤å¯¹å·²åˆ é™¤æ–‡ä»¶çš„å¼•ç”¨ã€‚

`index.js`ç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

```
import React from "react";
import ReactDOM from "react-dom";
import App from "./App";
import * as serviceWorker from "./serviceWorker";

ReactDOM.render(<App />, document.getElementById("root"));

// If you want your app to work offline and load faster, you can change
// unregister() to register() below. Note this comes with some pitfalls.
// Learn more about service workers: https://bit.ly/CRA-PWA
serviceWorker.unregister(); 
```

ç¡®ä¿ä½ çš„`App.js`çœ‹èµ·æ¥åƒè¿™æ ·:

```
import React from 'react'

function App() {
 return <div>Streaks App</div>
}

export default App 
```

### urql:é€šç”¨ååº”æŸ¥è¯¢è¯­è¨€

ç»§ç»­ï¼Œé¦–å…ˆå®‰è£… [urql](https://formidable.com/open-source/urql/) ï¼Œå®ƒæ˜¯ [Apollo å®¢æˆ·ç«¯](https://www.apollographql.com/docs/react/)çš„æ›¿ä»£ã€‚æˆ‘ä»¬è¿˜éœ€è¦å®‰è£…`graphql`ï¼Œå› ä¸ºå®ƒæ˜¯`urql`çš„å¯¹ç­‰ä¾èµ–é¡¹ã€‚æ‚¨å¯ä»¥é€šè¿‡åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤æ¥å®ç°è¿™ä¸€ç‚¹:

```
$ cd .. // come out of the 'src/' directory and into the 'client/' directory
$ yarn add urql graphql 
```

ç°åœ¨å°†`App.js`æ›´æ”¹ä¸ºä»¥ä¸‹å†…å®¹ï¼Œå°†`urql`è¿æ¥åˆ° Prisma GraphQL åç«¯:

```
import React from 'react'
import { createClient, Provider } from 'urql'

const client = createClient({
  url: 'http://localhost:4000/'
})

const App = () => (
  <Provider value={client}>
    <div>Streaks App</div>
  </Provider>
)

export default App 
```

è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ä¼ å…¥æˆ‘ä»¬çš„åç«¯`url`æ¥ä½¿ç”¨`urql`çš„`createClient`å‡½æ•°ï¼Œç„¶åå°†å…¶ä½œä¸º`value`é“å…·ä¼ é€’ç»™`Provider`ç»„ä»¶ã€‚è¿™å…è®¸æˆ‘ä»¬æŸ¥è¯¢ã€å˜æ›´æˆ–è®¢é˜…ä»»ä½•ä½œä¸º`Provider`ç»„ä»¶çš„å­ç»„ä»¶çš„ç»„ä»¶ã€‚

å®ƒç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

![Streaks App - Init](../Images/92d8f5b1b3ae0870de716f839e67d920.png)

### Chakra UI

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ [Chakra UI](https://chakra-ui.com/) ä½œä¸ºæˆ‘ä»¬çš„ç»„ä»¶åº“æ¥æ›´å¿«åœ°åˆ¶ä½œæ¼‚äº®çš„åº”ç”¨ç¨‹åºã€‚è¿™æ˜¯ä¸€ä¸ªä¸åŒç±»å‹çš„ç»„ä»¶åº“ï¼Œæ˜¯ä¸ºäº†å¯è®¿é—®æ€§å’Œé€Ÿåº¦è€Œæ„å»ºçš„ã€‚å®ƒæ˜¯å®Œå…¨å¯ä¸»é¢˜åŒ–å’Œå¯ç»„åˆçš„ã€‚è¦å®‰è£…å®ƒï¼Œè¯·åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å†…å®¹:

```
$ yarn add @chakra-ui/core @emotion/core @emotion/styled emotion-theming 
```

Chakra åœ¨å¼•æ“ç›–ä¸‹ä½¿ç”¨[æƒ…æ„Ÿ](https://emotion.sh/)ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å®‰è£…å®ƒå’Œå®ƒçš„å¯¹ç­‰ä¾èµ–ã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦`graphql-tag`æ¥è§£ææˆ‘ä»¬çš„ GraphQL æŸ¥è¯¢ï¼Œ`react-icons`æ¥æ˜¾ç¤ºæ¼‚äº®çš„å›¾æ ‡ï¼Œ`@seznam/compose-react-refs`æ¥ç»„æˆå¤šä¸ª refsï¼Œ [react-hook-form](https://react-hook-form.com/) æ¥åˆ›å»ºè¡¨å•ã€‚

ç¡®ä¿é€šè¿‡åœ¨ç»ˆç«¯ä¸­é”®å…¥ä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…å®ƒä»¬:

```
$ yarn add graphql-tag react-icons @seznam/compose-react-refs react-hook-form 
```

ç°åœ¨ç»§ç»­å°†`App.js`æ›´æ”¹ä¸ºä»¥ä¸‹å†…å®¹:

```
import { Text, ThemeProvider } from '@chakra-ui/core'
import React from 'react'
import { createClient, Provider } from 'urql'

const client = createClient({
  url: 'http://localhost:4000/'
})

const App = () => (
  <Provider value={client}>
    <ThemeProvider>
      <>
        <Text fontSize='5xl' textAlign='center'>
          Streaks App
        </Text>
      </>
    </ThemeProvider>
  </Provider>
)

export default App 
```

æˆ‘ä»¬ä»`@chakra-ui/core`å¯¼å…¥äº†[æ–‡æœ¬](https://chakra-ui.com/text)å’Œ`ThemeProvider`ã€‚

ç»„ä»¶ç”¨äºåœ¨ä¸€ä¸ªç•Œé¢ä¸­å‘ˆç°æ–‡æœ¬å’Œæ®µè½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå‘ˆç°ä¸€ä¸ª`<p>`æ ‡ç­¾ã€‚

æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„`Text`ç»„ä»¶`fontSize`ä½œä¸º`5xl`ï¼Œå¹¶æŠŠå®ƒå¯¹é½ä¸­å¿ƒã€‚

æˆ‘ä»¬ä¹ŸæŠŠæ•´ä¸ªä¸œè¥¿åŒ…åœ¨`ThemeProvider`é‡Œé¢ã€‚`ThemeProvider`è®©æˆ‘ä»¬é€šè¿‡å°†`theme`å¯¹è±¡ä½œä¸ºé“å…·ä¼ å…¥æ¥ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ªä¸»é¢˜ã€‚Chakra UI æœ‰ä¸€ä¸ªé»˜è®¤çš„ä¸»é¢˜ï¼Œå¦‚æœæˆ‘ä»¬åœ¨ç»„ä»¶ä¸ŠåŒ…è£…`ThemeProvider`ï¼Œå°±ä¼šçœ‹åˆ°è¿™ä¸ªä¸»é¢˜ã€‚å¸ƒå±€ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·:

![Streaks App - Chakra UI Init](../Images/fa885c519e1e86e6bffc3f50970f2782.png)

å°è¯•ç§»é™¤`ThemeProvider`ä»¥æŸ¥çœ‹å®ƒå¦‚ä½•å½±å“å¸ƒå±€ã€‚çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

![Streaks App - Chakra UI Init Remove ThemeProvider](../Images/6226da745f7ec8b6c146bd645709903d.png)

æŠŠå®ƒæ”¾å›å»ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç¼–å†™æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚

ç°åœ¨ç»§ç»­åˆ›å»ºä¸€ä¸ª`components`å’Œä¸€ä¸ª`graphql`æ–‡ä»¶å¤¹:

```
$ mkdir components graphql 
```

è¿›å…¥`graphql`æ–‡ä»¶å¤¹ï¼Œåˆ›å»ºåä¸º`createHabit.js`ã€`deleteHabit.js`ã€`incrementStreak.js`ã€`listAllHabits.js`å’Œ`index.js`çš„æ–‡ä»¶ã€‚

```
$ cd graphql
$ touch createHabit.js deleteHabit.js incrementStreak.js listAllHabits.js index.js 
```

### åˆ—å‡ºæ‰€æœ‰ä¹ æƒ¯æŸ¥è¯¢

æ‰“å¼€`listAllHabits.js`å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import gql from 'graphql-tag'

export const LIST_ALL_HABITS_QUERY = gql` query listAllHabits {
    habits {
      id
      name
      streak
    }
  } ` 
```

æ³¨æ„ï¼Œä¸Šé¢çš„`query`ç±»ä¼¼äºæˆ‘ä»¬åœ¨ GraphiQL ç¼–è¾‘å™¨ä¸­è¾“å…¥çš„å†…å®¹ã€‚è¿™å°±æ˜¯ GraphQL çš„ä½¿ç”¨æ–¹æ³•ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ GraphiQL ç¼–è¾‘å™¨ä¸­é”®å…¥`query`æˆ–`mutation`,çœ‹çœ‹å®ƒæ˜¯å¦ç»™å‡ºäº†æˆ‘ä»¬éœ€è¦çš„æ•°æ®ï¼Œç„¶åæˆ‘ä»¬å°†å®ƒå¤åˆ¶ç²˜è´´åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚

### åˆ›é€ ä¹ æƒ¯çªå˜

åœ¨`createHabit.js`å†…ï¼Œç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import gql from 'graphql-tag'

export const CREATE_HABIT_MUTATION = gql` mutation createHabit($name: String!, $streak: Int!) {
    createHabit(data: { name: $name, streak: $streak }) {
      id
      name
      streak
    }
  } ` 
```

æˆ‘ä»¬å†æ¬¡ä»ä¸Šé¢çš„ GraphiQL ç¼–è¾‘å™¨ä¸­å¤åˆ¶äº†`mutation`ã€‚ä¸»è¦çš„åŒºåˆ«æ˜¯æˆ‘ä»¬ç”¨ä¸€ä¸ªç”±`$`æ ‡æ³¨çš„å˜é‡æ›¿æ¢äº†ç¡¬ç¼–ç çš„å€¼ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è¾“å…¥ç”¨æˆ·æŒ‡å®šçš„ä»»ä½•å†…å®¹ã€‚ä¸Šé¢çš„çªå˜å°†è¢«ç”¨æ¥åˆ›é€ ä¸€ç§ä¹ æƒ¯ã€‚

### åˆ é™¤ä¹ æƒ¯çªå˜

åœ¨`deleteHabit.js`ä¸­ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import gql from 'graphql-tag'

export const DELETE_HABIT_MUTATION = gql` mutation deleteHabit($id: ID!) {
    deleteHabit(where: { id: $id }) {
      id
      name
      streak
    }
  } ` 
```

ä¸Šé¢çš„çªå˜ä¼šè¢«ç”¨æ¥åˆ é™¤ä¸€ä¸ªä¹ æƒ¯ã€‚

### å¢é‡æ¡çº¹çªå˜

åœ¨`incrementStreak.js`ä¸­ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import gql from 'graphql-tag'

export const INCREMENT_STREAK_MUTATION = gql` mutation incrementStreak($name: String) {
    incrementStreak(name: $name) {
      streak
    }
  } ` 
```

ä¸Šè¿°çªå˜å°†ç”¨äºå¢åŠ ç»™å®šä¹ æƒ¯çš„æ¡çº¹ã€‚

æœ€åï¼Œä¸ºäº†ä½¿ä»ä¸€ä¸ªæ–‡ä»¶ä¸­`import`æ‰€æœ‰å†…å®¹å˜å¾—å®¹æ˜“ï¼Œåœ¨`index.js`ä¸­ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
export * from './createHabit'
export * from './deleteHabit'
export * from './incrementStreak'
export * from './listAllHabits' 
```

è¿™è®©æˆ‘ä»¬å¯ä»¥ä»ä¸€ä¸ªæ–‡ä»¶è€Œä¸æ˜¯å››ä¸ªä¸åŒçš„æ–‡ä»¶ä¸­è·å–ä¿¡æ¯ã€‚å½“æˆ‘ä»¬æœ‰ 10 ä¸ª`queries`å’Œ`mutations`æ—¶ï¼Œè¿™æ˜¯æœ‰ç›Šçš„ã€‚

ç°åœ¨è¿›å…¥`components/`ç›®å½•ï¼Œåˆ›å»ºåä¸º`CreateHabit.js`ã€`DeleteHabit.js`ã€`Habit.js`ã€`ListAllHabits.js`å’Œ`index.js`çš„æ–‡ä»¶ã€‚

```
$ cd ../components/
$ touch CreateHabit.js DeleteHabit.js Habit.js ListAllHabits.js index.js 
```

æˆ‘ä»¬å°†åœ¨æœ¬æ•™ç¨‹çš„åé¢è§¦åŠå…¶ä½™çš„æ–‡ä»¶ï¼Œä½†ç°åœ¨æ‰“å¼€`index.js`å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
export * from './Common/Error'
export * from './Common/Loading'
export * from './CreateHabit'
export * from './DeleteHabit'
export * from './Habit'
export * from './ListAllHabits' 
```

ç°åœ¨åˆ›å»ºä¸€ä¸ª`Common/`æ–‡ä»¶å¤¹ï¼Œåœ¨é‡Œé¢åˆ›å»º`Loading.js`å’Œ`Error.js`:

```
$ mkdir Common && cd $_
$ touch Loading.js Error.js 
```

`cd $_`å…è®¸æˆ‘ä»¬åœ¨`Common`ç›®å½•åˆ›å»ºåç«‹å³è¿›å…¥å®ƒã€‚ç„¶åæˆ‘ä»¬åœ¨é‡Œé¢åˆ›å»º`Loading.js`å’Œ`Error.js`ã€‚

ç°åœ¨åœ¨`src/`ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`utils/`æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªæ–‡ä»¶â€”â€”`getIcon.js`å’Œ`index.js`:

```
$ cd ../../
$ mkdir utils/ && cd $_
$ touch getIcon.js index.js 
```

### ä¸ºä¹ æƒ¯åˆ›å»ºå›¾æ ‡

ç°åœ¨æ‰“å¼€`getIcon.js`å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import { AiOutlineQuestion } from 'react-icons/ai'
import { FaCode, FaRunning, FaSwimmer } from 'react-icons/fa'
import { FiPhoneCall } from 'react-icons/fi'
import {
  GiCycling,
  GiMeditation,
  GiMuscleUp,
  GiTennisRacket,
} from 'react-icons/gi'
import { MdSmokeFree } from 'react-icons/md'

const icons = [
  {
    keywords: ['call', 'phone'],
    pic: FiPhoneCall,
  },
  {
    keywords: ['workout', 'muscle', 'body-building', 'body building'],
    pic: GiMuscleUp,
  },
  {
    keywords: ['cycling', 'cycle'],
    pic: GiCycling,
  },
  {
    keywords: ['running', 'run'],
    pic: FaRunning,
  },
  {
    keywords: ['swimming', 'swim'],
    pic: FaSwimmer,
  },
  {
    keywords: ['racket', 'tennis', 'badminton'],
    pic: GiTennisRacket,
  },
  {
    keywords: [
      'smoke',
      'smoking',
      'no smoking',
      'no-smoking',
      'smoke free',
      'no smoke',
    ],
    pic: MdSmokeFree,
  },
  {
    keywords: ['code', 'code everyday', 'program', 'programming'],
    pic: FaCode,
  },
  {
    keywords: ['meditate', 'meditation'],
    pic: GiMeditation,
  },
]

export const getIcon = name => {
  let icon = AiOutlineQuestion
  for (let i = 0; i < icons.length; i++) {
    const { keywords, pic } = icons[i]
    const lowerCaseName = name.toLowerCase()
    const doesKeywordExistInName = keywords.some(keyword =>
      lowerCaseName.includes(keyword),
    )
    if (doesKeywordExistInName) {
      icon = pic
      break
    }
  }

  return icon
} 
```

è¿™æ˜¯ä¸€ä¸ªå¸®åŠ©æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ä¸ªåä¸º`getIcon`çš„å‡½æ•°ã€‚å®ƒæ¥å—ä¸€ä¸ªä¹ æƒ¯åå¹¶è¿”å›ä¸€ä¸ªåˆé€‚çš„å›¾æ ‡ã€‚è¦æ·»åŠ æ›´å¤šçš„å›¾æ ‡ï¼Œéœ€è¦ç”¨åˆé€‚çš„`keywords`å’Œ`pic`å‘`icons`æ•°ç»„æ·»åŠ ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ä»[çš„ react-icons](https://react-icons.netlify.com/) å¯¼å…¥ã€‚

è®©æˆ‘ä»¬ä»`index.js`å¯¼å…¥è¿™ä¸ªå‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°å¯¼å…¥å®ƒï¼Œè€Œä¸å¿…è®°ä½æ–‡ä»¶åã€‚è¿™åœ¨è¿™é‡Œå¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œä½†æ˜¯å½“åº”ç”¨ç¨‹åºå˜å¤§æ—¶ï¼Œè¿™æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚

æ‰“å¼€`index.js`å¹¶ç²˜è´´ä»¥ä¸‹ä¸€è¡Œç¨‹åº:

```
export * from './getIcon' 
```

ç»§ç»­æ‰“å¼€`Loading.js`å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import { Flex, Spinner } from '@chakra-ui/core'
import React from 'react'

export const Loading = () => (
  <Flex justify='center' flexWrap='wrap'>
    <Spinner
      thickness='4px'
      speed='0.65s'
      emptyColor='gray.200'
      color='blue.800'
      size='xl'
    />
  </Flex>
) 
```

æˆ‘ä»¬å±•ç¤ºäº†ä¸€ä¸ªä» Chakra UI åº“ä¸­å¯¼å…¥çš„æ¼‚äº®çš„`Spinner`ã€‚æˆ‘ä»¬å°†å®ƒå°è£…åœ¨ä¸€ä¸ª`Flex`ç»„ä»¶ä¸­ï¼Œè¿™ä½¿å¾—æ— éœ€ç¼–å†™ CSS å°±å¯ä»¥è½»æ¾åº”ç”¨ Flexboxã€‚åœ¨æˆ‘çœ‹æ¥ï¼ŒChakra å¯ä»¥è½»æ¾åœ°æ›´å¿«åœ°åˆ¶ä½œæ¼‚äº®çš„åº”ç”¨ç¨‹åºï¼Œè€Œä¸å¿…ç¼–å†™è‡ªå®šä¹‰çš„ CSSã€‚

ç°åœ¨æ‰“å¼€`Error.js`å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import {
  Alert,
  AlertDescription,
  AlertIcon,
  AlertTitle,
  Flex,
} from '@chakra-ui/core'
import React from 'react'

export const Error = () => (
  <Flex justify='center' flexWrap='wrap'>
    <Alert status='error'>
      <AlertIcon />
      <AlertTitle mr={2}>Whoops,</AlertTitle>
      <AlertDescription>
        there has been an error. Please try again later!
      </AlertDescription>
    </Alert>
  </Flex>
) 
```

è¿™é‡Œï¼Œæˆ‘ä»¬æ˜¾ç¤ºä¸€ä¸ªé”™è¯¯æ¡†ã€‚ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ Chakra UI æ–‡æ¡£ä¸­æ‰¾åˆ°ä¸Šé¢çš„ä»£ç ã€‚è¿™é‡Œæ²¡æœ‰ç«ç®­ç§‘å­¦ã€‚åªæ˜¯ç®€å•çš„å¤åˆ¶ç²˜è´´ã€‚

### è¡¨ç°å‡ºå•ä¸€çš„ä¹ æƒ¯

æ‰“å¼€`Habit.js`å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import { Badge, Box, Flex, Text } from '@chakra-ui/core'
import React from 'react'
import { useMutation } from 'urql'
import { INCREMENT_STREAK_MUTATION } from '../graphql/index'
import { getIcon } from '../utils/index'

const colors = [
  'tomato',
  'green.400',
  'yellow.300',
  'cornflowerblue',
  'antiquewhite',
  'aquamarine',
  'lightpink',
  'navajowhite',
  'red.500',
  'lightcoral'
]

export const Habit = ({ index, habit }) => {
  const { id, name, streak } = habit
  const bgColor = colors[index % colors.length]
  const [res, executeMutation] = useMutation(INCREMENT_STREAK_MUTATION) // eslint-disable-line no-unused-vars

  return (
    <Flex
      align='center'
      justify='flex-end'
      direction='column'
      bg={bgColor}
      width='300px'
      height='300px'
      borderRadius='40px'
      margin='16px'
      padding='16px'
    >
      <Box as={getIcon(name)} size='144px' />
      <Text fontWeight='hairline' fontSize='3xl' textAlign='center'>
        {name}
        <Badge
          as='span'
          fontWeight='hairline'
          fontSize='xl'
          rounded='full'
          mx='2'
          px='3'
          textTransform='lowercase'
          cursor='pointer'
          onClick={() => executeMutation({ name })}
        >
          {streak}
        </Badge>
      </Text>
    </Flex>
  )
} 
```

`Habit`ç»„ä»¶æ˜¾ç¤ºä¸€ä¸ªå¸¦æœ‰`streak`å¾½ç« çš„`habit`ã€‚å®ƒåŒ…æ‹¬`index`å’Œ`habit`ã€‚æˆ‘ä»¬ä½¿ç”¨`index`æ¥æ—‹è½¬æ¥è‡ª`colors`æ•°ç»„çš„`habit`çš„èƒŒæ™¯é¢œè‰²ã€‚ä¸€æ—¦æ˜¾ç¤ºæœ€åä¸€ç§é¢œè‰²ï¼Œå®ƒå°†è¿”å›åˆ°ç¬¬ä¸€ç§é¢œè‰²ã€‚

åœ¨`Flex`ç»„ä»¶ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨å¸¦æœ‰`as`é“å…·çš„`Box`ç»„ä»¶æ¥æ˜¾ç¤ºä¸€ä¸ª`icon`ã€‚`as`å±æ€§ç”¨äºå°†`Box`ç»„ä»¶çš„é»˜è®¤`div`æ›¿æ¢ä¸º`as`å±æ€§ä¸­æŒ‡å®šçš„ä»»ä½•å†…å®¹ã€‚æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ç”¨`getIcon`çš„è¿”å›å€¼æ›¿æ¢å®ƒï¼Œå®ƒæ˜¯æ¥è‡ª`react-icons`çš„ä¸€ä¸ª`icon`ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨`Text`ç»„ä»¶ä¸­æ˜¾ç¤º`name`ï¼Œå¹¶ç”¨`Badge`ç»„ä»¶åŒ…è£…`streak`ã€‚å½“ç‚¹å‡»`streak`æ—¶ï¼Œè°ƒç”¨`INCREMENT_STREAK_MUTATION`ï¼Œæˆ‘ä»¬å·²ç»åœ¨ä¸Šé¢ç”¨`urql`çš„`useMutation`å‡½æ•°å®šä¹‰äº†å®ƒã€‚æˆ‘ä»¬å°†é€‚å½“çš„ä¹ æƒ¯`name`ä¼ é€’ç»™å‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¢åŠ ç‰¹å®šçš„ä¹ æƒ¯ã€‚

### æ˜¾ç¤ºä¹ æƒ¯åˆ—è¡¨

æ‰“å¼€`ListAllHabits.js`å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import { Flex, Text } from '@chakra-ui/core'
import React from 'react'
import { useQuery } from 'urql'
import { LIST_ALL_HABITS_QUERY } from '../graphql/index'
import { Error, Habit, Loading } from './index'

export const ListAllHabits = () => {
  const [{ fetching, error, data }] = useQuery({ query: LIST_ALL_HABITS_QUERY })

  if (fetching) return <Loading />
  if (error) return <Error />
  const noHabits = !data.habits.length

  return (
    <Flex
      justify='center'
      align='center'
      flexWrap='wrap'
      flexDirection={noHabits ? 'column' : 'row'}
    >
      {noHabits && (
        <Text fontWeight='bold' fontSize='3xl' color='tomato'>
          You currently track 0 habits. Add one.
        </Text>
      )}
      {data.habits.map((habit, i) => (
        <Habit key={habit.id} index={i} habit={habit} />
      ))}
    </Flex>
  )
} 
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡ä¼ å…¥`LIST_ALL_HABITS_QUERY`è°ƒç”¨`urql`çš„`useQuery`å‡½æ•°æ¥è·å–æ‰€æœ‰çš„ä¹ æƒ¯ã€‚å®ƒè¿”å›`fetching`ã€`error`å’Œ`data`ã€‚

å½“`fetching`ä¸º`true`æ—¶ï¼Œæˆ‘ä»¬æ˜¾ç¤º`Loading`ç»„ä»¶ï¼Œå®ƒæ˜¾ç¤º`Spinner`ã€‚

å½“`error`ä¸º`true`æ—¶ï¼Œæˆ‘ä»¬æ˜¾ç¤º`Error`ç»„ä»¶ï¼Œå®ƒæ˜¾ç¤ºä¸€ä¸ª`Alert`ã€‚

ç¨åï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦å­˜åœ¨ä»»ä½•`habits`ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•`habits`ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ˜¾ç¤º`You currently track 0 habits. Add one.`

![Streaks App - No Habits](../Images/cc56b73bbc630cad0745933577251a52.png)

å¦‚æœæˆ‘ä»¬æœ‰ä»»ä½•`habits`ï¼Œæˆ‘ä»¬æ˜¾ç¤ºå®ƒä»¬ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·:

![Streaks App - List Habits](../Images/c8b5621714738fa7fec4bd40c5c23587.png)

å°è¯•ç‚¹å‡»`streak`å¾½ç« ï¼Œçœ‹å®ƒå¢åŠ ã€‚

### æ”¹æ‰ä¸€ä¸ªä¹ æƒ¯

ç°åœ¨ï¼Œæ‰“å¼€`DeleteHabit.js`å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import {
  AlertDialog,
  AlertDialogBody,
  AlertDialogContent,
  AlertDialogFooter,
  AlertDialogHeader,
  AlertDialogOverlay,
  Button,
  IconButton,
} from '@chakra-ui/core'
import React from 'react'
import { useMutation } from 'urql'
import { DELETE_HABIT_MUTATION } from '../graphql/index'

export const DeleteHabit = ({ id, name }) => {
  const [isOpen, setIsOpen] = React.useState()
  const onClose = () => setIsOpen(false)
  const cancelRef = React.useRef()

  const [res, executeMutation] = useMutation(DELETE_HABIT_MUTATION) // eslint-disable-line no-unused-vars

  const deleteHabit = () => {
    executeMutation({ id })
    onClose()
  }
  return (
    <>
      <IconButton
        variantColor='red'
        border='1px solid white'
        aria-label='Delete Habit'
        size='md'
        icon='delete'
        cursor='pointer'
        onClick={() => setIsOpen(true)}
      />
      <AlertDialog
        isOpen={isOpen}
        leastDestructiveRef={cancelRef}
        onClose={onClose}
      >
        <AlertDialogOverlay />
        <AlertDialogContent>
          <AlertDialogHeader fontSize='lg' fontWeight='bold'>
            Delete â€œ{name}â€ Habit
          </AlertDialogHeader>

          <AlertDialogBody>
            Are you sure? You can't undo this action afterwards.
          </AlertDialogBody>

          <AlertDialogFooter>
            <Button ref={cancelRef} onClick={onClose}>
              Cancel
            </Button>
            <Button variantColor='red' onClick={deleteHabit} ml={3}>
              Delete
            </Button>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    </>
  )
} 
```

è¿™äº›ä»£ç å¤§éƒ¨åˆ†æ˜¯ä» Chakra UI çš„ [AlertDialog](https://chakra-ui.com/alertdialog) ä¸­æŠ“å–çš„ã€‚è¿™ä¸ªç»„ä»¶çš„ä¸»è¦ç›®çš„æ˜¯æ˜¾ç¤ºä¸€ä¸ª`trash`å›¾æ ‡ï¼Œå½“ç‚¹å‡»å®ƒæ—¶ï¼Œç”¨ä¸¤ä¸ªæŒ‰é’®`Cancel`å’Œ`Delete`æé†’ä¸€ä¸ªæ¨¡æ€ã€‚ç‚¹å‡»`Cancel`ï¼Œè°ƒç”¨`onClose`å‡½æ•°ï¼Œä½¿æ¨¡æ€æ¶ˆå¤±ï¼Œç‚¹å‡»`Delete`ï¼Œè°ƒç”¨`deleteHabit`å‡½æ•°ã€‚

`deleteHabit`å‡½æ•°è°ƒç”¨`DELETE_HABIT_MUTATION`ï¼ŒåŒæ—¶å°†ä»çˆ¶ç»„ä»¶è·å¾—çš„`id`ä¼ é€’ç»™å®ƒï¼Œå¹¶é€šè¿‡è°ƒç”¨`onClose`å…³é—­æ¨¡æ€ã€‚

ç°åœ¨å†æ¬¡æ‰“å¼€`Habit.js`ï¼Œå°†ä»¥ä¸‹å¯¼å…¥æ·»åŠ åˆ°é¡¶éƒ¨:

```
import { DeleteHabit } from './index' 
```

ç°åœ¨ï¼Œåœ¨å…³é—­`Badge`ç»„ä»¶çš„ä¸‹æ–¹ï¼Œæ·»åŠ ä»¥ä¸‹ä»£ç :

```
<DeleteHabit id={id} name={name} /> 
```

æ•´ä¸ª`Habit.js`æ–‡ä»¶ç°åœ¨åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·:

```
import { Badge, Box, Flex, Text } from '@chakra-ui/core'
import React from 'react'
import { useMutation } from 'urql'
import { INCREMENT_STREAK_MUTATION } from '../graphql/index'
import { getIcon } from '../utils/index'
import { DeleteHabit } from './index'

const colors = [
  'tomato',
  'green.400',
  'yellow.300',
  'cornflowerblue',
  'antiquewhite',
  'aquamarine',
  'lightpink',
  'navajowhite',
  'red.500',
  'lightcoral'
]

export const Habit = ({ index, habit }) => {
  const { id, name, streak } = habit
  const bgColor = colors[index % colors.length]
  const [res, executeMutation] = useMutation(INCREMENT_STREAK_MUTATION) // eslint-disable-line no-unused-vars

  return (
    <Flex
      align='center'
      justify='flex-end'
      direction='column'
      bg={bgColor}
      width='300px'
      height='300px'
      borderRadius='40px'
      margin='16px'
      padding='16px'
    >
      <Box as={getIcon(name)} size='144px' />
      <Text fontWeight='hairline' fontSize='3xl' textAlign='center'>
        {name}
        <Badge
          as='span'
          fontWeight='hairline'
          fontSize='xl'
          rounded='full'
          mx='2'
          px='3'
          textTransform='lowercase'
          cursor='pointer'
          onClick={() => executeMutation({ name })}
        >
          {streak}
        </Badge>
        <DeleteHabit id={id} name={name} />
      </Text>
    </Flex>
  )
} 
```

å®ƒç°åœ¨åº”è¯¥æ˜¯è¿™æ ·çš„:

![Streaks App - Delete Habit](../Images/87f88c12d6b09da25769406e96413fd2.png)

ç°åœ¨è¯•ç€ç‚¹å‡»ä»»ä½•ä¹ æƒ¯ä¸Šçš„`trash`å›¾æ ‡ã€‚å®ƒåº”è¯¥æ‰“å¼€ä¸€ä¸ªæ¨¡å¼ï¼Œå¦‚ä¸‹æ‰€ç¤º:

![Streaks App - Delete Habit Show Modal](../Images/6066121aef40a984e8b05fa512744052.png)

å¦‚æœä½ ç‚¹å‡»*å–æ¶ˆ*ï¼Œå®ƒå°†å…³é—­æ¨¡æ€ã€‚å¦‚æœæ‚¨ç‚¹å‡»*åˆ é™¤*ï¼Œè¯¥ä¹ æƒ¯å°†ä»ç”¨æˆ·ç•Œé¢å’Œ Prisma æ•°æ®åº“ä¸­åˆ é™¤ï¼Œå¦‚ä¸‹æ‰€ç¤º:

![Streaks App - Delete Habit Workout](../Images/4b3d179e788fdd2a3110d4e223f17fb3.png)

### å…»æˆä¹ æƒ¯

ç°åœ¨è®©æˆ‘ä»¬æ‰“å¼€`CreateHabit.js`å¹¶ç²˜è´´ä»¥ä¸‹å†…å®¹:

```
import {
  Button,
  Flex,
  FormControl,
  FormLabel,
  Icon,
  Input,
  Modal,
  ModalBody,
  ModalCloseButton,
  ModalContent,
  ModalFooter,
  ModalHeader,
  ModalOverlay,
  useDisclosure,
} from '@chakra-ui/core'
import composeRefs from '@seznam/compose-react-refs'
import React, { useRef } from 'react'
import useForm from 'react-hook-form'
import { useMutation } from 'urql'
import { CREATE_HABIT_MUTATION } from '../graphql/index'

export const CreateHabit = () => {
  const { handleSubmit, register } = useForm()
  const { isOpen, onOpen, onClose } = useDisclosure()
  const [res, executeMutation] = useMutation(CREATE_HABIT_MUTATION) // eslint-disable-line no-unused-vars

  const initialRef = useRef()
  const finalRef = useRef()

  const onSubmit = (values, e) => {
    const { name, streak } = values
    executeMutation({
      name,
      streak: +streak,
    })
    e.target.reset()
    onClose()
  }

  return (
    <Flex
      width='300px'
      height='300px'
      borderRadius='40px'
      margin='16px'
      padding='16px'
      justify='center'
      flexWrap='wrap'
    >
      <Icon
        name='small-add'
        onClick={onOpen}
        fontSize='300px'
        cursor='pointer'
      />
      <Modal
        initialFocusRef={initialRef}
        finalFocusRef={finalRef}
        isOpen={isOpen}
        onClose={onClose}
      >
        <ModalOverlay />
        <ModalContent>
          <ModalHeader>Create Habit</ModalHeader>
          <ModalCloseButton />
          <form onSubmit={handleSubmit(onSubmit)}>
            <ModalBody pb={6}>
              <FormControl>
                <FormLabel htmlFor='name'>Habit name</FormLabel>
                <Input
                  name='name'
                  ref={composeRefs(initialRef, register)}
                  placeholder='Enter your habit'
                  width='90%'
                />
              </FormControl>

              <FormControl mt={4}>
                <FormLabel htmlFor='streak'>Streak</FormLabel>
                <Input
                  name='streak'
                  type='number'
                  placeholder='Enter your streak'
                  width='90%'
                  ref={register}
                />
              </FormControl>
            </ModalBody>

            <ModalFooter>
              <Button
                type='submit'
                rounded='md'
                bg='green.500'
                color='white'
                mr={3}
              >
                Save
              </Button>
              <Button onClick={onClose}>Cancel</Button>
            </ModalFooter>
          </form>
        </ModalContent>
      </Modal>
    </Flex>
  )
} 
```

åŒæ ·ï¼Œå¤§éƒ¨åˆ†å†…å®¹æ˜¯ä» Chakra UI çš„ [FormControl](https://chakra-ui.com/formcontrol) ä¸­å¤åˆ¶çš„ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å‘ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ª`+`å›¾æ ‡ï¼Œå®ƒæ¥è‡ª Chakra è‡ªå·±çš„[å›¾æ ‡](https://chakra-ui.com/icon)ç»„ä»¶ã€‚

å½“ç‚¹å‡»`+`å›¾æ ‡æ—¶ï¼Œæˆ‘ä»¬æ‰“å¼€ä¸€ä¸ªä½¿ç”¨[ååº”é’©å­å½¢å¼](https://react-hook-form.com/)çš„æ¨¡æ€ã€‚

React é’©å­è¡¨å•æ˜¯ç”¨é’©å­æ„å»ºè¡¨å•çš„æœ€ç®€å•çš„æ–¹æ³•ã€‚æˆ‘ä»¬åªéœ€è¦å°†`register`ä¼ é€’ç»™æˆ‘ä»¬æƒ³è¦è·Ÿè¸ªçš„`input`çš„`ref`ã€‚å½“æˆ‘ä»¬ä»`react-hook-form`è°ƒç”¨é’©å­`useForm`æ—¶ï¼Œæˆ‘ä»¬å¾—åˆ°`register`ã€‚æˆ‘ä»¬è¿˜è·å¾—äº†`handleSubmit`ï¼Œæˆ‘ä»¬éœ€è¦å°†å®ƒä¼ é€’ç»™`form`ç»„ä»¶ã€‚æˆ‘ä»¬éœ€è¦ä¼ é€’`handleSubmit`ä¸€ä¸ªå‡½æ•°ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’`onSubmit`å¹¶ä¸”è¿™ä¸ªå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°`values`æ˜¯æˆ‘ä»¬å¾—åˆ°çš„å€¼ï¼Œè¿™äº›å€¼æ˜¯ç”¨æˆ·è¾“å…¥çš„ã€‚

è¿™é‡Œéœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬ä½¿ç”¨æ¥è‡ª`@seznam/compose-react-refs`çš„`composeRefs`æ¥ç»„æˆå¤šä¸ª refsã€‚è¿™æ˜¯å¿…éœ€çš„ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æä¾›`register` ref æ¥æ³¨å†Œæˆ‘ä»¬çš„ React é’©å­è¡¨å•å¹¶è·Ÿè¸ªè¯¥å€¼ã€‚ç¬¬äºŒä¸ª ref `initialRef`æ˜¯éœ€è¦çš„ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å®ƒåœ¨å¼¹å‡ºçª—å£ä¸€å‡ºç°å°±å…³æ³¨ç¬¬ä¸€ä¸ªè¾“å…¥ã€‚å¯¹äºä½¿ç”¨å±å¹•é˜…è¯»å™¨çš„äººæ¥è¯´ï¼Œè¿™å¯¹äºè¾…åŠ©åŠŸèƒ½ä¹Ÿæ˜¯å¿…è¦çš„ã€‚

æœ€åï¼Œå½“æˆ‘ä»¬è°ƒç”¨`onSubmit`æ—¶ï¼Œæˆ‘ä»¬æ£€æŸ¥å®ƒæ˜¯å¦ä¸ä¸ºç©ºï¼Œç„¶åæˆ‘ä»¬ç”¨ä¸¤ä¸ªå‚æ•°`name`å’Œ`streak`è°ƒç”¨çªå˜ã€‚`+streak`è¡¨ç¤º`String`è¢«å¼ºåˆ¶ä¸º`Number`ã€‚åŸºæœ¬ä¸Šï¼Œä» React é’©å­è¡¨å•è¿”å›çš„æ‰€æœ‰å€¼éƒ½æ˜¯`strings`ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„åç«¯ï¼Œæˆ‘ä»¬æœŸå¾…çš„æ˜¯`number`ã€‚

æœ€åï¼Œæˆ‘ä»¬`reset`è¡¨å•æ¥æ¸…é™¤æ‰€æœ‰çš„å€¼å’Œè¾“å…¥çŠ¶æ€ã€‚ç„¶åæˆ‘ä»¬å…³é—­æ¨¡æ€ã€‚

ç°åœ¨ç»§ç»­å°†`CreateHabit`å¯¼å…¥é¡¶éƒ¨çš„`ListAllHabits.js`:

```
import { CreateHabit, Error, Habit, Loading } from './index' 
```

æ­¤å¤–ï¼Œç¡®ä¿å°†å®ƒåŒ…å«åœ¨æ‚¨ä½¿ç”¨`Array.map()`åˆ—å‡ºæ‰€æœ‰ä¹ æƒ¯çš„ä¸Šæ–¹ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
<CreateHabit /> 
```

`ListAllHabits.js`æ–‡ä»¶ç°åœ¨å¿…é¡»çœ‹èµ·æ¥åƒè¿™æ ·:

```
import { Flex, Text } from '@chakra-ui/core'
import React from 'react'
import { useQuery } from 'urql'
import { LIST_ALL_HABITS_QUERY } from '../graphql/index'
import { CreateHabit, Error, Habit, Loading } from './index'

export const ListAllHabits = () => {
  const [{ fetching, error, data }] = useQuery({ query: LIST_ALL_HABITS_QUERY })

  if (fetching) return <Loading />
  if (error) return <Error />
  const noHabits = !data.habits.length

  return (
    <Flex
      justify='center'
      align='center'
      flexWrap='wrap'
      flexDirection={noHabits ? 'column' : 'row'}
    >
      {noHabits && (
        <Text fontWeight='bold' fontSize='3xl' color='tomato'>
          You currently track 0 habits. Add one.
        </Text>
      )}
      <CreateHabit />
      {data.habits.map((habit, i) => (
        <Habit key={habit.id} index={i} habit={habit} />
      ))}
    </Flex>
  )
} 
```

å®ƒç°åœ¨åº”è¯¥æ˜¾ç¤ºå¦‚ä¸‹çš„`+`ç¬¦å·:

![Streaks App - Plus Sign](../Images/7a5e9aa494b58c671716ddb872addd90.png)

ç°åœ¨ç‚¹å‡»`+`ç¬¦å·ï¼Œæ·»åŠ æˆ‘ä»¬åˆ é™¤çš„å¸¦æœ‰`50`æ¡çº¹çš„`Workout`ä¹ æƒ¯ã€‚

![Streaks App - Add Workout Habit](../Images/18072fc068e792e99db6b46470813e79.png)

ä¸€æ—¦ä½ ç‚¹å‡»`Save`ï¼Œæ³¨æ„å®ƒä¼šç«‹å³è¢«æ·»åŠ ã€‚

![Streaks App - Workout Habit 50 Streak](../Images/a544718e9487964de53c5a04deed0dc0.png)

ä½ å¯ä»¥æ·»åŠ ä¸€å †ä½ æƒ³è¿½è¸ªçš„å…¶ä»–ä¹ æƒ¯ã€‚æ·»åŠ äº†ä¸€å †ä¹ æƒ¯ä¹‹åï¼Œç°åœ¨çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

![treaks App - Complete](../Images/3864298b2d050fd454d9c0e56abda474.png)

## ç»“è®º

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä»å¤´å¼€å§‹æ„å»ºäº†ä¸€ä¸ªå®Œæ•´çš„ä¹ æƒ¯è·Ÿè¸ªå™¨åº”ç”¨ç¨‹åºâ€œStreaksâ€ã€‚æˆ‘ä»¬ä½¿ç”¨ [Chakra UI](https://chakra-ui.com/) ä½œä¸ºæˆ‘ä»¬çš„ React ç»„ä»¶åº“æ¥å¿«é€Ÿåˆ¶ä½œä¸€ä¸ªæ¼‚äº®çš„ã€å¯è®¿é—®çš„åº”ç”¨ç¨‹åºã€‚Chakra UI é€šè¿‡æ·»åŠ å†…ç½®çš„æ„å»ºæ¨¡å—å¸®åŠ©æˆ‘ä»¬åˆ›å»ºè­¦æŠ¥ã€æ¨¡æ€å’Œå¾®è°ƒå™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä¸“æ³¨äºç¼–å†™é€»è¾‘è€Œä¸æ˜¯ç¼–å†™ CSSã€‚

æˆ‘ä»¬ä½¿ç”¨çš„ [React é’©å­æ¥åˆ›å»ºç®€å•æ˜“ç”¨çš„è¡¨å•ã€‚å®ƒè®©æˆ‘ä»¬ä¸ç”¨å†™å¾ˆå¤šä»£ç å°±èƒ½ä¿æŒè¡¨å•çš„ç®€æ´ã€‚](https://react-hooks-form.com/)

åœ¨æˆ‘ä»¬çš„åç«¯ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Prisma æ¡†æ¶ã€‚æˆ‘ä»¬ä½¿ç”¨ Prisma è‡ªå·±çš„[å…‰å­](https://photonjs.prisma.io/)æ¥å£°æ˜æ€§åœ°åˆ›å»ºæ•°æ®æ¨¡å‹ï¼Œä½¿ç”¨ [Lift](https://lift.prisma.io/) æ¥æ‰§è¡Œæ•°æ®åº“è¿ç§»ã€‚Prisma é€šè¿‡ä½¿ç”¨é™æ€ç±»å‹ä½¿æŸ¥è¯¢æ•°æ®åº“å˜å¾—ç®€å•ï¼Œè¿™ä½¿æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒåœ°ç¼–ç ã€‚å†…ç½®çš„è‡ªåŠ¨å®ŒæˆåŠŸèƒ½å…è®¸æˆ‘ä»¬ä»¥é—ªç”µèˆ¬çš„é€Ÿåº¦ç¼–å†™åº”ç”¨ç¨‹åºã€‚

å½“ Prisma æ¡†æ¶å¤„äºæµ‹è¯•é˜¶æ®µæ—¶ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ä¸šä½™é¡¹ç›®ä¸­äº«å—å®ƒçš„ä¹è¶£ã€‚å¾ˆå¿«å°±å‡ºæ¥äº†ï¼Œæ•¬è¯·å…³æ³¨ã€‚

ç°åœ¨ï¼Œæ‚¨å¯ä»¥æ”¾å¿ƒåœ°åˆ›å»ºè‡ªå·±çš„å…¨æ ˆåº”ç”¨äº†ã€‚

## åˆ†äº«è¿™ç¯‡æ–‡ç« 