# åœ¨ Swift 3 ä¸­é€šè¿‡ NSNotification åœ¨ ViewControllers ä¹‹é—´ä¼ é€’æ•°æ®

> åŸæ–‡:[https://www . site point . com/pass-data-with-ns notification-between-view controllers-in-swift-3/](https://www.sitepoint.com/pass-data-with-nsnotification-between-viewcontrollers-in-swift-3/)

*æœ¬æ–‡æœ€åˆå‘è¡¨äº [iOS æå®¢ç¤¾åŒº](https://medium.com/ios-geek-community/pass-data-with-nsnotification-in-swift-3-73743723c84b)ã€‚*

ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆå¦‚ä½•ä»¥åŠä¸ºä»€ä¹ˆä½¿ç”¨`NSNotification`åœ¨ç±»å’Œç»“æ„ä¹‹é—´ä¼ é€’æ•°æ®å’Œé€šä¿¡/é€šçŸ¥ã€‚å¯¹äº†ï¼Œ`NSNotification`å’Œåå­—ä¸ä¸€æ ·ï¼Œå’Œæ¨é€é€šçŸ¥â€”â€”èœé¸Ÿé”™è¯¯ 101(æˆ‘)æ²¡æœ‰å…³ç³»ã€‚

æ˜¯çš„ï¼ŒSwift ä¸­ä¼ é€’æ•°æ®çš„æ–¹å¼æœ‰å¾ˆå¤šç§:`Delegate`ã€`Key-Value Observing`ã€`Segue`ï¼Œè¿˜æœ‰`NSNotification`ã€`Target-Action`ã€`Callbacks`ã€‚ä½†æ˜¯ï¼Œå„æœ‰åˆ©å¼Šã€‚å®ƒä»¬å°±åƒé¤å…·ä¸€æ ·ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä¸ä¼šç”¨ç­·å­â€”â€”å°½ç®¡å®ƒç›¸å½“ä¸é”™â€”â€”å–æ±¤ã€‚

å› ä¸ºæœ‰å¾ˆå¤šï¼Œæˆ‘å°†åªæ¶µç›–ä¸€æ¬¡ä¸€ä¸ªï¼Œæˆ‘ä¼šæåˆ°ä¸ºä»€ä¹ˆä½ åº”è¯¥å‹ºå­ï¼Œè€Œä¸æ˜¯ç­·å­ã€‚åœ¨æˆ‘è¿˜æ²¡ç”¨è¿‡ç­·å­å’Œåˆ€å­ä¹‹å‰å°±è¯´å®ƒä»¬çš„åŒºåˆ«æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚

## æˆ‘è®¤ä¸ºä½ ä¼šå­¦åˆ°ä»€ä¹ˆ

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å°†å­¦ä¹ ä¸¤ä»¶äº‹æƒ…ã€‚é¦–å…ˆï¼Œæ‚¨å°†äº†è§£å¦‚ä½•â€œé€šçŸ¥â€å…¶ä»–è§†å›¾æ§åˆ¶å™¨æˆ–åœ¨å•ä¸ªè§†å›¾æ§åˆ¶å™¨ä¸­ã€‚ç¬¬äºŒï¼Œä½ ä¼šæŒæ¡`NSNotification`çš„åŠ›é‡å’Œå®ƒçš„å¼±ç‚¹ã€‚

### UI ç»„ä»¶

æœ‰ä¸¤ä¸ªè§†å›¾æ§åˆ¶å™¨ã€‚`FirstVC`å’Œ`SecondVC`ã€‚æˆ‘å‡è®¾ä½ å·²ç»çŸ¥é“å¦‚ä½•åµŒå…¥`UINavigationController`å’Œè¿æ¥`IBOutlets`å’Œ`IBActions`ç­‰ç­‰ã€‚

`SecondVC`ä¼šé€šçŸ¥`FirstVC`ã€‚å½“æˆ‘è¯´â€œé€šçŸ¥â€çš„æ—¶å€™ï¼Œå°±åƒæˆ³ã€‚å®ƒæ²¡æœ‰å‘é€ä»»ä½•æ•°æ®ï¼Œä½†å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥ã€‚æˆ‘å°†åœ¨æœ¬æ–‡ç¨åè§£é‡Šå¦‚ä½•å‘é€æ•°æ®ã€‚ä¸‹é¢çš„ä¾‹å­ç±»ä¼¼äºç”¨æˆ·åœ¨è„¸ä¹¦æˆ– Instagram ä¸Šæ›´æ–°ä¸ªäººèµ„æ–™ã€‚æˆ‘æ²¡æœ‰ä½¿ç”¨`UITableView`,å› ä¸ºè¿™å¯¹äºè§£é‡Šè¿™ä¸ªæ¦‚å¿µæ¥è¯´å¤ªè¿‡äº†ã€‚

![enter image description here](../Images/9d36c7e6f4523d03c524afa1a2f01171.png)

åœ¨æˆ‘ä»¬å¼€å§‹ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹æˆ‘ä»¬å°†å¦‚ä½•åœ¨ä¸€ä¸ªéå¸¸é«˜çš„å±‚æ¬¡ä¸Šå®ç°å®ƒã€‚æƒ³è±¡ä¸€ä¸‹ï¼Œä¸¤ä¸ª viewcontrollers å°±åƒä¸€å¯¹ç¾ä¸½çš„å¤«å¦‡ã€‚ä»–ä»¬éƒ½æœ‰æ™ºèƒ½æ‰‹æœº(NSNotification å¯¹è±¡)æ¥ç›¸äº’äº¤è°ˆã€‚ç¬¬äºŒï¼Œæ¯éƒ¨æ™ºèƒ½æ‰‹æœºéƒ½æœ‰ä¸¤ä¸ªç‰¹ç‚¹:**æ¥æ”¶å’Œå‘é€æ•°æ®**ã€‚æœ€åï¼Œä¸ºäº†å®šä½å½¼æ­¤çš„è®¾å¤‡ï¼Œä»–ä»¬æœ‰ä¸€ä¸ª**å…¬å…±å¯†é’¥**ã€‚ç„¶è€Œï¼Œè¿™å–å†³äºå¯¹æ–¹æ˜¯å¦æƒ³æ¥ç”µè¯æˆ–å¹²è„†å¿½ç•¥ã€‚

æ—¢ç„¶æˆ‘ä»¬å·²ç»å¤§è‡´äº†è§£äº†å®ƒä»¬æ˜¯å¦‚ä½•ç›¸äº’é€šä¿¡çš„ï¼Œé‚£å°±è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹ Swift â˜ï¸å§

é¦–å…ˆï¼Œæˆ‘ä»¬è¦å­˜å‚¨å¯†é’¥ã€‚æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ Swift æ–‡ä»¶ï¼Œæˆ–è€…åƒè¿™æ ·åœ¨ä»»ä½•è§†å›¾æ§åˆ¶å™¨ä¹‹å¤–åˆ›å»ºä¸€ä¸ªã€‚

```
import UIKit
let myNotificationKey = "com.bobthedeveloper.notificationKey"
class SecondVC: UIViewController {} 
```

å°†ç”¨äºå°†è¿™äº›æ™ºèƒ½æ‰‹æœºè¿æ¥åœ¨ä¸€èµ·ã€‚å½“ç„¶ï¼Œå°±åƒå…¶ä»–ä¸€äº›å¤«å¦‡ä¸€æ ·ï¼Œä½ å¯ä»¥å‡ºäºä»»ä½•ç›®çš„æ‹¥æœ‰ä¸€æŠŠä»¥ä¸Šçš„é’¥åŒ™ã€‚ğŸ™ƒ

ç°åœ¨ï¼Œæ˜¯æ—¶å€™è¿æ¥æ™ºèƒ½æ‰‹æœºäº†ã€‚å§‘ä¸”ç§°ä¹‹ä¸ºè§‚å¯Ÿè€…å§ã€‚è§‚å¯Ÿå™¨å°†æœ‰å››ä¸ªå‚æ•°ã€‚å®ƒå°†è¯¢é—®`Observer`å“ªä¸ªå°†æ˜¯`self`ï¼Œå› ä¸ºä½ æ­£åœ¨å°†æ™ºèƒ½æ‰‹æœºè¿æ¥åˆ°`SecondVC`ã€‚ç¬¬äºŒï¼Œ`Selector`ï¼Œæ˜¯é€šçŸ¥æ—¶è¿è¡Œçš„å‡½æ•°ã€‚ç¬¬ä¸‰ï¼Œåå­—æ˜¯æŒ‡ç§˜å¯†ä»£ç ã€‚æœ€åï¼Œ`object`æˆ‘å°†åœ¨åé¢è®¨è®º FirstVC æ—¶è§£é‡Šã€‚æš‚æ—¶å°±æ”¾`nil`å§ã€‚

```
class SecondVC: UIViewController {
  @IBOutlet weak var secondVCLabel: UILabel!

  override func viewDidLoad() {
    super.viewDidLoad()
    NotificationCenter.default.addObserver(self,
                                           selector: #selector(doThisWhenNotify),
                                           name: NSNotification.Name(rawValue: myNotificationKey),
                                           object: nil)
  }

  func doThisWhenNotify() { print("I've sent a spark!") }
} 
```

æˆ‘ä¸æ˜ç™½`default`ç±»å‹å±æ€§çš„å«ä¹‰ï¼Œå› ä¸ºåœ¨ API æŒ‡å—ä¸­æ²¡æœ‰æè¿°ã€‚ä¸Šé¢å†™ç€*

> â€œæ— å¯ç”¨æ¦‚è§ˆâ€â€”â€”[è‹¹æœ](https://developer.apple.com/reference/foundation/nsnotificationcenter/1855943-defaultcenter?language=objc)

æ— è®ºå¦‚ä½•ï¼Œ`SecondVC`æœ‰ä¸€ä¸ªæ™ºèƒ½æ‰‹æœº/è§‚å¯Ÿè€…ï¼Œå½“æŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œæ˜¯æ—¶å€™å‘é€/é€šçŸ¥äº†

```
@IBAction func tabToNotifyBack(_ sender: UIButton) {
  NotificationCenter.default.post(name: Notification.Name(rawValue: myNotificationKey), object: self)

  secondVCLabel.text = "Notification Completed!ğŸ˜œ"
} 
```

åœ¨è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œ`object`æŒ‡çš„æ˜¯å‘é€è€…ã€‚å› ä¸º`SecondVC`æ­£åœ¨é€šçŸ¥è‡ªå·±ï¼Œæ‰€ä»¥å®ƒæ˜¯`self`ã€‚

ç”±äº`FirstVC`è¿˜æ²¡æœ‰æ³¨å†Œè§‚å¯Ÿå‘˜ï¼Œç«èŠ±/æˆ³æˆ³ä¸ä¼šå½±å“ã€‚æˆ‘ä¹‹å‰æåˆ°è¿‡ï¼Œä¼´ä¾£æœ‰æƒåˆ©æ¥ç”µè¯æˆ–è€…ç›´æ¥æ— è§†ã€‚åœ¨ iOS ä¸­ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œæ¾è€¦åˆâ€ã€‚ä¸åƒä½¿ç”¨å§”æ‰˜/åè®®åœ¨è§†å›¾æ§åˆ¶å™¨ä¹‹é—´å‘é€æ•°æ®ï¼Œæ²¡æœ‰ç–¯ç‹‚çš„ç»‘å®šã€‚æˆ‘çŸ¥é“ä½ ä»¬æœ‰äº›äººå¾ˆå›°æƒ‘ã€‚æˆ‘è®¡åˆ’å°†æ¥å†™ä¸€ç¯‡å…³äºå¦‚ä½•ä½¿ç”¨ delegate ä¼ é€’æ•°æ®çš„æ–‡ç« ã€‚å¦å¤–ï¼Œæˆ‘å°†è®¨è®º`delegate vs NSNotification`

**èµ„æº**
åœ¨ Swift 3 ä¸­çš„ ViewControllers ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œæ²¡æœ‰ Segue ( [YouTube](https://www.youtube.com/watch?v=jy_fHmuJIJg)

## æ¥æ”¶æ—¶é—´

å¾ˆç®€å•ã€‚å®ƒå°†æ·»åŠ ä¸€ä¸ªæ™ºèƒ½æ‰‹æœºï¼Œå¹¶å¬å–ç«èŠ±ï¼Œå¦‚æœå®ƒæœ‰ç›¸åŒçš„å¯†é’¥ã€‚

```
import UIKit

 class FirstVC: UIViewController {
   @IBOutlet weak var FirstVCLabel: UILabel!

   override func viewDidLoad() {
     super.viewDidLoad()
     NotificationCenter.default.addObserver(self,
                                            selector: #selector(doAfterNotified),
                                            name: NSNotification.Name(rawValue: myNotificationKey),
                                            object: nil) }

   func doAfterNotified() {
     print("I've been notified")
     FirstVCLabel.text = "Damn, I feel your spark"
   }
} 
```

ç°åœ¨ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆ`object`ï¼Œè¿™æ˜¯æˆ‘ä¹‹å‰è·³è¿‡çš„å‚æ•°ä¹‹ä¸€ã€‚å¦‚æœæ˜¯`nil`ï¼Œåªè¦ä½ æœ‰ç§˜é’¥ï¼Œä½ å°±ä¸åœ¨ä¹æ™ºèƒ½æ‰‹æœºæ˜¯ä»å“ªä¸ª/å“ªé‡Œå‘é€æ•°æ®çš„ã€‚é™¤äº†`nil`ä¹‹å¤–ï¼Œæˆ‘ä»æ¥æ²¡æœ‰ç”¨è¿‡ä»»ä½•ä¸œè¥¿
ï¼Œæ‰€ä»¥ä¹Ÿè®¸é‚£äº›ä»¥å‰ç”¨è¿‡çš„äººå¯ä»¥å¸®æˆ‘ä¸€ä¸‹ã€‚*æ¢å¥è¯è¯´ï¼Œæˆ‘ä¸çŸ¥é“å¦‚ä½•å®ç°*

ç°åœ¨ï¼Œå®ƒåº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ã€‚

![](../Images/6a8ae93b2e3e280e593b41a5b2583bcf.png)

é¡ºä¾¿æƒ³è±¡ä¸€ä¸‹`SecondVC`å°±åƒè„¸ä¹¦ç°åœºç›´æ’­ä¸€æ ·ã€‚åªè¦æœ‰è®¸å¤šå…¶ä»–è§†å›¾æ§åˆ¶å™¨åŒ…å«ç›‘å¬å¯†é’¥çš„è§‚å¯Ÿè€…ï¼Œå®ƒå°±å¯ä»¥é€šçŸ¥å¾ˆå¤šäººã€‚ç„¶è€Œï¼Œè¿™æ˜¯åŒæ­¥å®Œæˆçš„**ã€‚å¯¹äºé‚£äº›ä¸æ˜ç™½è¿™æ„å‘³ç€ä»€ä¹ˆçš„äººï¼Œä»»åŠ¡ä¸€æ¬¡å‘ç”Ÿä¸€ä¸ªï¼ŒåŒæ—¶é˜»æ­¢ä»»ä½•å…¶ä»–æ´»åŠ¨ï¼Œç›´åˆ°ä»»åŠ¡å®Œæˆã€‚å› æ­¤ï¼Œå¦‚æœæœ‰å¤ªå¤šçš„è§†å›¾æ§åˆ¶å™¨ï¼Œå°±ä¼šé™ä½è®¾å¤‡çš„é€Ÿåº¦ã€‚(ä¸ç¡®å®šå¤šå°‘æ‰ç®—å¤š)ã€‚**

 ****æºä»£ç **
[Github](https://github.com/bobleesj/Blog_NSNotification_Send_Spark)

## ä¼ é€’æ•°æ®

ç°åœ¨ä½ å·²ç»å­¦ä¼šäº†å¦‚ä½•*é€šçŸ¥*ã€‚è®©æˆ‘ä»¬å¿«é€Ÿå­¦ä¹ å¦‚ä½•åœ¨é€šçŸ¥çš„åŒæ—¶å‘é€æ•°æ®ã€‚è¿™æ˜¯åˆæ³•çš„ã€‚è¿™æ˜¯çœŸæ­£çš„å¥‡è¿¹å‘ç”Ÿçš„åœ°æ–¹ã€‚

åœ¨`SecondVC`ä¸­ï¼Œæ²¡æœ‰ä½¿ç”¨å¥½çš„è€æ–¹æ³•ï¼Œ

```
// Pass Spark
NotificationCenter.default.post(name: NSNotification.Name(rawValue: myNotificationKey), object: nil) 
```

ç°åœ¨ï¼Œä½ å¯ä»¥å‘é€ä¸€ä¸ªåŒ…å«å­—å…¸çš„ç«èŠ±

```
// Pass Data
NotificationCenter.default.post(name: NSNotification.Name(rawValue: myNotificationKey), object: nil, userInfo: ["name":"Bob"]) 
```

åœ¨`FirstVC`ä¸­ï¼Œåœ¨`viewDidLoad`ä¸‹ï¼Œæ‚¨å°†æ’å…¥è¿™ä¸ª

```
NotificationCenter.default.addObserver(forName: NSNotification.Name(rawValue: myNotificationKey),
                                       object: nil,
                                       queue: nil,
                                       using:catchNotification) 
```

æˆ‘å°±ä¸è¯´`queue`äº†ã€‚å¦‚æœä½ æ”¾`nil`ï¼Œæ¥æ”¶ä»»åŠ¡åŒæ­¥å‘ç”Ÿã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœä¸æ˜¯`nil`ï¼Œ`FirstVC`å¯ä»¥ä½¿ç”¨`Grand Central Dispatch`æ¥æ”¶æ•°æ®ã€‚å¦‚æœä½ ä¸æ‡‚ GCDï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒã€‚æˆ‘ä¸ºä½ å†™äº†ä¸¤ç¯‡æ–‡ç« ã€‚ä¹Ÿè®¸æˆ‘åº”è¯¥å†™å¦‚ä½•ä½¿ç”¨ GCD å¼‚æ­¥ä¼ é€’æ•°æ®ï¼é‚£ä¼šå¾ˆæœ‰è¶£ã€‚

**èµ„æº**
Swift 3 ä¸­çš„å¤§ä¸­å¤®è°ƒåº¦ä»‹ç»([ä¸­](https://medium.com/ios-geek-community/intro-to-grand-central-dispatch-in-swift-3-with-bob-lee-1d4b56f731b3#.m8s1uisl5)

UI &åƒ Swift 3 ( [Medium](https://medium.com/ios-geek-community/ui-networking-like-a-boss-in-swift-3-b4607dadfcea) )ä¸­çš„è€æ¿ä¸€æ ·è”ç½‘

ä½ å·²ç»æ³¨æ„åˆ°äº†ä¸€äº›ä¸åŒçš„ä¸œè¥¿ã€‚æ²¡é”™`catchNotification`è¿™ä¸ªå‡½æ•°ä¼šæ¶ˆè€—åŒ…å«`userInfo!`çš„ç«èŠ±`catchNotification`çœ‹èµ·æ¥åƒä»€ä¹ˆ

```
func catchNotification(notification:Notification) -> Void {
  guard let name = notification.userInfo!["name"] else { return }

  FirstVCLabel.text = "My name, \(name) has been passed! ğŸ˜„"
} 
```

ä¸€æ—¦æŒ‰ä¸‹`SecondVC`æŒ‰é’®ï¼Œ`catchNotification`è‡ªåŠ¨è¿è¡Œï¼ŒåŒ…å«ä»`SecondVC`ä¼ æ¥çš„`userInfo`ã€‚å¦‚æœä½ ä¸æ˜ç™½å¦‚ä½•ä½¿ç”¨ guard è¯­å¥è§£å¼€é€‰é¡¹ï¼Œè¯·éšæ„æŸ¥çœ‹æˆ‘ä¸‹é¢çš„è§†é¢‘ã€‚

**èµ„æº**
å®ˆæŠ¤å£°æ˜( [YouTube](https://www.youtube.com/watch?v=oeUYGNLqqqg)

æ‰€ä»¥ï¼Œæœ€åå®ƒåº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·

![](../Images/bd31247f76c88cb70694cb92639d9bda.png)

**èµ„æº**
[æºä»£ç ](https://github.com/bobleesj/Blog_NSNotification_Send_Data_ViewControllers)

## ç§»é™¤è§‚å¯Ÿè€…/æ™ºèƒ½æ‰‹æœº

å¦‚æœæ‚¨æƒ³åœ¨è§†å›¾å…³é—­æ—¶ç§»é™¤ä»»ä½•è§‚å¯Ÿè€…ï¼Œåªéœ€åœ¨`FirstVC`æˆ–ä»»ä½•å…¶ä»–è§†å›¾æ§åˆ¶å™¨ä¸­æ’å…¥ä¸‹é¢çš„ä»£ç ã€‚

```
override func viewDidDisappear(_ animated: Bool) {
  super.viewDidDisappear(true)
  NotificationCenter.default.removeObserver(self)
} 
```

## æœ€åçš„è¯

è¿™ç¯‡æ–‡ç« èŠ±çš„æ—¶é—´æ¯”æˆ‘é¢„è®¡çš„è¦é•¿ä¸€ç‚¹ã€‚ä½†æ˜¯ï¼Œå’Œå¾ˆå¤šäººä¸€èµ·å†™ä½œå’Œäº¤æµæ„Ÿè§‰çœŸå¥½ã€‚è°¢è°¢å¤§å®¶ä¸€è·¯èµ°åˆ°æœ€åã€‚éå¸¸æ„Ÿè°¢ã€‚ğŸ‘

*æ¨èæ–‡ç« *:

[éšæ„æŸ¥çœ‹æ¨èæ–‡ç« :](#)

[iOS å¼€å‘è€…çš„åå¤§åŸºæœ¬è§„åˆ™](#)

[é²å‹ƒä»‹ç»å¤§è°ƒåº¦ä¸­å¿ƒ](#)

## åˆ†äº«è¿™ç¯‡æ–‡ç« **