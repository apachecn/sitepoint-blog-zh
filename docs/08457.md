# 与 Jenkins 的持续集成，第 1 部分

> 原文：<https://www.sitepoint.com/continuous-integration-with-jenkins-1/>

持续集成是一种软件质量控制技术，每当有小的更改时，它都会检查代码的完整性，而不是等到所有的代码都完成后再进行测试和调试。

CI 要求版本控制、自动化单元测试和持续的包构建。原则上，循环的自动化部分可以通过触发 xunit (tester)和 make (builder)等程序的 cron 作业来完成。然而，更方便和足智多谋的工具已经出现在过去几年中，如詹金斯，这是结合自动化和监督任务到一个单一的系统。

一旦你知道为什么詹金斯会这样做，你就不难理解他做了什么。在这个由两部分组成的系列文章中，我将概括介绍 CI 可以解决的编程问题，展示如何在专业软件的帮助下实现这一点，并解释如何最少地使用 Jenkins 来定期触发 PHP (web)应用程序的测试和构建，记录集成成功或失败的地方，并维护一个“输出”文件夹，其中包含应用程序所需的最新文件，随时可以上传到服务器。

顺便说一句，我不必担心让读者成为詹金斯的专家，因为它非常容易使用，一旦理解了它的基本目的，复杂的资源自然就会出现。

## 大局

实施其提前退休计划，一个大的全球公司，公司提供其员工如何使用他们的新的优质时间的建议。一个是为网络编程，无论是为了娱乐、社区服务，还是作为他们自己的小生意。有几个人表现出了兴趣，培训部给他们买了一系列非常好的书籍，内容涉及网站设计和开发的各个方面，由一家澳大利亚公司出版，该公司还维护着一些世界上最好的网站。

在投身于 PHP 网页编程的人中，有三位以前是外贸经营者的人，他们过去经常在一起工作，决定建立一个前雇员在线网络:居住在阿根廷布宜诺斯艾利斯的 Bertha、居住在日本横滨的 Alicia 和来自德国波恩的 Miwa。此外，Guido，意大利都灵的前人力资源经理，决定创建自己的网站开发和托管业务。

为了开始使用他们的网络应用程序，Bertha 主动提出编写数据库搜索脚本，而 Alicia 自愿开发 HTML 界面，Miwa 决定研究添加/编辑/删除记录的代码。他们同意每周在线会面一次，测试他们的结果。
最初几周一切都很顺利，但很快就出现了问题，因为 Bertha 认为用`$camelCaseNaming`命名变量不好看，把所有东西都改成了`$underscore_separated_names`，Alicia 重命名了一些界面表单字段，Miwa 改变了数据库处理日期的方式。当他们聚在一起测试应用程序时，错误开始像玉米一样从一家大型全球公司唯一著名的爆米花机中冒出来。

与此同时，在意大利，Guido 很难跟踪分散在他硬盘上的开发文件，有些比客户服务器上的版本更新，有些则更旧，因此修复一个网站上的问题总是会破坏另一个网站。

女士们和圭多身处有时被称为“融合地狱”的地方，走出地狱的方式是向圣伊西多尔祈祷，圣伊西多尔被一些人视为互联网的守护神，或持续融合。

持续集成(CI)是一种开发方法，在这种方法中，对文件的任何更改，无论多小，都必须记录、测试并发送到一个中央版本控制的存储库，并且以有计划的方式构建包，忽略运行应用程序不需要的所有内容。

持续集成有助于确保每个人都在使用最新版本的代码，确保文件 A 中没有未经宣布的更改会影响文件 B 的开发，确保在任何时候都只需要少量的更正就可以让 B 重新使用 A，确保包是独立的、组织有序的，并且没有不必要的中间文件。

## 版本控制

在阅读了 Sean Hudgston 的优秀文章[Git](https://www.sitepoint.com/introduction-to-git-1/)简介之后，我将它推荐给那些仍然需要熟悉这个可怕工具的人(我的意思是，现在！)，女士们和 Guido 决定使用 Linus Torvalds 的存储库管理器 Git 来尝试将所有代码组织在一个地方。当他独自工作时，圭多在他的台式电脑上建立了一个存储库，创建了一个伞状目录(`/www`)，每个项目都有一个子文件夹，比如`/www/formaggeria_centrale`和`/www/assicurazione_chiapetta`。

女士们需要一个每个人都可以访问的远程存储库，她们选择了 GitHub 帐户，创建了一个名为“former_employee_net”的项目，并同意每个人在文件创建或编辑完成后都会`git add`一个文件。

## 单元测试

测试软件的基本步骤是在提交新代码到 g it 存储库之前，不断检查新代码是否如预期的那样工作。这叫做*单元测试*，借助塞巴斯蒂安·博格曼的 [PHPUnit 框架](https://github.com/sebastianbergmann/phpunit)，可以在 PHP 中进行。

显然是 Miwa 读了我的同事 Michelle Sanver 的[Getting Started with PHPUnit](https://www.sitepoint.com/getting-started-with-phpunit)并开始为她那部分应用程序编写测试。这证明是成功的，很快被其他人模仿。

## 建筑物

一旦代码被证明是功能性的，并被提交到存储库中，就有了通过将应用程序运行所需的文件与用于支持开发的文件分开，来创建易于部署到生产服务器的包的问题。

负责女队的 Alicia 写下了一个要排除的文件类型列表(比如。Gimp 图像项目的 xcf 文件)和这些文件的列表(如。php 和。png)包含在压缩文件中。这很容易，但是容易出错。

Apache Ant 运行一批任务，否则这些任务是逐个完成的。它读取用户创建的脚本，并执行类似“将这个复制到那里”和“从这里删除那个”的操作。Guido 已经在使用它了，他让 Alicia 参考 Apache 网站上的 Ant 教程。很快，她创建了自己的脚本，不仅开始自动化构建，还开始自动化测试。

## 管理

理论上这一切都很好，但是，唉，可怜的约里克！实际上，其他问题很快就出现了。Miwa 错过了一些单元测试，导致团队在最终必须修复的糟糕代码上花费时间。轮到他的时候，为了安全起见，Guido 花了很多时间重复他不确定是否做过的测试。

团队和单独的开发人员都不止一次忘记构建一个包，这导致一些文件的旧的、损坏的版本出现在生产服务器上。这就是监管工具出现的原因。

## 詹金斯

Jenkins 是 Sun Microsystems 公司的 Kohsuke Kawaguchi 创建的，他似乎已经受够了手工集成，他以 Hudson 的身份开始了他的生命，Hudson 是一个用 Java 编写的 CI 自动化管理环境。随着 Sun 被甲骨文吸收，社区将名称从 Hudson 改为 Jenkins，这相当于事实上的分化。

Jenkins 和 Hudson 负责运行 CI 所需的各种任务，同时帮助改进编码风格，寻找重复的代码和看起来不必要的复杂语句。Jenkins 是为 Java 开发而创建的，但是在插件的帮助下，现在它可以为许多编程语言提供服务。

在本文的第二部分，我们将安装和设置 Jenkins 来控制一个简单 PHP 项目的定期测试和构建，这也需要版本控制、单元测试和构建自动化程序。我们将通过安装这些来结束第一部分。

## Git、PHPUnit 和 Apache Ant

在我们可以将 Jenkins 用于我们的 PHP 演示项目之前，我们需要安装 Git(修订控制系统)、PHPUnit(PHP 的单元测试器)和 Apache Ant(包构建器)。

Git 在 Linux code reps 中可用，他们的网站提供 Mac 和 Windows 的安装程序。安装后，通过键入以下命令进行检查:

```
jajeronymo@server:~$ git --version
```

PHPUnit 应该在 PHP 扩展和应用程序库 PEAR 的帮助下安装，而不是其他方式。在 Linux 中，确保您的 PEAR 是最新的稳定版本，并运行:

```
jajeronymo@server:~$ sudo pear config-set auto_discover 1
jajeronymo@server:~$ sudo pear install pear.phpunit.de/PHPUnit
```

在通常的安装进度输出结束后，检查它是否工作:

```
jajeronymo@server:~$ phpunit --version
```

Apache Ant 也是 Java 软件，不需要安装程序。二进制包可以从他们的[下载页面](http://ant.apache.org/bindownload.cgi)获得。主要的 Linux 发行版可能在它们的仓库中有软件包。安装完成后，再次从命令行界面运行测试:

```
jajeronymo@server:~$ ant -version 
```

注意，Ant 只需要在选项“version”前加一个破折号！

在这一点上，我们已经得到了我们所需要的一切，除了 Jenkins 本身，这将在本文的第二部分中讨论。在那之前，保重！

<small>图片 via [查尔斯·泰勒](http://www.shutterstock.com/gallery-6748p1.html)/[Shutterstock](http://www.shutterstock.com)</small>

## 分享这篇文章