# å¦‚ä½•ç”¨ Gatsby å’Œ MDX æ„å»ºå¼€å‘è€…åšå®¢

> åŸæ–‡:[https://www.sitepoint.com/gatsby-mdx-blog/](https://www.sitepoint.com/gatsby-mdx-blog/)

ä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°å°†ä½ çš„æƒ³æ³•å‘å¸ƒåˆ° Dev.toã€Hashnode æˆ– Medium ç­‰ç½‘ç«™ä¸Šï¼Œä½†æœ€ç†æƒ³çš„æ˜¯å®Œå…¨æ§åˆ¶ä½ è‡ªå·±çš„å†…å®¹ã€‚å»ºç«‹è‡ªå·±çš„ç½‘ç«™å’Œæ§åˆ¶è‡ªå·±çš„å†…å®¹çš„å·¥å…·è¶Šæ¥è¶Šå¤šã€‚åœ¨è¿™ç¯‡å†…å®¹ä¸°å¯Œçš„æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†è®²è¿°å¦‚ä½•ä½¿ç”¨[ç›–èŒ¨æ¯”](https://www.sitepoint.com/gatsby-guide/)è®©ä½ çš„å†…å®¹å¤§æ”¾å¼‚å½©ï¼Œä»¥åŠåœ¨è¿™æ ·ä¸€ä¸ªç”Ÿæ€ç³»ç»Ÿä¸­ä½ å¯ä»¥è·å¾—çš„é¢å¤–åŠŸèƒ½ã€‚

æˆ‘æœ¬æ¥ç”¨ Jekyll å‘å¸ƒåšå®¢ï¼Œåæ¥æ¢æˆäº† Gatsbyï¼Œç”¨çš„æ˜¯ [Lumen](https://github.com/alxshelepenok/gatsby-starter-lumen) æ¨¡æ¿ã€‚æˆ‘ä» 0 ç‰ˆæœ¬å¼€å§‹å°±åœ¨ç”¨ç›–èŒ¨æ¯”ï¼Œ2017 å¹´ 5 æœˆå·¦å³ã€‚

æˆ‘å°†ä»ä¸€ä¸ª`Hello, World!` Gatsby é¡¹ç›®åˆ°ä¸€ä¸ªæœ‰ä»£ç è¯­æ³•é«˜äº®å’Œé»‘æš—æ¨¡å¼çš„ä¸»é¢˜åˆ‡æ¢çš„ç¼–ç åšå®¢ã€‚

æœ‰ä¸€ä¸ªä¸°å¯Œçš„æ’ä»¶ã€å¯åŠ¨å™¨å’Œä¸»é¢˜ç”Ÿæ€ç³»ç»Ÿå¯ä¾› Gatsby å¿«é€Ÿå¯åŠ¨å’Œè¿è¡Œï¼Œä½†æˆ‘æƒ³é‡‡ç”¨ä¸€ç§[æ¸è¿›æŠ«éœ²](https://www.jason.af/progressive-disclosure-of-complexity)çš„æ–¹æ³•æ¥å±•ç¤º Gatsbyï¼Œé‡ç‚¹å…³æ³¨ Gatsby é¡¹ç›®å¦‚ä½•å·¥ä½œçš„åŸºç¡€ã€‚

## ä¸ºä»€ä¹ˆæ˜¯ç›–èŒ¨æ¯”ï¼Ÿ

Gatsby æ˜¯ä¸€ä¸ª[é™æ€ç«™ç‚¹ç”Ÿæˆå™¨](https://www.sitepoint.com/static-site-generators/)ï¼Œæ‰€ä»¥å½“é¡µé¢è¢«è¯·æ±‚æ—¶ï¼Œä¸ä¼šåŠ¨æ€ç”Ÿæˆé¡µé¢ã€‚Gatsby ç«™ç‚¹çš„æ„å»ºè¾“å‡ºå¯ä»¥æ‰˜ç®¡åœ¨ CDN ä¸Šï¼Œä½¿å…¶å…¨çƒå¯ç”¨å¹¶å…·æœ‰è¶…çº§å¯ä¼¸ç¼©æ€§ã€‚

Gatsby å¯ä»¥ä½¿ç”¨ Markdown æ–‡ä»¶åœ¨ç«™ç‚¹é¡¹ç›®ä¸­åˆ›å»ºé¡µé¢ã€‚Gatsby ä¼šå°† Markdown æ–‡ä»¶è¯»å…¥ Gatsby æ–‡ä»¶ç³»ç»Ÿï¼Œå¹¶å°† Markdown è½¬æ¢ä¸º HTMLï¼Œç„¶ååœ¨æ„å»ºç«™ç‚¹æ—¶åˆ›å»ºé™æ€é¡µé¢ã€‚

æœ€ç»ˆç»“æœæ˜¯ä¸€ä¸ªè¶…çº§å¿«é€Ÿçš„ç½‘ç«™ï¼Œåœ¨è¯·æ±‚é¡µé¢æ—¶å‡ ä¹æ²¡æœ‰å»¶è¿Ÿã€‚

### é™ä»·å’Œ MDX

è‡ª 2016 å¹´ä»¥æ¥ï¼Œæˆ‘ä¸€ç›´åœ¨ Markdown ä¸­[è®°å½•æˆ‘çš„å‘å±•å†ç¨‹ã€‚Markdown æä¾›äº†ä¸€ç§åœ¨å¯ä»¥è½¬æ¢ä¸º HTML çš„çº¯æ–‡æœ¬æ–‡ä»¶ä¸­å®ç°ç®€å•ç¼–è¾‘çš„æ–¹æ³•ã€‚](https://scottspence.com/2016/10/hello-world/24/)

MDX(æˆ– JSX å‡ä»·)æ˜¯ä¸€ä¸ªè®©ä½ åœ¨å‡ä»·æ–‡ä»¶ä¸­å†™ JSX çš„å·¥å…·ï¼Œæœ‰ç‚¹åƒè¿™æ ·:

```
import { RainbowText } from './components/rainbow';
## A Markdown Heading
<RainbowText>Wheeeeeeee</RainbowText> 
```

Gatsby æ˜¯è¿„ä»Šä¸ºæ­¢æˆ‘ç”¨è¿‡çš„ä¸ Markdown å’Œ MDX ä¸€èµ·å·¥ä½œçš„æœ€å¥½çš„æ¡†æ¶ï¼Œå› ä¸ºåœ¨ä½ çš„å¸–å­ä¸Šä½¿ç”¨ frontmatter ä¸éœ€è¦ç‰¹åˆ«çš„æ³¨é‡Šã€‚

## æˆ‘éœ€è¦ä»€ä¹ˆï¼Ÿ

å¦‚æœä½ è¦ç»§ç»­ä¸‹å»ï¼Œä½ éœ€è¦å‡ æ ·ä¸œè¥¿:

*   ä¸€ä¸ªåŸºæœ¬çš„ web å¼€å‘è®¾ç½®:[èŠ‚ç‚¹](https://nodejs.org/en/download/)ï¼Œç»ˆç«¯(bashã€zsh æˆ– fish)
*   æ–‡æœ¬ç¼–è¾‘å™¨
*   å¯¹ React çš„åŸºæœ¬ç†è§£

å¦‚æœä½ æ²¡æœ‰ä»»ä½•ä¸€ä¸ªï¼Œè¿˜æœ‰ [StackBlitz](https://stackblitz.com/) å’Œ GitHub [ä»£ç ç©ºé—´](https://github.com/codespaces)ï¼Œä½ å¯ä»¥åœ¨é‚£é‡Œåˆ›å»ºä¸€ä¸ªç©ºçš„ GitHub åº“ï¼Œå¹¶ä»é‚£é‡Œå¼€å§‹å¼€å‘ç¯å¢ƒã€‚

åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘å°†ä½¿ç”¨ VS ä»£ç ä½œä¸ºæˆ‘çš„æ–‡æœ¬ç¼–è¾‘å™¨ï¼ŒYarn ä½œä¸ºæˆ‘é¦–é€‰çš„åŒ…ç®¡ç†å™¨ã€‚å¦‚æœä½ å–œæ¬¢ npmï¼Œé‚£å¾ˆå¥½ã€‚ğŸ‘

ä½ ä¹Ÿå¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°æœ¬æ•™ç¨‹çš„å®Œæ•´[ä»£ç ã€‚](https://github.com/sitepoint-editors/my-gatsby-blog)

å¥½äº†ï¼Œè¯¥å¼€å§‹äº†ï¼

## ä½ å¥½ï¼Œä¸–ç•Œï¼

æ˜¯æ—¶å€™å¯åŠ¨ç›–èŒ¨æ¯”é¡¹ç›®äº†ã€‚æˆ‘å°†ä»å‘½ä»¤è¡Œå¼€å§‹æ‰§è¡Œå¤§éƒ¨åˆ†æ“ä½œ:

```
# create the project directory
mkdir my-gatsby-blog
# change into the directory
cd my-gatsby-blog
# initialise a package.json file
yarn init -y
# initialise the git repo
git init 
```

é…·æ¯™äº†ã€‚ç°åœ¨ï¼Œåœ¨è¿›è¡Œä»»ä½•å…¶ä»–æ“ä½œä¹‹å‰ï¼Œæˆ‘éœ€è¦åœ¨å®‰è£…ä»»ä½• npm æ¨¡å—ä¹‹å‰æ·»åŠ ä¸€ä¸ª`.gitignore`æ–‡ä»¶:

```
# create .gitignore file in my directory
touch .gitignore
# add ignore contents with echo
echo "# Project dependencies
.cache
node_modules

# Build directory
public

# Other
.DS_Store
yarn-error.log" > .gitignore 
```

ç°åœ¨æˆ‘å¯ä»¥å®‰è£…æˆ‘éœ€è¦çš„æ‰€æœ‰ npm ä¼˜ç‚¹ï¼Œè€Œä¸ç”¨ VS ä»£ç  Git å¯¹æˆ‘å¤§å–Šå¤ªå¤šçš„æ´»åŠ¨æ›´æ”¹ã€‚ç°åœ¨è®©æˆ‘ä»¬å®‰è£…ä¸€äº›ä¾èµ–é¡¹æ¥å¯åŠ¨å¹¶è¿è¡Œ Gatsby:

```
yarn add gatsby react react-dom
# -p is to create parent directories too if needed
mkdir -p src/pages
# create the index (home) page
touch src/pages/index.js 
```

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä¸ºé¡¹ç›®æ·»åŠ (è®¸å¤š)ç¬¬ä¸€ä¸ª React ç»„ä»¶ã€‚æˆ‘å°†æŠŠä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æˆ‘åˆ›å»ºçš„`index.js`æ–‡ä»¶ä¸­:

```
import React from "react";

export default function IndexPage() {
  return <h1>Hello, World!</h1>;
} 
```

æˆ‘ç°åœ¨å‡†å¤‡ä»å‘½ä»¤è¡Œè¿è¡Œ Gatsby `develop`å‘½ä»¤:

```
# if you're using npm ğŸ‘‡
# $(npm bin)/gatsby develop
yarn gatsby develop 
```

è¿™å°†å¯åŠ¨ Gatsby dev æœåŠ¡å™¨ï¼Œå¹¶å‘Šè¯‰å®ƒæˆ‘çš„é¡¹ç›®å¯ä»¥åœ¨ç«¯å£ 8000(é»˜è®¤çš„ Gatsby ç«¯å£)ä¸Šçš„æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚ç½‘å€ä¸º [http://localhost:8000/](http://localhost:8000/) ã€‚

ç›´æ¥ä»å‘½ä»¤è¡Œç•Œé¢(CLI)ä½¿ç”¨ Gatsby äºŒè¿›åˆ¶å‘½ä»¤æ˜¯å®Œå…¨å¯è¡Œçš„ï¼Œä½†æ˜¯å¤§å¤šæ•°äººä¼šå°†å¯ç”¨çš„å‘½ä»¤æ·»åŠ åˆ°`package.json`æ–‡ä»¶çš„`scripts`éƒ¨åˆ†ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
"scripts": {
  "build": "gatsby build",
  "dev": "gatsby develop",
  "serve": "gatsby serve",
  "clean": "gatsby clean"
}, 
```

ä½œä¸ºé¢å¤–çš„æ”¶è·ï¼Œè¿™é‡Œæœ‰ä¸€äº›é¢å¤–çš„ä¸œè¥¿å¯ä»¥æ·»åŠ åˆ°ç›–èŒ¨æ¯”çš„å‰§æœ¬ä¸­ã€‚

å¦‚æœæˆ‘ä»¬ä¸æƒ³æ¯æ¬¡éƒ½åœ¨åŒä¸€ä¸ªç«¯å£ä¸Šè¿è¡Œé¡¹ç›®ï¼Œå¯ä»¥ç”¨`-p`æ ‡å¿—æ¥æ”¹å˜å®ƒï¼Œå¹¶åœ¨å…¶åæŒ‡å®šä¸€ä¸ªç«¯å£ã€‚æ¯”å¦‚`gatsby develop -p 8945`ã€‚

å¦‚æœæˆ‘ä»¬æƒ³åœ¨é¡¹ç›®å‡†å¤‡å¥½ä¹‹åæ‰“å¼€æµè§ˆå™¨é€‰é¡¹å¡ï¼Œæˆ‘ä»¬å¯ä»¥å°†`-o`æ·»åŠ åˆ°è„šæœ¬ä¸­ã€‚

æˆ‘å°†å¯¹`serve`è„šæœ¬åšåŒæ ·çš„äº‹æƒ…ï¼Œè¿™æ ·æˆ‘å°±çŸ¥é“å½“æˆ‘æ„å»ºä¸€ä¸ªé¡¹ç›®æ—¶ï¼Œå®ƒæ˜¯åœ¨ä¸€ä¸ªä¸åŒäºå¼€å‘çš„ç«¯å£ä¸Š:

```
"scripts": {
  "build": "gatsby build",
  "dev": "gatsby develop -p 8945 -o",
  "serve": "gatsby serve -p 9854 -o",
  "clean": "gatsby clean"
}, 
```

ä¸æ­¤åŒæ—¶ï¼Œå¼ºåˆ¶æ€§çš„â€œä½ å¥½ï¼Œä¸–ç•Œï¼â€æ¬¢è¿å®Œæ¯•ï¼Œæˆ‘å¯ä»¥ç»§ç»­è¿™ç¯‡æ–‡ç« çš„å…¶ä½™éƒ¨åˆ†äº†ï¼ğŸ¤“

æœ€åï¼Œæˆ‘å°†æäº¤åˆ°ç›®å‰ä¸ºæ­¢æˆ‘æ‰€åšçš„æ›´æ”¹:

```
# add everything for committing
git add .
# commit to repo
git commit -m 'init project' 
```

## åšå®¢å†…å®¹

å¥½çš„ï¼Œç°åœ¨è¿™ä¸ªé¡¹ç›®è¿˜æ²¡æœ‰ä»€ä¹ˆå¤§çš„è¿›å±•ï¼Œæ‰€ä»¥é¦–å…ˆæˆ‘å°†æ·»åŠ ä¸€äº›å†…å®¹ï¼Œå†æ¬¡ä»å‘½ä»¤è¡Œæ·»åŠ :

```
# this creates the folders in the root of the project
mkdir -p content/2021/03/{06/hello-world,07/second-post,08/third-post}
# create individual files
touch content/2021/03/06/hello-world/index.mdx
touch content/2021/03/07/second-post/index.mdx
touch content/2021/03/08/third-post/index.mdx 
```

æˆ‘ä¼šåœ¨æˆ‘åšçš„ä¾‹å­ä¸­ç”¨åˆ°è¿™äº›ã€‚

æ‚¨ä¼šæ³¨æ„åˆ°æ–‡ä»¶æ‰©å±•å`.mdx`ã€‚è¿™æ˜¯ä¸€ä¸ª MDX æ–‡ä»¶ã€‚

### å‰é¡µ

åœ¨æˆ‘ä¸ºåšå®¢æ·»åŠ ä¸€äº›å†…å®¹ä¹‹å‰ï¼Œæˆ‘éœ€è¦è¯´ä¸€ä¸‹å‰é¢çš„äº‹æƒ…ã€‚

Front matter æ˜¯ä¸€ç§å­˜å‚¨æ–‡ä»¶ä¿¡æ¯çš„æ–¹æ³•ï¼ŒGatsby å¯ä»¥ä½¿ç”¨å®ƒæ¥æ„å»ºé¡µé¢ã€‚ç°åœ¨ï¼Œæˆ‘å°†æ·»åŠ ä¸€ä¸ªå¸–å­çš„`title`å’Œä¸€ä¸ª`date`ã€‚æˆ‘ä¹Ÿä¼šç»™ä»–ä»¬å¢åŠ ä¸€äº›å†…å®¹ã€‚è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ç¯‡æ–‡ç« :

```
---
title: Hello World - from mdx!
date: 2021-03-06
---

My first post!!

## h2 Heading

Some meaningful prose

### h3 Heading

Some other meaningful prose 
```

è¿™æ˜¯æˆ‘ä»¬çš„ç¬¬äºŒä¸ªå¸–å­:

```
---
title: Second Post!
date: 2021-03-07
---

This is my second post! 
```

ç¬¬ä¸‰ä¸ªå¸–å­:

```
---
title: Third Post!
date: 2021-03-08
---

This is my third post!

> with a block quote!

And a code block:

```js
const wheeeeee = true;
``` 
```

è¿™äº›å¸–å­åˆ°æ­¤ä¸ºæ­¢ï¼Œå› ä¸ºè¿™äº›å¸–å­è¿˜æ²¡æœ‰è¢« Gatsby è¯†åˆ«ä¸ºé¡µé¢ã€‚æˆ‘éœ€è¦è®© Gatsby çŸ¥é“åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°è¦æ·»åŠ åˆ°é¡¹ç›®ä¸­çš„å†…å®¹ã€‚ä¸ºæ­¤ï¼Œæˆ‘å°†å‘ Gatsby æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶ã€‚

è®©æˆ‘ä»¬æäº¤æˆ‘å¯¹ Git æ‰€åšçš„æ›´æ”¹:

```
# add changed file for committing
git add .
# commit to repo
git commit -m 'add markdown files' 
```

## Gatsby é…ç½®

Gatsby config ç”¨äºå®šä¹‰å’Œé…ç½®æ‚¨å¯ä»¥ä½¿ç”¨çš„è®¸å¤š Gatsby æ’ä»¶ã€‚å…³äºç›–èŒ¨æ¯”å¤–æŒ‚ç”Ÿæ€ç³»ç»Ÿçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·è®¿é—®ã€‚ç°åœ¨ï¼Œæˆ‘å°†å†æ¬¡åœ¨ç»ˆç«¯ä¸­åˆ›å»ºè¯¥æ–‡ä»¶:

```
touch gatsby-config.js 
```

è¿™å°†åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»º`gatsby-config.js`ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥å¼€å§‹é…ç½® Gatsby æ¥è¯»å–æˆ‘ä¹‹å‰åˆ›å»ºçš„`.mdx`æ–‡ä»¶ã€‚

## ç›–èŒ¨æ¯”æ’ä»¶

ç°åœ¨æˆ‘å¯ä»¥å®‰è£…å’Œé…ç½® Gatsby éœ€è¦çš„æ’ä»¶æ¥è·å–å’Œæ˜¾ç¤ºæˆ‘åˆ›å»ºçš„æ–‡ä»¶ã€‚æˆ‘ç°åœ¨å°†å…¨éƒ¨å®‰è£…ï¼Œå¹¶ç®€è¦è¯´æ˜å®ƒä»¬çš„ç”¨é€”:

```
yarn add gatsby-plugin-mdx @mdx-js/mdx @mdx-js/react gatsby-source-filesystem 
```

å¿«é€ŸæŸ¥çœ‹ä¸€ä¸‹`package.json`ï¼Œç°åœ¨æ˜¾ç¤ºæˆ‘å·²ç»å®‰è£…äº†ä»¥ä¸‹ä¾èµ–ç‰ˆæœ¬:

```
"dependencies": {
  "@mdx-js/mdx": "^1.6.22",
  "@mdx-js/react": "^1.6.22",
  "gatsby": "^3.1.1",
  "gatsby-plugin-mdx": "^2.1.0",
  "gatsby-source-filesystem": "^3.1.0",
  "react": "^17.0.1",
  "react-dom": "^17.0.1"
}, 
```

éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨ Gatsby ä¸­ï¼Œä¸éœ€è¦ç”¨ React 17 åœ¨ä½ çš„ç»„ä»¶ä¸­å¯¼å…¥ Reactã€‚ä½†æ˜¯ä¸ºäº†å®Œæ•´ï¼Œä¹Ÿä¸ºäº†é¿å…ä»»ä½•æ··æ·†ï¼Œæˆ‘å°†æŠŠå®ƒåŒ…æ‹¬åœ¨è¿™äº›ä¾‹å­ä¸­ã€‚

ç°åœ¨æˆ‘éœ€è¦é…ç½®`gatsby-plugin-mdx`å’Œ`gatsby-plugin-mdx`ã€‚åœ¨`gatsby-config.js`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä¼šåŠ ä¸Šè¿™ä¸ª:

```
module.exports = {
  plugins: [
    `gatsby-plugin-mdx`,
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        path: `${__dirname}/content`,
        name: `content`,
      },
    },
  ],
}; 
```

æäº¤åˆ°ç›®å‰ä¸ºæ­¢çš„æ›´æ”¹:

```
git add .
git commit -m 'add gatsby plugins' 
```

## ç›–èŒ¨æ¯”å›¾ QL

ç°åœ¨æ˜¯æ—¶å€™ä½¿ç”¨ Gatsby GraphQL å®¢æˆ·ç«¯ GraphQL æ¥æŸ¥çœ‹æˆ‘åœ¨ Gatsby ä¸­çš„æ–‡ä»¶äº†ã€‚å¦‚æœæ‚¨ä¸€ç›´åœ¨å…³æ³¨ï¼Œæ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ° CLI æŒ‡ç¤ºäº†ä¸¤ä¸ª URL ä½ç½®æ¥æŸ¥çœ‹é¡¹ç›®:

```
You can now view my-gatsby-blog in the browser.
â €
  http://localhost:8000/
â €
View GraphiQL, an in-browser IDE, to explore your site's data and schema
â €
  http://localhost:8000/___graphql 
```

æˆ‘ç°åœ¨å°†ä½¿ç”¨`___graphql`(ä¸‰ä¸ªä¸‹åˆ’çº¿)è·¯å¾„æ¥æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿä¸­çš„æ–‡ä»¶ã€‚

å¦‚æœè¿™çœ‹èµ·æ¥æœ‰ç‚¹å“äººï¼Œæˆ‘å°†å°è¯•æ¶µç›–æ‰€æœ‰å¯èƒ½çœ‹èµ·æ¥æ²¡æœ‰å¤šå¤§æ„ä¹‰çš„éƒ¨åˆ†ã€‚å¦‚æœæ‚¨ç»§ç»­å­¦ä¹ ï¼Œæ‚¨åº”è¯¥å¯ä»¥å°†ç¤ºä¾‹å¤åˆ¶åˆ° GraphiQL explorer ä¸­ã€‚

å½“æˆ‘æ‰“å¼€ GraphiQL æµè§ˆå™¨æ—¶ï¼Œæˆ‘æœ‰å‡ ä¸ª**æµè§ˆå™¨**é¢æ¿ã€‚è¿™æ˜¯é¡¹ç›®ä¸­æ‰€æœ‰å¯ç”¨çš„æ•°æ®ï¼Œå–å†³äºæˆ‘åœ¨`gatsby-config.js`æ–‡ä»¶ä¸­çš„é…ç½®ã€‚

æ—è¾¹æ˜¯ **GraphiQL** æŸ¥è¯¢é¢æ¿å’Œç»“æœã€‚æˆ‘å°†åœ¨è¿™é‡Œç¼–å†™ GraphQL æŸ¥è¯¢æ¥æ£€ç´¢æˆ‘éœ€è¦çš„æ•°æ®ã€‚åœ¨æŸ¥è¯¢é¢æ¿çš„åº•éƒ¨è¿˜æœ‰ä¸€ä¸ª**æŸ¥è¯¢å˜é‡**éƒ¨åˆ†ï¼Œæˆ‘ç¨åä¼šè°ˆåˆ°å®ƒã€‚

æœ€å³è¾¹æ˜¯ GraphQL **æ–‡æ¡£æµè§ˆå™¨**ã€‚ç”±äº GraphQL çš„ä¸¥æ ¼ç±»å‹ï¼Œè¿™æ„å‘³ç€å®ƒèƒ½å¤Ÿåœ¨å…¶æ•°æ®ä¸Šç”Ÿæˆè‡ªå·±çš„æ–‡æ¡£ã€‚ä½†æ˜¯è¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚

## ç”¨ GraphQL æŸ¥è¯¢æœ¬åœ°æ–‡ä»¶

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†åœ¨ GraphiQL æŸ¥è¯¢é¢æ¿ä¸­æŸ¥è¯¢æˆ‘ä¹‹å‰æ·»åŠ çš„æ–‡ä»¶ã€‚åœ¨è¿™ä¸ªæŸ¥è¯¢ä¸­ï¼Œæˆ‘å°†æŸ¥è¯¢åœ¨æ–‡ä»¶çš„å­—ä½“ä¸­å®šä¹‰çš„æ ‡é¢˜å’Œæ—¥æœŸ:

```
{
  allMdx {
    nodes {
      frontmatter {
        title
        date
      }
    }
  }
} 
```

å¦‚æœæˆ‘ä»¬å°†å®ƒå¼¹å‡ºåˆ°æŸ¥è¯¢é¢æ¿ï¼ŒæŒ‰ä¸‹å¤§çš„æ’­æ”¾æŒ‰é’®ï¼Œæˆ‘ä»¬å°†åœ¨ç»“æœé¢æ¿ä¸­è·å¾—ä¸€äº›æ•°æ®ã€‚æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å·¦ä¾§é¢æ¿ä¸­çš„**æµè§ˆå™¨**æ¥æŒ‘é€‰æ•°æ®ã€‚ä»¥ä¸‹æ˜¯è¿è¡ŒæŸ¥è¯¢åæˆ‘å¾—åˆ°çš„ç»“æœ:

```
{
  "data": {
    "allMdx": {
      "nodes": [
        {
          "frontmatter": {
            "title": "Hello World - from mdx!",
            "date": "2021-03-06T00:00:00.000Z"
          }
        },
        {
          "frontmatter": {
            "title": "Second Post!",
            "date": "2021-03-07T00:00:00.000Z"
          }
        },
        {
          "frontmatter": {
            "title": "Third Post!",
            "date": "2021-03-08T00:00:00.000Z"
          }
        }
      ]
    }
  },
  "extensions": {}
} 
```

è¿™æ˜¯ä¸€ä¸ªå¤§çš„ JSON å¯¹è±¡ï¼ŒåŒ…å«æˆ‘ä»¬åœ¨æŸ¥è¯¢ä¸­è¯·æ±‚çš„ç›¸å…³ä¿¡æ¯ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨å®ƒã€‚ç›®å‰ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ç›–èŒ¨æ¯”é¡¹ç›®ä¸­ä½¿ç”¨è¿™äº›æ•°æ®æ¥åˆ¶ä½œé¡µé¢ã€‚

## ç½‘ç«™å…ƒæ•°æ®

åœ¨`gatsby-config.js`æ–‡ä»¶ä¸­ï¼Œè¿˜æœ‰ä¸€ä¸ªæŒ‡å®šç«™ç‚¹å…ƒæ•°æ®çš„é€‰é¡¹ã€‚ç«™ç‚¹å…ƒæ•°æ®æ˜¯å½“æˆ‘æƒ³è¦é‡ç”¨åƒç«™ç‚¹æ ‡é¢˜å’Œæè¿°è¿™æ ·çš„å…¬å…±æ•°æ®æ—¶ä½¿ç”¨çš„ã€‚

å½“æˆ‘æƒ³ä¸ºæœç´¢å¼•æ“ä¼˜åŒ–(SEO)æ·»åŠ  meta æ ‡ç­¾æ—¶ï¼Œè¿™å°†æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚(åŒæ ·ï¼Œç¨åä¼šæœ‰æ›´å¤šç›¸å…³å†…å®¹ã€‚)ç°åœ¨ï¼Œæˆ‘å°†ä½¿ç”¨`siteMetadata`å¯¹è±¡åœ¨`gatsby-config.js`ä¸­å®šä¹‰ä¸€äº›å…³äºç«™ç‚¹çš„åŸºæœ¬ä¿¡æ¯ã€‚

æˆ‘*å¯ä»¥è¿™æ ·ç›´æ¥åœ¨`module.exports`ä¸­å®šä¹‰ç«™ç‚¹ metada å—:*

 *```
module.exports = {
  siteMetadata: {
    title: `My Gatsby Blog`,
    description: `This is my coding blog.`,
  },
  plugins: [
    // configured plugins here
    {
      // empty for brevity
    },
  ],
}; 
```

ç«™ç‚¹å…ƒæ•°æ®å¯¹è±¡å¯èƒ½ä¼šå˜å¾—æœ‰ç‚¹å¤§ï¼Œæˆ‘å‘ç°å°†å®ƒä¿å­˜åœ¨è‡ªå·±çš„å¯¹è±¡ä¸­å¯ä»¥ä½¿æ¨ç†å˜å¾—ç®€å•ä¸€äº›ï¼Œå› æ­¤æˆ‘å°†å•ç‹¬å®šä¹‰å®ƒ:

```
const siteMetadata = {
  title: `My Gatsby Blog`,
  description: `This is my coding blog.`,
}; 
```

ç„¶åå°†`siteMetadata`å¯¹è±¡æ·»åŠ åˆ° Gatsby é…ç½®æ–‡ä»¶ä¸­:

```
const siteMetadata = {
  title: `My Gatsby Blog`,
  description: `This is my coding blog.`,
};

module.exports = {
  siteMetadata,
  plugins: [
    // configured plugins here
    {
      // empty for brevity
    },
  ],
}; 
```

ç°åœ¨ï¼Œæˆ‘å¯ä»¥å†æ¬¡è·³è½¬åˆ° GraphiQL explorerï¼Œä½¿ç”¨ä»¥ä¸‹æŸ¥è¯¢æ¥æŸ¥è¯¢è¯¥ç«™ç‚¹å…ƒæ•°æ®:

```
{
  site {
    siteMetadata {
      title
      description
    }
  }
} 
```

å¦‚æœæ‚¨æ­£åœ¨å¯¹`gatsby-config.js`æ–‡ä»¶è¿›è¡Œæ›´æ”¹ï¼Œé‚£ä¹ˆåœæ­¢å¹¶é‡å¯å¼€å‘æœåŠ¡å™¨æ€»æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œæ‰€ä»¥æˆ‘å°†è¿™æ ·åš(`Ctrl` + `c`ï¼Œç„¶åæ˜¯`yarn develop`ï¼Œç„¶ååœ¨ GraphiQL explorer ä¸­åˆ·æ–°é¡µé¢å¹¶å†æ¬¡è¿è¡ŒæŸ¥è¯¢æ¥å–å›æ•°æ®:

```
{
  "data": {
    "site": {
      "siteMetadata": {
        "title": "My Gatsby Blog",
        "description": "This is my coding blog."
      }
    }
  },
  "extensions": {}
} 
```

## åˆ¶ä½œä¸€ä¸ªç«™ç‚¹å…ƒæ•°æ®æŒ‚é’©

ç°åœ¨æˆ‘åœ¨ Gatsby æ–‡ä»¶ç³»ç»Ÿä¸­æœ‰äº†ç«™ç‚¹å…ƒæ•°æ®ï¼Œæˆ‘å¯ä»¥ç”¨ Gatsby é™æ€æŸ¥è¯¢é’©å­`useStaticQuery`åœ¨ä»»ä½•æˆ‘æƒ³ä½¿ç”¨å®ƒçš„åœ°æ–¹æŸ¥è¯¢å®ƒã€‚åœ¨å°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°`src/pages/index.js`æ–‡ä»¶åï¼Œæˆ‘å°†å…³é—­å¼€å‘æœåŠ¡å™¨å¹¶é‡å¯:

```
import { graphql, useStaticQuery } from "gatsby";
import React from "react";

export default function IndexPage() {
  const {
    site: { siteMetadata },
  } = useStaticQuery(graphql` {
      site {
        siteMetadata {
          title
          description
        }
      }
    } `);
  console.log("=====================");
  console.log(siteMetadata);
  console.log("=====================");
  return <h1>Hello World!</h1>;
} 
```

è¿™é‡Œæœ‰ä¸€ä¸ªå…³äºä¸€äº›ç¬¦å·çš„å¿«é€Ÿæ³¨é‡Š:`const { site: { siteMetadata }, }`æ˜¯åœ¨`site`æŸ¥è¯¢ä¸­è·å–æ•°æ®çš„å¿«é€Ÿæ–¹æ³•ï¼Œè¿™é‡Œæˆ‘ä»`site`å¯¹è±¡ä¸­æå–äº†`siteMetadata`ã€‚è¿™è¢«ç§°ä¸º[ç ´å](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Destructuring_assignment)ã€‚

ç°åœ¨ï¼Œåœ¨æˆ‘å†æ¬¡å¯åŠ¨ dev æœåŠ¡å™¨ä¹‹åï¼Œæˆ‘å¯ä»¥è½¬åˆ°æµè§ˆå™¨æ§åˆ¶å°(åœ¨ Windows/Linux ä¸­ä¸º`Control` + `Shift` + `J`ï¼Œåœ¨ macOS ä¸­ä¸º`Command` + `Option` + `J`ï¼Œå¹¶åœ¨æ§åˆ¶å°è¾“å‡ºä¸­çœ‹åˆ°`siteMetadata`å¯¹è±¡ã€‚

æˆ‘å¾—åˆ°ä»¥ä¸‹æ§åˆ¶å°è¾“å‡º:

```
=====================
{title: "My Gatsby Blog", description: "This is my coding blog."}
  description: "This is my coding blog."
  title: "My Gatsby Blog"
  __proto__: Object
===================== 
```

ä¸ç”¨æ‹…å¿ƒ 404 é¡µé¢ä¸¢å¤±çš„æ§åˆ¶å°è­¦å‘Šæ²¡æœ‰æ‰¾åˆ°(`net::ERR_ABORTED 404 (Not Found)`)ã€‚æˆ‘è¿‡ä¼šå„¿åšé‚£ä¸ªã€‚

ä¸ºäº†é¿å…æ¯æ¬¡éƒ½å¿…é¡»ç¼–å†™è¿™ä¸ªæŸ¥è¯¢ï¼Œæˆ‘æƒ³åœ¨ä¸€ä¸ªç»„ä»¶ä¸­ä½¿ç”¨å®ƒã€‚æˆ‘å°†æŠŠå®ƒæŠ½è±¡æˆä¸€ä¸ªç‹¬ç«‹çš„é’©å­:

```
# make a folder for all the hooks to live
mkdir src/hooks
# creathe the file
touch src/hooks/use-site-metadata.js 
```

ç°åœ¨ï¼Œæˆ‘å°†åœ¨æ–°åˆ›å»ºçš„`src/hooks/use-site-metadata.js`æ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªæŒ‚é’©ï¼Œä»¥æŒ‰éœ€è·å–ç«™ç‚¹å…ƒæ•°æ®:

```
import { graphql, useStaticQuery } from "gatsby";
export const useSiteMetadata = () => {
  const { site } = useStaticQuery(
    graphql` query SITE_METADATA_QUERY {
        site {
          siteMetadata {
            title
            description
          }
        }
      } `
  );
  return site.siteMetadata;
}; 
```

æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°è¿™ä¸ªæŸ¥è¯¢ä¸ GraphiQL explorer ä¸­çš„æŸ¥è¯¢ä¸åŒ:

```
+ query SITE_METADATA_QUERY {  site {
    siteMetadata {
      title
      description
    }
 } } 
```

è¿™æ˜¯å¯¹æŸ¥è¯¢çš„å‘½åã€‚å› ä¸ºæˆ‘å°†åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¾ˆå¤šæŸ¥è¯¢ï¼Œæ‰€ä»¥ç»™å®ƒä»¬èµ·ä¸€ä¸ªæœ‰æ„ä¹‰çš„åå­—æ˜¯æœ‰æ„ä¹‰çš„ã€‚

ç°åœ¨æˆ‘å°†åœ¨`src/pages/index.js`æ–‡ä»¶ä¸­å®ç°æ–°çš„æŒ‚é’©:

```
import React from "react";
import { useSiteMetadata } from "../hooks/use-site-metadata";

export default function IndexPage() {
  const { title, description } = useSiteMetadata();
  return (
    <>
      <h1>{title}</h1>
      <p>{description}</p>
    </>
  );
} 
```

è¿™å°±ä¸é‚£ä¹ˆç½—å—¦äº†ï¼Œæˆ‘å¯ä»¥ä»`SITE_METADATA_QUERY`ä¸­æŒ‘é€‰æˆ‘æƒ³è¦çš„é¡¹ç›®ã€‚

æ˜¯æ—¶å€™æäº¤åˆ°ç›®å‰ä¸ºæ­¢æ‰€åšçš„æ›´æ”¹äº†:

```
git add .
git commit -m 'add site metadata and metadata hook' 
```

## ä½¿ç”¨ä¸»é¢˜ç”¨æˆ·ç•Œé¢çš„æ ·å¼

ä¸ºäº†è®¾è®¡è¿™ä¸ªé¡¹ç›®ï¼Œæˆ‘å°†ä½¿ç”¨[ä¸»é¢˜ç”¨æˆ·ç•Œé¢](https://theme-ui.com/components)ï¼Œå› ä¸ºå®ƒå®ç°å¸ƒå±€å’Œé»‘æš—æ¨¡å¼ç­‰åŠŸèƒ½çš„é€Ÿåº¦å¾ˆå¿«ã€‚æˆ‘å°†è¯¦ç»†è¯´æ˜ä¸æˆ‘æ­£åœ¨åšçš„äº‹æƒ…ç›¸å…³çš„å†…å®¹å’ŒåŸå› ï¼Œå°½ç®¡è¿™ä¸æ˜¯å¦‚ä½•ä½¿ç”¨ä¸»é¢˜ UI çš„æŒ‡å—ã€‚

ä¸»é¢˜ç”¨æˆ·ç•Œé¢è¿˜æœ‰ä¸€äº›é™„åŠ çš„ä¾èµ–é¡¹ï¼Œå®ƒä»¬æ˜¯:

```
yarn add theme-ui gatsby-plugin-theme-ui @theme-ui/presets 
```

å®‰è£…å¥½ä¹‹åï¼Œæˆ‘éœ€è¦å°†`gatsby-plugin-theme-ui`æ·»åŠ åˆ°`gatsby-config.js`æ’ä»¶æ•°ç»„ä¸­:

```
module.exports = {
  siteMetadata,
  plugins: [
    `gatsby-plugin-theme-ui`,
    `gatsby-plugin-mdx`,
    {
      resolve: `gatsby-source-filesystem`,
      // rest of the module unchanged 
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘åœæ­¢å¹¶é‡æ–°å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œæˆ‘æœ‰ä¸€ä¸ªç¨å¾®ä¸åŒçš„ç½‘ç«™ï¼ä¸€åˆ‡éƒ½å˜å¾—æœ‰ç‚¹å‘é’äº†â€”â€”å‡†ç¡®åœ°è¯´ï¼Œæ˜¯é•¿æ˜¥èŠ±ï¼è¿™æ˜¯`gatsby-plugin-theme-ui`åœ¨åšå®ƒçš„äº‹æƒ…ï¼Œè¿™ä¸ªé¢œè‰²æ˜¯é»˜è®¤çš„ã€‚

ä¸»é¢˜ UI çš„ Gatsby æ’ä»¶æä¾›äº†è®¸å¤šé…ç½®é€‰é¡¹ï¼Œå…¶ä¸­ä¸€äº›æˆ‘å°†åœ¨éœ€è¦æ—¶è¯¦ç»†ä»‹ç»ã€‚ç°åœ¨ï¼Œæˆ‘å°†åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å¹¶å®šä¹‰ä¸€ä¸ªä¸»é¢˜å¯¹è±¡ä¾›ä¸»é¢˜ UI ä½¿ç”¨:

```
# create the folder for the Theme UI theme
mkdir src/gatsby-plugin-theme-ui
# create the theme file
touch src/gatsby-plugin-theme-ui/index.js 
```

åœ¨`src/gatsby-plugin-theme-ui/index.js`æ–‡ä»¶ä¸­ï¼Œæˆ‘å°†æ·»åŠ å‡ ä¸ªä¸»é¢˜ UI é¢„ç½®ï¼Œå®šä¹‰ä¸»é¢˜å¯¹è±¡ï¼Œ[å°†`swiss`é¢„ç½®ä¸­çš„](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Spread_syntax)æ‰©å±•åˆ°`theme`ã€`theme`ã€`styles`ã€‚

å¯¹äºé»‘æš—æ¨¡å¼ï¼Œæˆ‘ä½¿ç”¨äº†`deep`ä¸»é¢˜ UI é¢„è®¾ï¼Œå¹¶å°†å…¶æ‰©å±•åˆ°`dark`çš„`modes`å¯¹è±¡ä¸­ã€‚(å¾ˆå¿«ä¼šæœ‰æ›´å¤šç›¸å…³å†…å®¹ã€‚)ç°åœ¨ï¼Œæˆ‘çŸ¥é“è¿™å°†ä¸ºæˆ‘è§£å†³å¾ˆå¤šä¸»é¢˜åŒ–é—®é¢˜:

```
import { deep, swiss } from "@theme-ui/presets";

const theme = {
  ...swiss,
  colors: {
    ...swiss.colors,
    modes: {
      dark: {
        ...deep.colors,
      },
    },
  },

  styles: {
    ...swiss.styles,
    p: {
      fontFamily: "body",
      fontWeight: "body",
      lineHeight: "body",
      fontSize: 3,
    },
  },
};

export default theme; 
```

ç°åœ¨ï¼Œå¦‚æœæˆ‘é‡æ–°å¯åŠ¨å¼€å‘æœåŠ¡å™¨(å†æ¬¡ï¼Œæ˜¯çš„ï¼Œä½ ä¼šå­¦ä¼šå¤„ç†å®ƒ)ï¼Œå®ƒä¼šçœ‹èµ·æ¥æ›´å®¹æ˜“æ¥å—ç‘å£«ä¸»é¢˜çš„åº”ç”¨ã€‚åœ¨ç¼–å†™çš„æ—¶å€™ï¼Œä¸»é¢˜ UI æœ‰æ—¶ä¸ä¼šåˆ·æ–°`localhost`é¡µé¢ï¼Œæ‰€ä»¥éœ€è¦åšä¸€æ¬¡æµè§ˆå™¨é¡µé¢åˆ·æ–°ã€‚

å°†åˆ°ç›®å‰ä¸ºæ­¢çš„æ›´æ”¹æäº¤ç»™ Git:

```
git add .
git commit -m 'add Theme UI and configure presets' 
```

æ˜¯æ—¶å€™æ·»åŠ ä¸€äº› React ç»„ä»¶äº†ï¼

## å¸ƒå±€ç»„ä»¶

Gatsby æ²¡æœ‰å…·ä½“çš„å¸ƒå±€ï¼ŒæŠŠè¿™ä¸ªè´£ä»»äº¤ç»™äº†å¼€å‘è€…ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä¸ºæ•´ä¸ªç½‘ç«™åšä¸€ä¸ªå¸ƒå±€ã€‚åœ¨ Gatsby é¡¹ç›®ä¸­å¯ä»¥ä½¿ç”¨è®¸å¤šå¸ƒå±€ï¼Œä½†æ˜¯åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘åªä½¿ç”¨ä¸€ä¸ªã€‚

ç°åœ¨æˆ‘å°†é‡æ„æˆ‘ç›®å‰æ‹¥æœ‰çš„ä¸œè¥¿ï¼Œè¿™æ ·æ‰€æœ‰çš„ä¸œè¥¿éƒ½è¢«ä¸€ä¸ª`Layout`ç»„ä»¶åŒ…è£…èµ·æ¥ã€‚æˆ‘ç›®å‰åœ¨`src/pages/index.js`ä¸­çš„ä¸œè¥¿å¯ä»¥ç”¨äºä¸€ä¸ª`Header`ç»„ä»¶ï¼Œæ‰€ä»¥æˆ‘ç°åœ¨è¦ä¸º`Layout`å’Œ`Header`åˆ›å»ºå‡ ä¸ªæ–‡ä»¶:

```
# create a components folder
mkdir src/components
# create Layout and Header files
touch src/components/header.js src/components/layout.js 
```

ç°åœ¨å°†æ ‡é¢˜å’Œæè¿°ä»`src/pages/index.js`ç§»åŠ¨åˆ°æ–°åˆ›å»ºçš„`src/components/header.js`ç»„ä»¶ã€‚

æˆ‘æ²¡æœ‰åœ¨`Header`ç»„ä»¶ä¸­ä½¿ç”¨`useSiteMetadata`ï¼Œè€Œæ˜¯å°†æˆ‘éœ€è¦çš„`useSiteMetadata`é“å…·ä»`Layout`ç»„ä»¶ä¼ é€’ç»™æ¶ˆæ¯å¤´ï¼Œè¿™æ˜¯æ¶ˆæ¯å¤´å°†è¦å­˜åœ¨çš„åœ°æ–¹ã€‚(ç¨åå°†è¯¦ç»†ä»‹ç»ã€‚)é¦–å…ˆï¼Œè¿™é‡Œæ˜¯ header ç»„ä»¶ï¼Œå®ƒä½äº`src/components/header.js`:

```
import { Link as GatsbyLink } from "gatsby";
import React from "react";
import { Box, Heading, Link } from "theme-ui";

export const Header = ({ siteTitle, siteDescription }) => {
  return (
    <Box as="header" sx={{ bg: "highlight", mb: "1.45rem" }}>
      <Box
        as="div"
        sx={{
          m: "0 auto",
          maxWidth: "640px",
          p: "1.45rem 1.0875rem",
        }}
      >
        <Link as={GatsbyLink} to="/">
          <Heading>{siteTitle}</Heading>
        </Link>
        <Box as="p" variant="styles.p">
          {siteDescription}
        </Box>
      </Box>
    </Box>
  );
}; 
```

æˆ‘å·²ç»ä½¿ç”¨ä¸»é¢˜ UI å¸ƒå±€å…ƒç´ æ·»åŠ äº†ä¸€äº›åŸºæœ¬æ ·å¼ã€‚è¿™ä¸ªçœ‹èµ·æ¥å’Œä¹‹å‰æœ‰ç‚¹ä¸ä¸€æ ·:`Box`ã€`Link`ã€`Heading`â€¦â€¦ä»€ä¹ˆï¼Ÿè¿™äº›éƒ½æ˜¯ä¸»é¢˜ UI ç»„ä»¶ï¼Œå¯ä»¥ç”¨äºå¸ƒå±€ã€è¡¨å•å…ƒç´ ç­‰ç­‰ã€‚

æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°æ·»åŠ åˆ°`Link`ç»„ä»¶çš„`as={GatsbyLink}`é“¾æ¥å±æ€§ã€‚è¿™åœ¨ä¸»é¢˜ UI ä¸­ä½¿ç”¨äº†`as`é“å…·ï¼Œå¹¶è®©è¢«ä¼ å…¥çš„ç»„ä»¶é‡‡ç”¨ä¸»é¢˜ UI æ ·å¼ã€‚

ä¿ç½—Â·æ–¯åä¼¦æœ‰ä¸€ä¸ªå¾ˆæ£’çš„å¸–å­[æ›´è¯¦ç»†åœ°è§£é‡Šäº†](https://paulie.dev/posts/2020/04/gatsby-or-theme-ui-link/)è¿™æ˜¯å¦‚ä½•åœ¨ä¸»é¢˜ç”¨æˆ·ç•Œé¢ä¸­å®ç°çš„ã€‚å¯¹äºä¸»é¢˜ UI çœŸæ­£å…¨é¢çš„è§£é‡Šï¼Œè¿˜æœ‰åŒä¸€ä½œè€…çš„â€œ[ç†è§£ä¸»é¢˜ UI](https://paulie.dev/posts/2021/03/understanding-theme-ui/) â€ã€‚

è¿˜æœ‰æ¥è‡ªä¸»é¢˜ UI çš„`sx`å’Œ`variant`é“å…·ã€‚`sx`å…è®¸å°†å…¶ä»–æ ·å¼ä¼ é€’ç»™ç»„ä»¶ã€‚æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªç›¸å½“äº JSX `style={{}}`çš„é“å…·ã€‚`variant` prop å…è®¸å°†ä¸€ç»„é¢„å®šä¹‰çš„æ ·å¼ä»ä¸»é¢˜åº”ç”¨åˆ°æ­£åœ¨ä½¿ç”¨çš„ç»„ä»¶ã€‚

ç°åœ¨å¯¹äºä½äº`src/components/layout.js`ä¸­çš„`Layout`ç»„ä»¶:

```
import React from "react";
import { Box } from "theme-ui";
import { useSiteMetadata } from "../hooks/use-site-metadata";
import { Header } from "./header";

export const Layout = ({ children }) => {
  const { title, description } = useSiteMetadata();
  return (
    <>
      <Header siteTitle={title} siteDescription={description} />
      <Box
        as="div"
        sx={{
          margin: "0 auto",
          maxWidth: "640px",
          padding: "0 1.0875rem 1.45rem",
        }}
      >
        <Box as="main">{children}</Box>
      </Box>
    </>
  );
}; 
```

åœ¨è¿™é‡Œï¼Œæˆ‘ä¿ç•™äº†`useSiteMetadata`é’©å­å¹¶ä¼ é€’äº†`Header`ç»„ä»¶éœ€è¦çš„é“å…·ï¼ŒåŒæ ·æ˜¯ç”¨`sx`é“å…·æ¥æ·»åŠ ä¸€äº›åŸºæœ¬æ ·å¼ï¼Œä»¥ä¾¿ä¸ä¸»åŒ…å« div å¯¹é½ã€‚ç„¶åæˆ‘ä¸º`children`åˆ›å»ºä¸€ä¸ª`main`åŒ…è£…å™¨ã€‚

`children`å±æ€§æ˜¯è¿”å›`Layout`ç»„ä»¶å°è£…çš„ä»»ä½•ä¸œè¥¿ï¼Œè¿™å°†åŒ…æ‹¬æˆ‘æƒ³è¦åº”ç”¨å¸ƒå±€çš„ä»»ä½•ä¸œè¥¿ã€‚ä¾‹å¦‚:

```
<Layout>
  <h1>This is wrapped</h1>
</Layout> 
```

è¿™å°†è¿”å›`Layout`ç»„ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹åŠå…¶åŒ…è£…çš„å†…å®¹ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè¿™å°†æ˜¯ç”±`Layout`ç»„ä»¶åŒ…è£…çš„å¤´éƒ¨å’Œ H1ã€‚

ä¾‹å¦‚ï¼Œæˆ‘å°†è¿”å›åˆ°ç´¢å¼•é¡µé¢(`src/pages.index.js`)å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
import React from "react";
import { Layout } from "../components/layout";

export default function IndexPage() {
  return (
    <>
      <Layout>
        <h1>This is wrapped</h1>
      </Layout>
    </>
  );
} 
```

ç»“æœæ˜¯åœ¨`Layout`ç»„ä»¶å’Œ H1 `This is wrapped`ä¸­æä¾›çš„å¤´ã€‚

## ç´¢å¼•é¡µé¢å¸–å­æŸ¥è¯¢

ç°åœ¨æ˜¯æ—¶å€™è·å–æˆ‘åœ¨å¼€å§‹æ—¶åˆ›å»ºçš„æ–‡ç« ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºå¯ç‚¹å‡»é“¾æ¥çš„åˆ—è¡¨æ˜¾ç¤ºåœ¨ç´¢å¼•é¡µé¢ä¸Šã€‚

ä¸ºäº†è·å¾—æ–‡ç« ä¿¡æ¯ï¼Œæˆ‘å°†é‡æ–°åˆ›å»ºæˆ‘åœ¨å…³äºä½¿ç”¨ GraphQL æŸ¥è¯¢æœ¬åœ°æ–‡ä»¶çš„[ä¸€èŠ‚ä¸­åˆ›å»ºçš„æŸ¥è¯¢ï¼Œå¹¶å¢åŠ ä¸€äº›é¢å¤–çš„å†…å®¹:](#querylocalfileswithgraphql)

```
{
  allMdx(sort: { fields: [frontmatter___date], order: DESC }) {
    nodes {
      id
      slug
      excerpt(pruneLength: 250)
      frontmatter {
        title
        date(formatString: "YYYY MMMM Do")
      }
    }
  }
} 
```

æˆ‘å·²ç»æ·»åŠ äº†èŠ‚ç‚¹çš„`id`å’Œ`slug`ã€‚è¿™æ˜¯`.mdx`æ–‡ä»¶çš„è·¯å¾„ã€‚

`excerpt`ä½¿ç”¨ä¸€ä¸ª Gatsby å‡½æ•°ä»æ–‡ç« æ­£æ–‡ä¸­è·å–å‰ 250 ä¸ªå­—ç¬¦ï¼Œè¿˜ä½¿ç”¨å¦ä¸€ä¸ªå†…ç½®çš„ Gatsby å‡½æ•°ä¸º`date`æ·»åŠ äº†ä¸€äº›æ ¼å¼ã€‚

ç„¶åï¼Œä½œä¸ºæŒ‰æ—¥æœŸé™åºæ’åˆ—æ–‡ç« çš„ä¸€ç§æ–¹å¼ï¼Œæˆ‘æ·»åŠ äº†ä¸€ä¸ªæ’åº:`allMdx(sort: { fields: [frontmatter___date], order: DESC }) {`ã€‚è¿™æ˜¯åœ¨å¸–å­å‰é¢æ’åºçš„æ—¥æœŸé—®é¢˜ã€‚

å°†å®ƒæ·»åŠ åˆ° GraphiQL explorer ä¸­ä¼šå¾—åˆ°ä»¥ä¸‹ç»“æœ:

```
{
  "data": {
    "allMdx": {
      "nodes": [
        {
          "id": "2bed526a-e5a9-5a00-b9c0-0e33beafdbcf",
          "slug": "2021/03/08/third-post/",
          "excerpt": "This is my third post! with a block quote! And a code block:",
          "frontmatter": {
            "title": "Third Post!",
            "date": "2021 March 8th"
          }
        },
        {
          "id": "89ea266b-c981-5d6e-87ef-aa529e98946e",
          "slug": "2021/03/07/second-post/",
          "excerpt": "This is my second post!",
          "frontmatter": {
            "title": "Second Post!",
            "date": "2021 March 7th"
          }
        },
        {
          "id": "75391ba1-3d6b-539f-86d2-d0e6b4104806",
          "slug": "2021/03/06/hello-world/",
          "excerpt": "My first post!! h2 Heading Some meaningful prose h3 Heading Some other meaningful prose",
          "frontmatter": {
            "title": "Hello World - from mdx!",
            "date": "2021 March 6th"
          }
        }
      ]
    }
  },
  "extensions": {}
} 
```

ç°åœ¨ï¼Œæˆ‘å¯ä»¥ä½¿ç”¨`src/pages/index.js`æ–‡ä»¶ä¸­çš„æŸ¥è¯¢æ¥è·å–ç´¢å¼•é¡µé¢ä¸­ä½¿ç”¨çš„æ•°æ®ã€‚åœ¨`IndexPage`å‡½æ•°ä¸­ï¼Œæˆ‘å°†é€šè¿‡ GraphQL æŸ¥è¯¢ä»ç»™äºˆç»„ä»¶çš„å±æ€§ä¸­ææ„`data`:

```
import { graphql, Link as GatsbyLink } from "gatsby";
import React from "react";
import { Box, Heading, Link } from "theme-ui";
import { Layout } from "../components/layout";

export default function IndexPage({ data }) {
  return (
    <>
      <Layout>
        {data.allMdx.nodes.map(({ id, excerpt, frontmatter, slug }) => (
          <Box
            key={id}
            as="article"
            sx={{
              mb: 4,
              p: 3,
              boxShadow: "0 10px 15px -3px rgba(0, 0, 0, 0.1)",
              border: "1px solid #d1d1d1",
              borderRadius: "15px",
            }}
          >
            <Link as={GatsbyLink} to={`/${slug}`}>
              <Heading>{frontmatter.title}</Heading>
              <Box as="p" variant="styles.p">
                {frontmatter.date}
              </Box>
              <Box as="p" variant="styles.p">
                {excerpt}
              </Box>
            </Link>
          </Box>
        ))}
      </Layout>
    </>
  );
}

export const query = graphql` query SITE_INDEX_QUERY {
    allMdx(sort: { fields: [frontmatter___date], order: DESC }) {
      nodes {
        id
        excerpt(pruneLength: 250)
        frontmatter {
          title
          date(formatString: "YYYY MMMM Do")
        }
        slug
      }
    }
  } `; 
```

è¿™ä½¿ç”¨äº†å‰é¢è¯¦è¿°çš„ç»„ä»¶ã€‚æ³¨æ„ï¼Œ`excerpt`ã€`frontmatter`å’Œ`slug`ä»`data.allMdx.nodes`å¼€å§‹è¢«ææ„:

```
{data.allMdx.nodes.map(({ excerpt, frontmatter, slug }) => ( 
```

ç‚¹å‡»é“¾æ¥ä¼šæŠŠæˆ‘å¸¦åˆ° Gatsby.js å¼€å‘ 404 é¡µé¢ã€‚é‚£æ˜¯å› ä¸ºæˆ‘è¿˜æ²¡æœ‰ä¸º`.mxd`æ–‡ä»¶åˆ¶ä½œé¡µé¢ã€‚é‚£æ˜¯ä¸‹ä¸€ä¸ªã€‚

åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘å°†æäº¤åˆ°ç›®å‰ä¸ºæ­¢æˆ‘æ‰€åšçš„äº‹æƒ…:

```
git add .
git commit -m 'add Header and Layout components' 
```

## é€šè¿‡ MDX ä½¿ç”¨ Gatsby æ–‡ä»¶ç³»ç»Ÿè·¯ç”± API

æˆ‘å°†ä½¿ç”¨ Gatsby [æ–‡ä»¶ç³»ç»Ÿè·¯ç”± API](https://www.gatsbyjs.com/docs/reference/routing/file-system-route-api/) æ¥è·å–æˆ‘ä¹‹å‰åˆ›å»ºçš„å¸–å­çš„æ–‡ä»¶è·¯å¾„ã€‚æ–‡ä»¶ç³»ç»Ÿè·¯ç”± API æ˜¯ä»æˆ‘çš„ GraphQL æ•°æ®ä»¥ç¼–ç¨‹æ–¹å¼åˆ›å»ºé¡µé¢çš„ä¸€ç§æ–¹å¼ã€‚

å½“ Gatsby åœ¨æ„å»ºæ—¶ç”Ÿæˆæ–‡ä»¶ç³»ç»Ÿæ•°æ®æ—¶ï¼Œè¿™ç§æ–¹æ³•å¯¹äºè¦ä½œä¸ºç›®æ ‡çš„é¡µé¢æœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ç¬¦å·ã€‚è¯¥æ–‡ä»¶æŒ‡ç¤ºèŠ‚ç‚¹å’Œ slugã€‚æˆ‘å°†é¦–å…ˆåˆ›å»ºæ–‡ä»¶ï¼Œç„¶åè¯¦ç»†è¯´æ˜æ•°æ®æ¥è‡ªå“ªé‡Œ:

```
# create the route api file
touch src/pages/{mdx.slug}.js 
```

åœ¨è¯¥æ–‡ä»¶ä¸­ï¼Œæˆ‘å°†ä¸ºå¸Œæœ›åŒ…å«åœ¨è¯¥æ¨¡æ¿ä¸­çš„æ•°æ®å®šä¹‰ä¸€ä¸ª GraphQL æŸ¥è¯¢:

```
import { graphql } from "gatsby";
import { MDXRenderer } from "gatsby-plugin-mdx";
import React from "react";
import { Box } from "theme-ui";

export default function PostPage({ data }) {
  const {
    body,
    frontmatter: { title },
  } = data.mdx;
  return (
    <>
      <Box as="h1" variant="styles.h1" fontSize="4xl">
        {title}
      </Box>
      <MDXRenderer>{body}</MDXRenderer>
    </>
  );
}

export const query = graphql` query POST_BY_SLUG($slug: String) {
    mdx(slug: { eq: $slug }) {
      id
      slug
      body
      frontmatter {
        date
        title
      }
    }
  } `; 
```

ç°åœ¨æœ‰å¾ˆå¤šä»£ç ï¼Œæ‰€ä»¥æˆ‘å°†åˆ†è§£å®ƒã€‚å®ƒä¸»è¦ä¸ GraphQL æŸ¥è¯¢æœ‰å…³:

```
query POST_BY_SLUG($slug: String) {
  mdx(slug: { eq: $slug }) {
    id
    slug
    body
    frontmatter {
      date
      title
    }
  }
} 
```

æŸ¥è¯¢çš„å¼€å§‹æ˜¯ç”¨`POST_BY_SLUG($slug: String)`æ¥æ”¶ä¸€ä¸ª`slug`ï¼Œä¸»èŠ‚ç‚¹æ˜¯`mdx`ï¼Œæ‰€ä»¥æˆ‘ç”¨`mdx.slug`ä½œä¸ºæ–‡ä»¶å`{mdx.slug}.js`ã€‚

å¦‚æœæˆ‘å°†è¯¥æŸ¥è¯¢ç²˜è´´åˆ°æˆ‘çš„ GraphiQL explorer ä¸­å¹¶æŒ‰ä¸‹ play æŒ‰é’®ï¼Œæˆ‘ä¼šå¾—åˆ°è¿™æ ·çš„ç»“æœ:

```
{
  "data": {
    "mdx": null
  },
  "extensions": {}
} 
```

è¿™æ˜¯å› ä¸ºåœ¨ GraphiQL explorer ä¸­æ²¡æœ‰ä¸º`$slug`å®šä¹‰å˜é‡ã€‚å¦‚æœä½ çœ‹çœ‹æŸ¥è¯¢é¢æ¿çš„åº•éƒ¨ï¼Œä½ ä¼šçœ‹åˆ°æœ‰ä¸€ä¸ªæŸ¥è¯¢å˜é‡éƒ¨åˆ†ã€‚ç‚¹å‡»è¿™ä¸ªå°†å±•å¼€å®ƒã€‚åœ¨è¿™é‡Œæˆ‘éœ€è¦ä¸º`slug`æ·»åŠ ä¸€ä¸ªå˜é‡ã€‚æˆ‘å°†ç”¨ä¸€ä¸ªæ–‡ä»¶çš„è·¯å¾„åœ¨èŠ±æ‹¬å·ä¸­å®šä¹‰å®ƒ:

```
{
  "slug": "2021/03/08/third-post/"
} 
```

å†æ¬¡è¿è¡ŒæŸ¥è¯¢ï¼Œæˆ‘å°†è·å¾—è¯¥æ–‡ä»¶çš„æ‰€æœ‰æ•°æ®ã€‚ä¸ºäº†å¯è¯»æ€§ï¼Œæˆ‘å·²ç»æ³¨é‡Šæ‰äº†`body`è¾“å‡º:

```
{
  "data": {
    "mdx": {
      "id": "105a5c78-6a36-56e8-976c-d53d8e6ca623",
      "slug": "2021/01/08/third-post/",
      "body": "function _extends() ...", // compiled MDX here
      "frontmatter": {
        "date": "2021-03-08T00:00:00.000Z",
        "title": "Third Post!"
      }
    }
  },
  "extensions": {}
} 
```

æ–‡ä»¶ç³»ç»Ÿè·¯ç”± API æ‰€åšçš„æ˜¯å°†å•ä¸ªæ–‡ä»¶è·¯å¾„ä¼ é€’åˆ°é¡µé¢æŸ¥è¯¢`src/pages/{mdx.slug}.js`ä¸­ï¼Œå¹¶å°†æ¥è‡ªè¯¥æŸ¥è¯¢çš„æ•°æ®è¿”å›åˆ°é¡µé¢`({ data })`ä¸­è¢«ä¼ é€’åˆ°é¡µé¢çš„é€‚å½“ä½ç½®ã€‚

åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°æˆ‘å·²ç»ä»è¿”å›çš„æ•°æ®ä¸­ææ„äº†`body`ï¼Œç„¶åä»`frontmatter`ä¸­ææ„äº†`title`ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸¤çº§ææ„:

```
const {
  body,
  frontmatter: { title },
} = data.mdx; 
```

å¦ä¸€ç§æ–¹æ³•æ˜¯:

```
const body = data.mdx.body;
const title = data.mdx.frontmatter.title; 
```

ä½¿ç”¨ææ„ä½¿å®ƒä¸é‚£ä¹ˆå†—é•¿ã€‚

æœ€åè¦æ³¨æ„çš„æ˜¯,`MDXRenderer`åŒ…è£…äº†å¸–å­çš„`body`ã€‚è¿™æ˜¯`.mdx`æ–‡ä»¶ä¸­åŒ…å«çš„æ‰€æœ‰å†…å®¹ï¼Œåœ¨å‰é¢çš„äº‹å—ä¹‹åã€‚æ¥è‡ª GraphiQL æŸ¥è¯¢çš„ç¼–è¯‘ MDX(è¢«æ³¨é‡Šæ‰)æ˜¯éœ€è¦åŒ…è£…åœ¨`MDXRenderer`ä¸­çš„å†…å®¹:

```
<MDXRenderer>{body}</MDXRenderer> 
```

æˆ‘ç°åœ¨å°†æäº¤æ›´æ”¹:

```
git add .
git commit -m 'create file route API file' 
```

## æ ¹åŒ…è£…å™¨æ¦‚å¿µ

ç°åœ¨ï¼Œå•å‡»ç´¢å¼•é¡µé¢ä¸Šçš„ä¸€ä¸ªé“¾æ¥ä¼šå°†æˆ‘å¸¦åˆ°æ‰€éœ€çš„`.mdx`é¡µé¢ï¼Œä½†å®ƒçœ‹èµ·æ¥ä¸ç´¢å¼•é¡µé¢æœ‰ç‚¹ä¸åŒï¼Œå¯¹å—ï¼Ÿ

é‚£æ˜¯å› ä¸ºè¿˜æ²¡æœ‰åŒ…è£…å®ƒçš„ç‰ˆå¼ã€‚è¿™æ˜¯æˆ‘å¯ä»¥ä½¿ç”¨ Gatsby æµè§ˆå™¨ API å¹¶ä½¿ç”¨`wrapPageElement`å‡½æ•°åŒ…è£…æ‰€æœ‰é¡µé¢å…ƒç´ çš„åœ°æ–¹ã€‚ä¹Ÿæ˜¯[æ¨è](https://www.gatsbyjs.com/docs/reference/config-files/gatsby-browser/#wrapPageElement)æˆ‘åœ¨ Gatsby SSR é‡Œç”¨åŒæ ·çš„å‡½æ•°ã€‚

ä¸ºäº†é¿å…åœ¨ä¸¤ä¸ªæ–‡ä»¶ä¸­é‡å¤ç›¸åŒçš„ä»£ç ï¼Œæˆ‘å°†ç”¨æˆ‘è¦ä½¿ç”¨çš„å®é™…ä»£ç åˆ›å»ºç¬¬ä¸‰ä¸ªæ–‡ä»¶ï¼Œå¹¶å°†å…¶å¯¼å…¥åˆ°å‰é¢æåˆ°çš„ä¸¤ä¸ª`gatsby-*`æ–‡ä»¶ä¸­ã€‚

é¦–å…ˆï¼Œæˆ‘å°†åˆ›å»ºæ‰€éœ€çš„æ–‡ä»¶:

```
# create gatsby-browser.js and gatsby-ssr.js and root-wrapper.js
touch gatsby-browser.js gatsby-ssr.js root-wrapper.js 
```

æ ¹åŒ…è£…æ–‡ä»¶æ˜¯æˆ‘å°†ä½¿ç”¨`wrapPageElement`å‡½æ•°çš„åœ°æ–¹:

```
// root-wrapper.js
import React from "react";
import { Layout } from "./src/components/layout";

export const rootWrapper = ({ element }) => {
  return <Layout>{element}</Layout>;
}; 
```

ç„¶åï¼Œåœ¨`gatsby-browser.js`å’Œ`gatsby-ssr.js`æ–‡ä»¶ä¸­ï¼Œæˆ‘å°†æ·»åŠ ä»¥ä¸‹å†…å®¹:

```
import { rootWrapper } from "./root-wrapper";

export const wrapPageElement = rootWrapper; 
```

å¦‚æœéœ€è¦å¯¹`wrapPageElement`å‡½æ•°è¿›è¡Œä»»ä½•æ›´æ”¹ï¼Œæˆ‘å¯ä»¥åœ¨ä¸€ä¸ªæ–‡ä»¶`root-wrapper.js`ä¸­å®Œæˆã€‚

æ˜¯æ—¶å€™åœæ­¢å¹¶é‡æ–°å¯åŠ¨ dev æœåŠ¡å™¨ï¼Œçœ‹çœ‹æ›´æ”¹æ˜¯å¦ç”Ÿæ•ˆäº†ï¼

å› ä¸ºè¿™é‡Œä½¿ç”¨äº†å¸ƒå±€ç»„ä»¶æ¥åŒ…è£…ç«™ç‚¹ä¸Šçš„æ‰€æœ‰é¡µé¢å…ƒç´ ï¼Œæ‰€ä»¥ä¸å†éœ€è¦å°†å®ƒä¿å­˜åœ¨ç´¢å¼•é¡µé¢ä¸Šï¼Œæ‰€ä»¥æˆ‘å°†ä»`src/pages/index.js`ä¸­åˆ é™¤å®ƒ:

```
import { graphql, Link as GatsbyLink } from "gatsby";
import React from "react";
import { Box, Heading, Link } from "theme-ui";
- import { Layout } from "../components/layout"; 
export default function IndexPage({ data }) {
 return (
 <> - <Layout>  {data.allMdx.nodes.map(({ id, excerpt, frontmatter, slug }) => (
          <Box
            key={id}
            as="article"
            sx={{
              mb: 4,
              p: 3,
              boxShadow: "0 10px 15px -3px rgba(0, 0, 0, 0.1)",
              border: "1px solid #d1d1d1",
              borderRadius: "15px",
            }}
          >
            <Link as={GatsbyLink} to={`/${slug}`}>
              <Heading>{frontmatter.title}</Heading>
              <Box as="p" variant="styles.p">
                {frontmatter.date}
              </Box>
              <Box as="p" variant="styles.p">
                {excerpt}
              </Box>
            </Link>
          </Box>
 ))} - </Layout>  </>
 ); };
// rest unchanged 
```

åœ¨ç»§ç»­ä¹‹å‰ï¼Œæˆ‘å°†æäº¤åˆ°ç›®å‰ä¸ºæ­¢æ‰€åšçš„æ›´æ”¹:

```
git add .
git commit -m 'add root wrapper to Gatsby Browser and SSR' 
```

## 404 é¡µ

æ˜¯æ—¶å€™åˆ¶ä½œ 404 é¡µäº†ï¼

```
# create the 404.js page
touch src/pages/404.js 
```

åœ¨`src/pages/404.js`æ–‡ä»¶ä¸­ï¼Œæˆ‘ä¼šåŠ ä¸€æ¡æ¶ˆæ¯:

```
import React from "react";
import { Box, Heading } from "theme-ui";

export default function NotFound() {
  return (
    <>
      <Heading variant="styles.h1">
        Page not found!
        <span role="img" aria-label="crying face">
          ğŸ˜¢
        </span>
      </Heading>
      <Box as="h2" variant="styles.h2">
        It looks like that page doesn't exist
      </Box>
    </>
  );
} 
```

ç°åœ¨æˆ‘å¯ä»¥ç›´æ¥å¯¼èˆªåˆ° 404 é¡µé¢æŸ¥çœ‹:`http://localhost:8000/404`ã€‚

æ³¨æ„ï¼Œå½“ä½¿ç”¨`gatsby develop`è¿›è¡Œå¼€å‘æ—¶ï¼ŒGatsby å°†ç»§ç»­ä½¿ç”¨é»˜è®¤çš„ 404 é¡µé¢ï¼Œè¯¥é¡µé¢ä¼šè¦†ç›–æ‚¨çš„è‡ªå®šä¹‰ 404 é¡µé¢ã€‚

æäº¤æ­¤å†…å®¹ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€éƒ¨åˆ†:

```
git add .
git commit -m 'add 404 page' 
```

## æ·±è‰²ä¸»é¢˜åˆ‡æ¢

é»‘æš—æ¨¡å¼æ˜¯åšå®¢ç¼–ç çš„ä¸€ä¸ªåŸºæœ¬ç‰¹å¾ã€‚(æˆ‘åŠå¼€ç©ç¬‘åœ°è¯´ï¼Œä»¥é˜²ä½ ä¸ç¡®å®šï¼)æˆ‘å°†ä½¿ç”¨ä¸»é¢˜ UI é¢œè‰²æ¨¡å¼æŒ‚é’©`useColorMode`ï¼Œå¹¶åœ¨æˆ‘ä¹‹å‰åœ¨`theme`å¯¹è±¡ä¸­å®šä¹‰çš„ä¸¤ç§æ¨¡å¼ä¹‹é—´è¿›è¡Œç®€å•åˆ‡æ¢ã€‚ä»¥ä¸‹æ˜¯æ·»åŠ åˆ°`src/components/header.js`çš„å†…å®¹:

```
import { Link as GatsbyLink } from "gatsby";
import React from "react";
+ import { Box, Button, Heading, Link, useColorMode } from "theme-ui"; 
export const Header = ({ siteTitle, siteDescription }) => {
+ const [colorMode, setColorMode] = useColorMode();  return (
    <Box as="header" sx={{ bg: "highlight", mb: "1.45rem" }}>
      <Box
        as="div"
        sx={{
          m: "0 auto",
          maxWidth: "640px",
          p: "1.45rem 1.0875rem",
        }}
      >
        <Link as={GatsbyLink} to="/">
          <Heading>{siteTitle}</Heading>
        </Link>
        <Box as="p" variant="styles.p">
          {siteDescription}
 </Box> + <Button + onClick={(e) => { + setColorMode(colorMode === "default" ? "dark" : "default"); + }} + > + {colorMode === "default" ? "Dark" : "Light"} + </Button>  </Box>
    </Box>
 ); }; 
```

ä½†æ˜¯è¿™çœ‹èµ·æ¥ä¸å¤ªå¥½ï¼Œæ‰€ä»¥æˆ‘å°†ä½¿ç”¨ä¸»é¢˜ UI `Flex`ç»„ä»¶åŒ…è£…å®¹å™¨ï¼Œå¹¶å°†æŒ‰é’®ç§»åˆ°å³è¾¹:

```
import { Link as GatsbyLink } from "gatsby";
import React from "react";
+import { Box, Button, Flex, Heading, Link, useColorMode } from "theme-ui"; 
export const Header = ({ siteTitle, siteDescription }) => {
 const [colorMode, setColorMode] = useColorMode();
  return (
    <Box as="header" sx={{ bg: "highlight", mb: "1.45rem" }}>
      <Box
        as="div"
        sx={{
          m: "0 auto",
          maxWidth: "640px",
          p: "1.45rem 1.0875rem",
        }}
 > + <Flex> + <Box sx={{ flex: "1 1 auto", flexDirection: "column" }}>  <Link as={GatsbyLink} to="/">
              <Heading>{siteTitle}</Heading>
            </Link>
            <Box as="p" variant="styles.p">
              {siteDescription}
 </Box> + </Box>  <Button
            onClick={(e) => {
              setColorMode(colorMode === "default" ? "dark" : "default");
            }}
          >
            {colorMode === "default" ? "Dark" : "Light"}
 </Button> + </Flex>  </Box>
    </Box>
 ); }; 
```

åœ¨è¿›å…¥ä¸‹ä¸€éƒ¨åˆ†ä¹‹å‰ï¼ŒGit commit:

```
git add .
git commit -m 'add theme toggle to header' 
```

## ä»£ç å—

ä»£ç å—ç°åœ¨çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œæ‰€ä»¥æˆ‘å°†åœ¨ä¼—å¤šæ–¹ä¾¿çš„ä¸»é¢˜ UI åŒ…ä¸­æ·»åŠ ä¸€äº›è¯­æ³•é«˜äº®ã€‚æˆ‘ç”¨çš„è¿™ä¸ªæ˜¯[æ£±é•œ](https://theme-ui.com/packages/prism)ã€‚

æˆ‘éœ€è¦å®‰è£…è¿™ä¸ªåŒ…ï¼Œå¹¶åœ¨`gatsby-plugin-theme-ui`æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ªåä¸º`components.js`çš„ç»„ä»¶:

```
# install the package
yarn add @theme-ui/prism
# create Theme UI components file
touch src/gatsby-plugin-theme-ui/components.js 
```

åœ¨é‚£ä¸ªæ–‡ä»¶ä¸­ï¼Œæˆ‘éœ€è¦å®šä¹‰æˆ‘æƒ³è¦åº”ç”¨æ£±é•œæ ·å¼çš„åœ°æ–¹ï¼Œè¿™æ˜¯æ‰€æœ‰çš„`pre`å’Œ`code`æ ‡ç­¾:

```
import Prism from "@theme-ui/prism";

export default {
  pre: (props) => props.children,
  code: Prism,
}; 
```

å®šä¹‰å¥½ä¹‹åï¼Œæˆ‘è¿˜éœ€è¦åœ¨`theme`å¯¹è±¡ä¸­å®šä¹‰æˆ‘æƒ³è¦ä½¿ç”¨çš„ Prism ä¸»é¢˜:

```
// scr/gatsby-plugin-theme-ui/index.js

import { deep, swiss } from "@theme-ui/presets";
+ import nightOwl from "@theme-ui/prism/presets/night-owl.json"; 
const theme = {
 ...swiss,
  colors: {
    ...swiss.colors,
    modes: {
      dark: {
        ...deep.colors,
      },
    },
 }, 
 styles: {
 ...swiss.styles, + code: { + ...nightOwl, + },  // remainder of the file unchanged 
```

éœ€è¦å†ä¸€æ¬¡åœæ­¢å’Œå¯åŠ¨ dev æœåŠ¡å™¨æ‰èƒ½çœ‹åˆ°æ›´æ”¹ç”Ÿæ•ˆï¼

æäº¤æ›´æ”¹å¹¶è¿›å…¥ä¸‹ä¸€éƒ¨åˆ†:

```
git add .
git commit -m 'add Prism package and update theme object' 
```

## å‘ MDX æ·»åŠ ç»„ä»¶

**ä¸‹ä¸€ä½æ˜¯å¯é€‰çš„ã€‚**é™ä»· JSX å…è®¸ React (JSX)ç»„ä»¶åŒ…å«åœ¨é™ä»·ä¸­ã€‚ä¸ºäº†æ¼”ç¤ºè¿™ä¸€ç‚¹ï¼Œæˆ‘å°†æ·»åŠ ä¸€ä¸ª`RainbowText`ç»„ä»¶ï¼Œå®ƒå°†åœ¨ä¸€ä¸ªåŠ¨ç”»å‘¨æœŸä¸­åˆ¶ä½œä¸€äº›é¢œè‰²çš„åŠ¨ç”»ã€‚æˆ‘çš„åŠ¨ç”»éœ€è¦ä¸€ä¸ªé¢å¤–çš„ä¾èµ–:æ¥è‡ª`@emotion/react`çš„`keyframes`ã€‚æˆ‘ç°åœ¨å°±å®‰è£…:

```
# create component file
touch src/components/rainbow-text.js
# install @emotion/react
yarn add @emotion/react 
```

å¦‚æœå¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œï¼Œè¿™å¯èƒ½ä¼šç ´åå®ƒï¼Œæ‰€ä»¥æˆ‘ç°åœ¨åœæ­¢å®ƒã€‚

åœ¨`src/components/rainbow-text.js`æ–‡ä»¶ä¸­ï¼Œæˆ‘å°†æ·»åŠ è¿™ä¸ªç»„ä»¶:

```
import { keyframes } from "@emotion/react";
import React from "react";
import { Box } from "theme-ui";

export const RainbowText = ({ children }) => {
  const rainbow = keyframes({
    "0%": {
      backgroundPosition: "0 0",
    },
    "50%": {
      backgroundPosition: "400% 0",
    },
    "100%": {
      backgroundPosition: "0 0",
    },
  });

  return (
    <Box
      as="span"
      variant="styles.p"
      sx={{
        fontWeight: "heading",
        cursor: "pointer",
        textDecoration: "underline",
        ":hover": {
          background:
            "linear-gradient(90deg, #ff0000, #ffa500, #ffff00, #008000, #0000ff, #4b0082, #ee82ee) 0% 0% / 400%",
          animationDuration: "10s",
          animationTimingFunction: "ease-in-out",
          animationIterationCount: "infinite",
          animationName: `${rainbow}`,
          WebkitBackgroundClip: "text",
          WebkitTextFillColor: "transparent",
        },
      }}
    >
      {children}
    </Box>
  );
}; 
```

å› ä¸ºè¿™æ˜¯å¯é€‰çš„ï¼Œæ‰€ä»¥æˆ‘ä¸ä¼šè¯¦ç»†è¯´æ˜è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆã€‚åªè¦çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„ CSS æ•ˆæœã€‚

åˆ›å»ºå¥½ç»„ä»¶åï¼Œæˆ‘å¯ä»¥å°†å®ƒå¯¼å…¥åˆ°ä»»ä½•æˆ‘æƒ³è¦ä½¿ç”¨çš„æ–‡ä»¶ä¸­ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘å°†å®ƒæ·»åŠ åˆ°`content/2021/03/third-post/index.mdx`ã€‚ç°åœ¨æˆ‘å·²ç»æ·»åŠ äº†ç»„ä»¶ï¼Œæ–‡ä»¶çš„ä¸åŒä¹‹å¤„å¦‚ä¸‹:

```
---
title: Third Post!
date: 2021-03-08
---

+ import { RainbowText } from "../../../../../src/components/rainbow-text"; 
This is my third post!

> with a block quote! 
+ <RainbowText>Wheeeeeeee</RainbowText> 
And a code block:

```js
const wheeeeee = true;
``` 
```

å†æ¬¡å¯åŠ¨ dev æœåŠ¡å™¨åï¼Œæˆ‘å¯ä»¥è½¬åˆ°æ·»åŠ äº†è¯¥ç»„ä»¶çš„å¸–å­ï¼Œå½“æˆ‘å°†é¼ æ ‡æ‚¬åœåœ¨è¢«åŒ…è£…åœ¨`<RainbowText>Wheeeeeeee</RainbowText>`ä¸­çš„æ–‡æœ¬ä¸Šæ—¶ï¼Œæˆ‘å¯ä»¥çœ‹åˆ°åŠ¨ç”»æ•ˆæœã€‚

ä½ å¯èƒ½ä¼šå¯¹é‚£ä¸ªè¿›å£è´§åšé¬¼è„¸ã€‚æ²¡å®Œæ²¡äº†ã€‚ç„¶è€Œï¼Œæœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½¿ç”¨æˆ‘ä¹‹å‰è¯¦è¿°çš„æ ¹åŒ…è£…å™¨æ¦‚å¿µï¼Œå¹¶ä½¿ç”¨`MDXProvider`,å®ƒå°†â€”â€”å’³å’³ï¼â€”å‘ MDX æä¾›æ‚¨ä¼ é€’ç»™å®ƒçš„ä»»ä½•ç»„ä»¶ã€‚

å›åˆ°æ ¹åŒ…è£…å™¨(`root-wrapper.js`)ï¼Œæˆ‘å¯ä»¥ç”¨`MDXProvider`åŒ…è£…é¡µé¢`element`ï¼Œå¹¶å°†`RainbowText`ç»„ä»¶ä¼ é€’ç»™`MDXProvider`:

```
import { MDXProvider } from "@mdx-js/react";
import React from "react";
import { Layout } from "./src/components/layout";
import { RainbowText } from "./src/components/rainbow-text";

const MDXComponents = {
  RainbowText,
};

export const rootWrapper = ({ element }) => {
  return (
    <Layout>
      <MDXProvider components={MDXComponents}>{element}</MDXProvider>
    </Layout>
  );
}; 
```

ç°åœ¨æˆ‘å¯ä»¥ä»`.mdx`æ–‡ä»¶ä¸­åˆ é™¤å¯¼å…¥:

```
---
title: Third Post!
date: 2021-03-08
---

- import { RainbowText } from "../../../../../src/components/rainbow-text"; 
This is my third post!

> with a block quote! 
<RainbowText>Wheeeeeeee</RainbowText> 
And a code block:

```js
const wheeeeee = true;
``` 
```

åœ¨åœæ­¢å¹¶é‡å¯ dev æœåŠ¡å™¨åï¼Œæˆ‘å¯ä»¥è½¬åˆ°è¿™ç¯‡æ–‡ç« ï¼Œä»ç„¶å¯ä»¥çœ‹åˆ°`RainbowText`åœ¨å·¥ä½œã€‚å°†ç»„ä»¶ç›´æ¥æ·»åŠ åˆ°`MDXProvider`çš„é¢å¤–å¥½å¤„æ˜¯ï¼Œå½“æ‚¨æƒ³è¦ä½¿ç”¨ç»„ä»¶æ—¶ï¼Œä¸éœ€è¦å°†ç»„ä»¶å¯¼å…¥åˆ°`.mdx`æ–‡æ¡£ä¸­ã€‚å®ƒå¯ä»¥é€šè¿‡æ‰€æœ‰ MDX æ–‡æ¡£çš„æä¾›è€…è·å¾—ã€‚

æˆ‘ç°åœ¨å°±æäº¤:

```
git add .
git commit -m 'add component for mdx' 
```

## é™ä»·å›¾ç‰‡

å¦‚æœæˆ‘æƒ³åœ¨æˆ‘çš„åšå®¢æ–‡ç« ä¸­æ·»åŠ å›¾åƒï¼Œæˆ‘å¯ä»¥å°†å®ƒä»¬åŒ…å«åœ¨ MDX æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤º:

```
---
title: Hello World - from mdx!
date: 2021-03-06
---

My first post!!

## h2 Heading

![mdx logo](./mdx-logo.png)

Some meaningful prose

### h3 Heading

Some other meaningful prose 
```

`./mdx-logo.png`æ˜¯æˆ‘æ·»åŠ åˆ°`content/2021/03/06/hello-world`æ–‡ä»¶å¤¹ä¸­çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ‘å°†å®ƒä½œä¸ºä¸€ä¸ªç›¸å¯¹æ–‡ä»¶å¼•ç”¨ã€‚ä¸è¿‡ï¼Œä¸æ˜¯ä¸ºäº†è¿™ä¸ªã€‚å¦‚æœæˆ‘è½¬åˆ° hello world postï¼Œæ˜¾ç¤ºçš„å›¾åƒä¼šè¢«ç ´åã€‚æˆ‘éœ€è¦å°†`gatsby-remark-images`ä½œä¸ºæ’ä»¶æ·»åŠ åˆ°`gatsby-plugin-mdx`ä¸­ï¼Œè¿™æ ·å®ƒå°±çŸ¥é“å¦‚ä½•å¤„ç†å›¾åƒæ–‡ä»¶:

```
yarn add gatsby-remark-images gatsby-plugin-sharp 
```

ç„¶åæˆ‘éœ€è¦åœ¨`gatsby-config.js`ä¸­é…ç½®æ’ä»¶:

```
const siteMetadata = {
 title: `My Gatsby Blog`,
 description: `This is my coding blog.`, };

module.exports = {
 siteMetadata,
  plugins: [
 `gatsby-plugin-theme-ui`, + `gatsby-plugin-sharp`, + { + resolve: `gatsby-plugin-mdx`, + options: { + gatsbyRemarkPlugins: [ + { + resolve: `gatsby-remark-images`, + options: { + maxWidth: 640, + }, + }, + ], + }, + }, + { + resolve: `gatsby-source-filesystem`, + options: { + path: `${__dirname}/content/`, + }, + },  {
      resolve: `gatsby-source-filesystem`,
      options: {
        path: `${__dirname}/content`,
        name: `content`,
      },
    },
 ], }; 
```

é¢å¤–çš„`gatsby-source-filesystem`å¯¹è±¡æ˜¯è®© Gatsby çŸ¥é“åœ¨å“ªé‡Œå¯»æ‰¾è¦å¤„ç†çš„å›¾åƒã€‚

ç«‹å³æäº¤:

```
git add .
git commit -m 'add and configure images' 
```

## æœç´¢å¼•æ“ä¼˜åŒ–

å¦‚æœæˆ‘æƒ³è®©æœç´¢å¼•æ“åœ¨ç½‘ä¸Šæ‰¾åˆ°æˆ‘çš„å†…å®¹ï¼ŒSEO æ˜¯éå¸¸é‡è¦çš„ï¼Œæ‰€ä»¥æˆ‘éœ€è¦åœ¨æˆ‘çš„åšå®¢ä¸Šæ·»åŠ ç›¸å…³çš„ meta æ ‡ç­¾ã€‚å®šä¹‰æ‰€æœ‰éœ€è¦çš„ç›¸å…³æ ‡ç­¾å¯èƒ½æ˜¯ä¸€ä¸ªç›¸å½“å¤æ‚çš„è¿‡ç¨‹ï¼Œæ‰€ä»¥ä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ª [React SEO ç»„ä»¶](https://scottspence.com/2020/05/04/react-seo-component/)ï¼Œç”¨äºåœ¨ Gatsby ä¸­ç”Ÿæˆæ‰€æœ‰éœ€è¦çš„å…ƒæ ‡ç­¾ã€‚

æˆ‘å°†`yarn add`ç»„ä»¶åŠå…¶å·¥ä½œæ‰€éœ€çš„ä¾èµ–å…³ç³»:

```
yarn add react-seo-component react-helmet gatsby-plugin-react-helmet 
```

æˆ‘éœ€è¦å°†`gatsby-plugin-react-helmet`æ·»åŠ åˆ°`gatsby-config.js`æ’ä»¶æ•°ç»„ä¸­:

```
module.exports = {
 siteMetadata,
 plugins: [ + `gatsby-plugin-react-helmet`,  `gatsby-plugin-theme-ui`,
    `gatsby-plugin-sharp`,
    {
 // rest unchanged 
```

ç„¶åæ˜¯åœ¨æˆ‘éœ€è¦å…ƒæ ‡ç­¾çš„ç«™ç‚¹ä¸­ä½¿ç”¨`SEO`ç»„ä»¶ã€‚

è¯¥ç»„ä»¶éœ€è¦ç›¸å½“å¤šçš„é“å…·ï¼Œå…¶ä¸­è®¸å¤šåœ¨æ•´ä¸ªç«™ç‚¹ä¸­åªå®šä¹‰ä¸€æ¬¡ï¼Œæ‰€ä»¥æ·»åŠ è¿™äº›é“å…·çš„æœ€ä½³ä½ç½®åº”è¯¥æ˜¯åœ¨`siteMetadata`å¯¹è±¡ä¸­ã€‚ç„¶åæˆ‘å¯ä»¥ç”¨`useSiteMetadata`æŒ‚é’©æ‹‰å‡ºæˆ‘éœ€è¦çš„ä¸œè¥¿ã€‚

æˆ‘å°†å‘`siteMetadata`å¯¹è±¡æ·»åŠ å‡ ä¸ªå±æ€§:

```
const siteMetadata = {
 title: `My Gatsby Blog`,
 description: `This is my coding blog.`, + lastBuildDate: new Date(Date.now()).toISOString(), + siteUrl: `https://dummy-url-for-now.com`, + authorName: `Author McAuthorson`, + twitterUsername: `@authorOfPosts`, + siteLanguage: `en-GB`, + siteLocale: `en_gb`, }; 
```

å¦‚æœæ‚¨æ­£åœ¨è·Ÿè¿›ï¼Œæ‚¨å¯ä»¥æ ¹æ®éœ€è¦æ›´æ”¹è¿™äº›å†…å®¹ã€‚ç›®å‰,`siteUrl`å¯èƒ½æ˜¯ä¸€ä¸ªä¼ª URLã€‚è¿™æœ‰åŠ©äºæŒ‡å‘ Open Graph åè®®ä¸­éœ€è¦ä½¿ç”¨çš„ä»»ä½•å›¾åƒï¼Œä¾‹å¦‚ï¼Œå½“ä½ åœ¨ Twitterã€è„¸ä¹¦ã€LinkedIn å’Œ Reddit ä¸Šåˆ†äº«ä½ çš„å¸–å­æ—¶ï¼Œä½ ä¼šçœ‹åˆ°è¿™ä¸ªå›¾åƒã€‚

æ—¢ç„¶è¿™äº›é™„åŠ å±æ€§åœ¨`siteMetadata`å¯¹è±¡ä¸Šï¼Œæˆ‘å°†éœ€è¦èƒ½å¤ŸæŸ¥è¯¢å®ƒä»¬ã€‚ç›®å‰`useSiteMetadata`æŒ‚é’©åªæœ‰`title`å’Œ`description`ï¼Œæ‰€ä»¥æˆ‘ç°åœ¨æŠŠå…¶ä½™çš„åŠ è¿›å»:

```
// src/hooks/use-site-metadata.js

import { graphql, useStaticQuery } from "gatsby";
export const useSiteMetadata = () => {
 const { site } = useStaticQuery(
    graphql`
      query SITE_METADATA_QUERY {
        site {
          siteMetadata {
            title
 description + lastBuildDate + siteUrl + authorName + twitterUsername + siteLanguage + siteLocale  }
        }
      }
    `
  );
 return site.siteMetadata; }; 
```

æˆ‘å°†åœ¨æ‰€æœ‰é¡µé¢ä¸­æ·»åŠ  SEO ç»„ä»¶ã€‚é¦–å…ˆï¼Œæˆ‘å°†åœ¨`src/pages/{mdx.slug}.js`é¡µé¢ä¸­åšæ–‡ç« é¡µé¢ã€‚è¿™æ˜¯æœ€å¤æ‚çš„ä¸€ä¸ªï¼Œæ‰€ä»¥æˆ‘å°†åœ¨è¿™é‡Œåˆ—å‡ºä¸åŒä¹‹å¤„ï¼Œå¹¶è¯¦ç»†è¯´æ˜å‘ç”Ÿäº†ä»€ä¹ˆ:

```
import { graphql } from "gatsby";
import { MDXRenderer } from "gatsby-plugin-mdx";
import React from "react";
+ import SEO from "react-seo-component"; import { Box } from "theme-ui";
+ import { useSiteMetadata } from "../hooks/use-site-metadata"; 
export default function PostPage({ data }) {
 const {
 body, + slug, + excerpt, + frontmatter: { title, date },  } = data.mdx; + const { + title: siteTitle, + siteUrl, + siteLanguage, + siteLocale, + twitterUsername, + authorName, + } = useSiteMetadata();  return (
 <> + <SEO + title={title} + titleTemplate={siteTitle} + description={excerpt} + pathname={`${siteUrl}${slug}`} + article={true} + siteLanguage={siteLanguage} + siteLocale={siteLocale} + twitterUsername={twitterUsername} + author={authorName} + publishedDate={date} + modifiedDate={new Date(Date.now()).toISOString()} + />  <Box as="h1" variant="styles.h1" fontSize="4xl">
        {title}
      </Box>
      <MDXRenderer>{body}</MDXRenderer>
    </>
 ); }

export const query = graphql`
 query POST_BY_SLUG($slug: String) {
    mdx(slug: { eq: $slug }) {
      id
      slug
 body + excerpt  frontmatter {
        date
        title
      }
    }
 } `; 
```

è§„èŒƒé“¾æ¥éœ€è¦`siteUrl`ã€`slug`å’Œ`excerpt`(åœ¨ SEO ä¸­éå¸¸é‡è¦)ï¼Œå…ƒæè¿°éœ€è¦`excerpt`ã€‚

æˆ‘ä½¿ç”¨`siteMetadata`é’©å­æ¥è·å–ç»„ä»¶éœ€è¦çš„å…¶ä½™ä¿¡æ¯ã€‚`title`å’Œ`titleTemplate`ç”¨äºç»„æˆä½ åœ¨æµè§ˆå™¨æ ‡ç­¾ä¸­çœ‹åˆ°çš„å†…å®¹ã€‚

`article`å¸ƒå°”å€¼ç”¨äºç»„ä»¶ï¼Œå› æ­¤å®ƒå¯ä»¥åˆ›å»º [JSONLD](https://json-ld.org/) æ ¼å¼çš„é¢åŒ…å±‘åˆ—è¡¨ã€‚å…¶ä½™çš„é“å…·æ˜¯å¸®åŠ©è¯†åˆ«ä½œè€…å’Œå‡ºç‰ˆæ—¥æœŸã€‚ğŸ˜…

å¤ªå¤šäº†ã€‚æˆ‘å¸Œæœ›å…¶ä¸­çš„ä¸€äº›æœ‰æ„ä¹‰ï¼å¯¹äºè¿™ç¯‡æ–‡ç« çš„èŒƒå›´ï¼Œæˆ‘å°†æŠŠå®ƒç•™åœ¨é‚£é‡Œï¼Œä½†åœ¨è¿™ä¸ªé—®é¢˜ä¸Šè¿˜æœ‰å¾ˆå¤šè¦æ·±å…¥ç ”ç©¶çš„ï¼Œæˆ‘çš„æ„æ€æ˜¯*å¾ˆå¤š*ï¼

è°¢å¤©è°¢åœ°ï¼Œ`src/pages/index.js`é¡µé¢ç®€å•äº†ä¸€ç‚¹ï¼

```
import { graphql, Link as GatsbyLink } from "gatsby";
import React from "react";
+ import SEO from "react-seo-component"; import { Box, Heading, Link } from "theme-ui";
+ import { useSiteMetadata } from "../hooks/use-site-metadata"; 
export default function IndexPage({ data }) {
+ const { + title, + description, + siteUrl, + siteLanguage, + siteLocale, + twitterUsername, + } = useSiteMetadata();  return (
 <> + <SEO + title={`Home`} + titleTemplate={title} + description={description} + pathname={siteUrl} + siteLanguage={siteLanguage} + siteLocale={siteLocale} + twitterUsername={twitterUsername} + />  {data.allMdx.nodes.map(({ id, excerpt, frontmatter, slug }) => ( // rest of component unchanged 
```

æˆ‘æœ‰æ„åœ¨è¿™ä¸¤ä¸ªä¾‹å­ä¸­çœç•¥äº†å›¾åƒã€‚å¦‚æœæ‚¨æœ‰å…´è¶£åˆ¶ä½œè‡ªå·±çš„ Open Graph images ä»¥åœ¨è¯¥ç»„ä»¶ä¸­ä½¿ç”¨ï¼Œè¯·æŸ¥çœ‹"[Open Graph Images with Gatsby and Vercel](https://toast.scottspence.com/2020/04/30/serverless-og-images/)"è¿™ç¯‡æ–‡ç« ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨æ— æœåŠ¡å™¨å‡½æ•°æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ğŸ”¥

ç°åœ¨æˆ‘å¯ä»¥æ„å»ºç«™ç‚¹äº†(å‡ ä¹å¯ä»¥ç”Ÿäº§äº†)ï¼Œä¸€æ—¦æ„å»ºå¥½äº†ï¼Œæˆ‘å°±å¯ä»¥æ£€æŸ¥ meta æ ‡ç­¾çš„é¡µé¢æºä»£ç äº†:

```
# build the site first
yarn build
# use gatsby serve to run built site locally
yarn serve 
```

ä¸€æ—¦æ„å»ºå®Œæˆï¼Œæˆ‘å¯ä»¥ä½¿ç”¨`yarn serve`è®©æ„å»ºå¥½çš„ç«™ç‚¹åœ¨`localhost:9000`ä¸Šå¾—åˆ°æœ¬åœ°æœåŠ¡ã€‚åœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘å¯ä»¥ç”¨é”®ç›˜å¿«æ·é”®`Ctrl` + `u`æŸ¥çœ‹é¡µé¢æºä»£ç ã€‚ä»è¿™é‡Œï¼Œæˆ‘å¯ä»¥æ£€æŸ¥`canonical`å…ƒæ ‡ç­¾ï¼Œå®ƒå°†æ˜¯å…ƒæ•°æ®ä¸­ä½¿ç”¨çš„è™šæ‹Ÿ URLã€‚

å¥½å§ã€‚å°†æ­¤æäº¤ç»™ Gitï¼Œç„¶åç»§ç»­:

```
git add .
git commit -m 'add SEO component :sweat_smile:' 
```

## æ¨ç»™ GitHub

ä½ å¯èƒ½æƒ³çŸ¥é“ä¸ºä»€ä¹ˆæˆ‘åœ¨æ¯ä¸€èŠ‚çš„ç»“å°¾éƒ½åš Git æäº¤ã€‚é‚£æ˜¯å› ä¸ºæˆ‘ç°åœ¨è¦æŠŠé¡¹ç›®æ¨ä¸Š GitHub äº†ã€‚

æˆ‘å°†ç™»å½•æˆ‘çš„ GitHub å¸æˆ·ï¼Œé€‰æ‹©å³ä¸Šè§’æˆ‘çš„å¤´åƒæ—è¾¹çš„åŠ å·`+`å›¾æ ‡ï¼Œç„¶åé€‰æ‹© **[æ–°ä»“åº“](https://github.com/new)** ã€‚

åœ¨**å­˜å‚¨åº“åç§°**ä¸­ï¼Œæˆ‘å°†æ·»åŠ é¡¹ç›®åç§°`my-gatsby-blog`ï¼Œä½†ä¿ç•™å…¶ä½™çš„é»˜è®¤å€¼ï¼Œå¹¶å•å‡»**åˆ›å»ºå­˜å‚¨åº“**ã€‚

ä¸‹ä¸€ä¸ªå±å¹•ç»™å‡ºäº†å°†æœ¬åœ°é¡¹ç›®æ¨é€åˆ° GitHub æ‰€éœ€çš„ç»ˆç«¯å‘½ä»¤:

```
git remote add origin https://github.com/spences10/my-gatsby-blog
git branch -M main
git push -u origin main 
```

ä¸€æ—¦ä½ æŠŠè¿™äº›éƒ½æ”¾å…¥ç»ˆç«¯å¹¶ç‚¹å‡»`Enter`ï¼Œåˆ·æ–° GitHub é¡µé¢å°±å¯ä»¥çœ‹åˆ°æ–°çš„é¡¹ç›®äº†ï¼

## éƒ¨ç½²

æ˜¯æ—¶å€™æŠŠè¿™ä¸ªå®è´æ”¾åˆ°ç½‘ä¸Šäº†ï¼æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚å› ä¸º Gatsby æ„å»ºäº†ä¸€ä¸ªå¹³é¢æ–‡ä»¶ç»“æ„ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥åœ¨ä»»ä½•å¯ä»¥è®¿é—® Internet çš„æ–‡ä»¶æœåŠ¡å™¨ä¸Šæ‰˜ç®¡ä¸€ä¸ª Gatsby ç«™ç‚¹ã€‚

æœ‰è®¸å¤šæœåŠ¡åœ¨ CDN ä¸Šæä¾›ä¸»æœºæœåŠ¡ï¼Œå¾ˆå¤šæ˜¯å…è´¹çš„ï¼åƒ [Netlify](https://www.netlify.com/) ã€ [Vercel](https://vercel.com/) å’Œ [Render](https://render-web.onrender.com/) è¿™æ ·çš„æœåŠ¡å°†å…è®¸ä½ é€šè¿‡ CLIã€GitHub é›†æˆï¼Œæˆ–è€…åœ¨ Netlify çš„æƒ…å†µä¸‹ï¼Œç›´æ¥æ‹–æ”¾ï¼Œå°†ä½ æ„å»ºçš„ç½‘ç«™æ¨é€åˆ°ä»–ä»¬çš„ cdnï¼

### ç»´å…‹å¡å°”

è¦ä½¿ç”¨ Vercel è¿›è¡Œéƒ¨ç½²ï¼Œæ‚¨éœ€è¦ä¸€ä¸ª GitHubã€GitLab æˆ– Bitbucket å¸æˆ·è¿›è¡Œèº«ä»½éªŒè¯ã€‚ç„¶åä¼šæç¤ºæ‚¨å®‰è£… Vercel CLI:

```
yarn global add vercel 
```

æˆ‘å·²ç»å®‰è£…äº†å®ƒï¼Œæ‰€ä»¥ç°åœ¨çš„æƒ…å†µæ˜¯è¿è¡Œ CLI å‘½ä»¤:

```
vc 
```

ç„¶åï¼Œç³»ç»Ÿä¼šæç¤ºæˆ‘è®¾ç½®å’Œéƒ¨ç½²æ–°é¡¹ç›®ã€‚æˆ‘å°†ç”¨`Enter`å›ç­”æ‰€æœ‰é—®é¢˜çš„é»˜è®¤:

```
Set up and deploy â€œ~/repos/my-gatsby-blogâ€? [Y/n]
Which scope do you want to deploy to?
Link to existing project? [y/N]
Whatâ€™s your projectâ€™s name? (my-gatsby-blog)
In which directory is your code located? ./
> Upload [====================] 99% 0.0sAuto-detected Project Settings (Gatsby.js):
- Build Command: `npm run build` or `gatsby build`
- Output Directory: public
- Development Command: gatsby develop --port $PORT
? Want to override the settings? [y/N] 
```

å°±æ˜¯è¿™æ ·ã€‚ç„¶åç»™æˆ‘ä¸€ä¸ªéƒ¨ç½² URLï¼Œåœ¨é‚£é‡Œæˆ‘å¯ä»¥åœ¨ Vercel ä¸ŠæŸ¥çœ‹ç«™ç‚¹çš„æ„å»ºã€‚

ä» Vercel ä»ªè¡¨æ¿ï¼Œæˆ‘å¯ä»¥é…ç½®åŸŸï¼Œå¦‚æœæˆ‘æƒ³ï¼Œä¹Ÿå¯ä»¥ä» Vercel è´­ä¹°ä¸€ä¸ªã€‚æˆ‘ä¸ªäººä½¿ç”¨ Namecheap.comï¼Œä½†å®ƒæ˜¯ä¸€ä¸ªé€‰é¡¹ã€‚

### Netlify

é€šè¿‡ CLI ä½¿ç”¨ Netlify è¿›è¡Œéƒ¨ç½²ä¸ä½¿ç”¨ Vercel éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯æˆ‘å°†è¿›è¡Œæ‹–æ”¾å¼åˆ›å»ºã€‚

ä¸ºäº†è®¤è¯ï¼Œæˆ‘éœ€è¦ GitHubã€GitLabã€Bitbucket æˆ–ç”µå­é‚®ä»¶å¸æˆ·ä¸­çš„ä¸€ä¸ªã€‚ä¸€æ—¦æˆ‘éªŒè¯å¹¶ç™»å½•ï¼Œæˆ‘å¯ä»¥åœ¨èœå•æ ä¸­é€‰æ‹©**ç«™ç‚¹**ï¼Œç„¶åæœ‰ä¸€ä¸ªæ‹–æ”¾åŒº**æƒ³è¦éƒ¨ç½²ä¸€ä¸ªæ–°ç«™ç‚¹è€Œä¸è¿æ¥åˆ° Gitï¼Ÿå°†ä½ çš„ç«™ç‚¹è¾“å‡ºæ–‡ä»¶å¤¹æ‹–æ”¾åˆ°è¿™é‡Œ**ã€‚æˆ‘å°†åœ¨æ–‡ä»¶æµè§ˆå™¨ä¸­å¯¼èˆªåˆ°æˆ‘çš„é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¹¶å°†`public`æ–‡ä»¶å¤¹æ‹–æ”¾åˆ°æ‹–æ”¾åŒºã€‚

Netlify å°†æ„å»ºè¿™äº›æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬éƒ¨ç½²åˆ°ç”Ÿæˆçš„ URL ä»¥ä¾›æ£€æŸ¥ã€‚ä¸ Vercel éå¸¸ç›¸ä¼¼ï¼ŒNetlify å°†å…è®¸æ‚¨åœ¨é‚£é‡Œè´­ä¹°ä¸€ä¸ªåŸŸå¹¶éƒ¨ç½²åˆ°å…¶ä¸Šã€‚

### æä¾›ï¼›ç»™äºˆ

Render æ²¡æœ‰ CLI æˆ– drop é€‰é¡¹ï¼Œè€Œæ˜¯ä½¿ç”¨ GitHub é›†æˆã€‚ä¸ºäº†è®¤è¯ï¼Œæˆ‘éœ€è¦ä¸€ä¸ª GitHubï¼ŒGitLab æˆ–è°·æ­Œå¸æˆ·ã€‚ä¸€æ—¦æˆ‘é€šè¿‡éªŒè¯å¹¶ç™»å½•ï¼Œæˆ‘å°±è¿›å…¥äº†æœåŠ¡åŒºã€‚ä»è¿™é‡Œï¼Œæˆ‘å¯ä»¥é€‰æ‹©**æ–°çš„é™æ€ç«™ç‚¹**ï¼Œç„¶åè¾“å…¥æˆ‘ä¹‹å‰æ¨é€åˆ° GitHub çš„é¡¹ç›®çš„ GitHub URLã€‚

åœ¨ä¸‹ä¸€é¡µï¼Œæˆ‘å°†å¯¹å…¶è¿›è¡Œå¦‚ä¸‹è®¾ç½®:

*   **å§“å** : `my-gatsby-blog`
*   **åˆ†æ”¯**:é»˜è®¤å€¼
*   **æ„å»ºå‘½ä»¤** : `yarn build`
*   **å‘å¸ƒç›®å½•** : `./public`

ç„¶åç‚¹å‡»**åˆ›å»ºé™æ€ç«™ç‚¹**ã€‚

ç­‰å¾… Render å®Œæˆå®ƒçš„å·¥ä½œï¼Œç„¶åå•å‡»é¡¹ç›®åç§°ä¸‹é¢çš„é“¾æ¥æ¥å®æ—¶æŸ¥çœ‹ç«™ç‚¹ã€‚

Render è¿˜å¯ä»¥é€‰æ‹©ä¸ºç«™ç‚¹è®¾ç½®è‡ªå·±çš„è‡ªå®šä¹‰åŸŸï¼

## å¯é€‰ Gatsby æ’ä»¶

æœ‰æ›´å¤šçš„ Gatsby æ’ä»¶å¯ä¾›é€‰æ‹©æ¥å¢åŠ é¢å¤–çš„åŠŸèƒ½ã€‚å¦‚æœä½ è¿˜æƒ³è¡¥å……çš„è¯ï¼Œæˆ‘æŠŠè¿™äº›ç•™ç»™ä½ ã€‚ä¾‹å¦‚:

*   è¦ä¸è¦åµŒå…¥ YouTube è§†é¢‘ï¼Œæ¨æ–‡ï¼ŒStrava runsï¼ŒCoodePensï¼ŒCodesandboxï¼ŸæŸ¥çœ‹[ç›–èŒ¨æ¯”-æ’ä»¶-mdx-åµŒå…¥](https://www.npmjs.com/package/gatsby-plugin-mdx-embed)ã€‚
*   ä½ ç”¨çš„æ˜¯è°·æ­Œ/å¿…åº”æœç´¢æ§åˆ¶å°å—ï¼Ÿç„¶åä½ éœ€è¦ç”¨ [gatsby-plugin-sitemap](https://www.npmjs.com/package/gatsby-plugin-sitemap) ç”Ÿæˆä¸€ä¸ªç«™ç‚¹åœ°å›¾ã€‚
*   æ‚¨æƒ³è®©æ‚¨çš„ç½‘ç«™ä½œä¸º PWA è„±æœºä½¿ç”¨å—ï¼Ÿæ·»åŠ [ç›–èŒ¨æ¯”-æ’ä»¶-ç¦»çº¿](https://www.npmjs.com/package/gatsby-plugin-offline)ã€‚
*   ä½ æƒ³åœ¨ä½ çš„ç«™ç‚¹çš„æµè§ˆå™¨æ ‡ç­¾ä¸­æœ‰ä¸€ä¸ª favicon å—ï¼Ÿæ£€æŸ¥ä¸€ä¸‹[ç›–èŒ¨æ¯”æ’ä»¶æ¸…å•](https://www.npmjs.com/package/gatsby-plugin-manifest)ã€‚

## åˆ†æå­¦

å¦‚æœä½ æƒ³çŸ¥é“ä½ çš„ç½‘ç«™æœ‰å¤šå—æ¬¢è¿ï¼Œæœ‰åˆ†æé€‰é¡¹ã€‚æˆ‘åœ¨è‡ªå·±çš„é¡¹ç›®ä¸­åœæ­¢ä½¿ç”¨ Google Analytics æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œç°åœ¨æˆ‘æ›´å–œæ¬¢æ›´æ³¨é‡éšç§çš„æ›¿ä»£æ–¹æ¡ˆã€‚æˆ‘æ¨èçš„æ˜¯ Fathom Analyticsã€‚(å¦‚æœä½ æƒ³åœ¨ç¬¬ä¸€ä¸ªæœˆçš„è®¢é˜…ä¸­è·å¾— 10 ç¾å…ƒçš„ä¼˜æƒ ï¼Œæˆ‘æœ‰ä¸€ä¸ª[ä¼šå‘˜é“¾æ¥](https://usefathom.com/ref/HG492L)ã€‚)

å¦ä¸€ç§é€‰æ‹©æ˜¯[ä¼¼æ˜¯è€Œéçš„](https://plausible.io/privacy-focused-web-analytics)ï¼Œæˆ‘ä¹Ÿå¬è¯´è¿‡å®ƒçš„å¥½å¤„ã€‚

ä¸ºäº†åœ¨ Gatsby ç½‘ç«™ä¸Šå®ç° [Fathom Analyticsï¼Œæˆ‘éœ€è¦åœ¨æˆ‘çš„ç½‘ç«™å¤´éƒ¨æ·»åŠ ä¸€ä¸ªé¢å¤–çš„è„šæœ¬æ ‡ç­¾ã€‚é‚£æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿé¦–å…ˆï¼Œæˆ‘éœ€è¦åœ¨æˆ‘çš„ Fathom ä»ªè¡¨ç›˜ä¸Šåˆ›å»ºç½‘ç«™ï¼Œç„¶åè½¬åˆ°](https://usefathom.com/integrations/gatsbyjs)[https://app.usefathom.com/#/settings/sites](https://app.usefathom.com/#/settings/sites)ï¼Œæ»šåŠ¨åˆ°åˆ—è¡¨åº•éƒ¨ï¼Œæ·»åŠ æˆ‘çš„æ–°ç½‘ç«™(`my-gatsby-blog`)ï¼Œç„¶åç‚¹å‡»**è·å–ç½‘ç«™ä»£ç **ã€‚ç„¶åæˆ‘å¾—åˆ°ä¸€ä¸ªå¸¦æœ‰ç«™ç‚¹ä»£ç çš„å¼¹å‡ºæ¨¡å¼ã€‚æˆ‘è¦æŠŠå®ƒåŠ åˆ°æˆ‘çš„ç›–èŒ¨æ¯”é¡¹ç›®çš„å‰§æœ¬é‡Œã€‚è„šæœ¬çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
<script
  src="https://cdn.usefathom.com/script.js"
  data-spa="auto"
  data-site="ABCDEF"
  defer
></script> 
```

ä¸‹é¢æ˜¯`root-wrapper.js`çš„ä¸åŒä¹‹å¤„:

```
import { MDXProvider } from "@mdx-js/react";
import React from "react";
+import { Helmet } from "react-helmet"; import Layout from "./src/components/layout";
import RainbowText from "./src/components/rainbow-text";

const MDXComponents = {
 RainbowText, };

export const wrapPageElement = ({ element }) => {
 return ( + <> + <Helmet> + <script + src="https://cdn.usefathom.com/script.js" + spa="auto" + data-site="ABCDEF" + defer + ></script> + </Helmet>  <Layout>
        <MDXProvider components={MDXComponents}>{element}</MDXProvider>
 </Layout> + </>  ); }; 
```

## åŒ…è£…ï¼

æˆ‘å°±è¯´è¿™äº›ã€‚éå¸¸æ„Ÿè°¢ä½ åšæŒåˆ°æœ€åã€‚ğŸ™

æˆ‘å¸Œæœ›ä½ ä»è¿™æœ¬å…³äºä»å¤´å¼€å§‹å»ºç«‹ä¸€ä¸ª Gatsby é¡¹ç›®çš„å†…å®¹ä¸°å¯Œçš„æŒ‡å—ä¸­å¾—åˆ°ä½ æ‰€éœ€è¦çš„ä¸œè¥¿ï¼

å¦‚æœä½ æƒ³å’Œæˆ‘æ‰“æ‹›å‘¼ï¼Œæœ€å¥½çš„è”ç³»æ–¹å¼æ˜¯åœ¨æ¨ç‰¹ä¸Šã€‚

## åˆ†äº«è¿™ç¯‡æ–‡ç« *